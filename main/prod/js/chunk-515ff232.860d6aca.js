(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-515ff232"],{"025a":function(t,e,s){"use strict";s("c973")},"083a":function(t,e,s){"use strict";var i=s("0d51"),n=TypeError;t.exports=function(t,e){if(!delete t[e])throw n("Cannot delete property "+i(e)+" of "+i(t))}},1332:function(t,e,s){},"1f49":function(t,e,s){"use strict";(function(t){s.d(e,"a",(function(){return u}));var i=s("34ba"),n=s("99ea"),r=s("29c2"),o=s("af7f"),a=s("744a"),h=s("33e8");const c="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class u extends i["a"]{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=c?{}:Object(o["c"])(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=a["d"]&&!c?e?new a["a"](t,e):new a["a"](t):new a["a"](t,e,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||a["b"],this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],n=s===e.length-1;Object(h["c"])(i,this.supportsBinary,e=>{const s={};if(!a["d"]&&(i.options&&(s.compress=i.options.compress),this.opts.perMessageDeflate)){const i="string"===typeof e?t.byteLength(e):e.length;i<this.opts.perMessageDeflate.threshold&&(s.compress=!1)}try{a["d"]?this.ws.send(e):this.ws.send(e,s)}catch(r){}n&&Object(a["c"])(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=Object(r["a"])()),this.supportsBinary||(t.b64=1);const i=Object(n["b"])(t),o=-1!==this.opts.hostname.indexOf(":");return e+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}check(){return!!a["a"]}}}).call(this,s("b639").Buffer)},"1fb5":function(t,e,s){"use strict";e.byteLength=u,e.toByteArray=f,e.fromByteArray=g;for(var i=[],n=[],r="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,h=o.length;a<h;++a)i[a]=o[a],n[o.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=t.indexOf("=");-1===s&&(s=e);var i=s===e?0:4-s%4;return[s,i]}function u(t){var e=c(t),s=e[0],i=e[1];return 3*(s+i)/4-i}function l(t,e,s){return 3*(e+s)/4-s}function f(t){var e,s,i=c(t),o=i[0],a=i[1],h=new r(l(t,o,a)),u=0,f=a>0?o-4:o;for(s=0;s<f;s+=4)e=n[t.charCodeAt(s)]<<18|n[t.charCodeAt(s+1)]<<12|n[t.charCodeAt(s+2)]<<6|n[t.charCodeAt(s+3)],h[u++]=e>>16&255,h[u++]=e>>8&255,h[u++]=255&e;return 2===a&&(e=n[t.charCodeAt(s)]<<2|n[t.charCodeAt(s+1)]>>4,h[u++]=255&e),1===a&&(e=n[t.charCodeAt(s)]<<10|n[t.charCodeAt(s+1)]<<4|n[t.charCodeAt(s+2)]>>2,h[u++]=e>>8&255,h[u++]=255&e),h}function d(t){return i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}function p(t,e,s){for(var i,n=[],r=e;r<s;r+=3)i=(t[r]<<16&16711680)+(t[r+1]<<8&65280)+(255&t[r+2]),n.push(d(i));return n.join("")}function g(t){for(var e,s=t.length,n=s%3,r=[],o=16383,a=0,h=s-n;a<h;a+=o)r.push(p(t,a,a+o>h?h:a+o));return 1===n?(e=t[s-1],r.push(i[e>>2]+i[e<<4&63]+"==")):2===n&&(e=(t[s-2]<<8)+t[s-1],r.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"=")),r.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},"20a4":function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));const i=(()=>"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")())()},"29c2":function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));const i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),n=64,r={};let o,a=0,h=0;function c(t){let e="";do{e=i[t%n]+e,t=Math.floor(t/n)}while(t>0);return e}function u(){const t=c(+new Date);return t!==o?(a=0,o=t):t+"."+c(a++)}for(;h<n;h++)r[i[h]]=h},"2d28":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"self-chat"},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"info"},[t.time?e("div",{staticClass:"time"},[t._v(t._s(t.formatPostTime(t.time)))]):t._e(),e("level-nickname",{attrs:{colors:t.levelLabel.color,uid:t.user.uid,nickname:t.user.nickname}})],1),e("div",{staticClass:"content-wrapper"},[e("div",{staticClass:"message-content",style:t.bubbleStyle},[e("div",{domProps:{innerHTML:t._s(t.message.content)}}),t.hide?t._e():e("el-popover",{attrs:{placement:"top-end",width:"50",trigger:"click","popper-class":"chat-popper"}},[e("ul",{staticClass:"operation-actions"},t._l(t.operations,(function(s){return e("li",{key:s.id,staticClass:"action",on:{click:function(e){return t.setAction(s)}}},[e("div",[e("i",{class:s.icon}),t._v(" "+t._s(s.text))])])})),0),e("div",{staticClass:"operations",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"hanser icon-gengduo"})])])],1),e("div",{staticClass:"cart",style:t.cartStyle}),e("div",{staticClass:"avatar"},[e("avatar",{attrs:{avatar:t.user.avatar,size:40,iconSize:14,auth:t.user.auth,authentication:t.user.authentication,nickname:t.user.name}})],1)])])])},n=[],r=s("e100"),o=s("c450"),a=s("e51f"),h={name:"self-chat",props:["user","levels","hide","message","time"],components:{Avatar:o["a"],LevelNickname:a["a"]},data(){return{operations:[{id:1,text:"撤回",icon:"iconfont chehui",event:"withdraw"}]}},methods:{formatPostTime:r["a"],setAction(t){this.$emit(t.event,this.message.id)}},computed:{bubbleStyle(){return"background-color: var(--theme-chat-self-bubble-bg-color)"},cartStyle(){return"border-left-color: var(--theme-chat-self-bubble-bg-color);"},level(){const t=this.user.exp||0;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t}}},c=h,u=(s("025a"),s("38fd"),s("2877")),l=Object(u["a"])(c,i,n,!1,null,"3f1574f2",null);e["a"]=l.exports},3268:function(t,e,s){},"33e8":function(t,e,s){"use strict";s.d(e,"e",(function(){return _})),s.d(e,"c",(function(){return l})),s.d(e,"d",(function(){return C})),s.d(e,"a",(function(){return b})),s.d(e,"b",(function(){return k}));const i=Object.create(null);i["open"]="0",i["close"]="1",i["ping"]="2",i["pong"]="3",i["message"]="4",i["upgrade"]="5",i["noop"]="6";const n=Object.create(null);Object.keys(i).forEach(t=>{n[i[t]]=t});const r={type:"error",data:"parser error"},o="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"===typeof ArrayBuffer,h=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,c=({type:t,data:e},s,n)=>o&&e instanceof Blob?s?n(e):u(e,n):a&&(e instanceof ArrayBuffer||h(e))?s?n(e):u(new Blob([e]),n):n(i[t]+(e||"")),u=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+t)},s.readAsDataURL(t)};var l=c;const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let E=0;E<f.length;E++)d[f.charCodeAt(E)]=E;const p=t=>{let e,s,i,n,r,o=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<a;e+=4)s=d[t.charCodeAt(e)],i=d[t.charCodeAt(e+1)],n=d[t.charCodeAt(e+2)],r=d[t.charCodeAt(e+3)],u[h++]=s<<2|i>>4,u[h++]=(15&i)<<4|n>>2,u[h++]=(3&n)<<6|63&r;return c},g="function"===typeof ArrayBuffer,m=(t,e)=>{if("string"!==typeof t)return{type:"message",data:v(t,e)};const s=t.charAt(0);if("b"===s)return{type:"message",data:y(t.substring(1),e)};const i=n[s];return i?t.length>1?{type:n[s],data:t.substring(1)}:{type:n[s]}:r},y=(t,e)=>{if(g){const s=p(t);return v(s,e)}return{base64:!0,data:t}},v=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};var b=m;const w=String.fromCharCode(30),C=(t,e)=>{const s=t.length,i=new Array(s);let n=0;t.forEach((t,r)=>{l(t,!1,t=>{i[r]=t,++n===s&&e(i.join(w))})})},k=(t,e)=>{const s=t.split(w),i=[];for(let n=0;n<s.length;n++){const t=b(s[n],e);if(i.push(t),"error"===t.type)break}return i},_=4},"34ba":function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("33e8"),n=s("b007"),r=s("af7f");class o extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class a extends n["a"]{constructor(t){super(),this.writable=!1,Object(r["b"])(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new o(t,e,s)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Object(i["a"])(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}},"38fd":function(t,e,s){"use strict";s("1332")},"39bc":function(t,e,s){"use strict";s("5d40")},"3c65":function(t,e,s){"use strict";var i=s("23e7"),n=s("7b0b"),r=s("07fa"),o=s("3a34"),a=s("083a"),h=s("3511"),c=1!==[].unshift(0),u=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:c||u},{unshift:function(t){var e=n(this),s=r(e),i=arguments.length;if(i){h(s+i);var c=s;while(c--){var u=c+i;c in e?e[u]=e[c]:a(e,u)}for(var l=0;l<i;l++)e[l]=arguments[l]}return o(e,s+i)}})},5185:function(t,e,s){"use strict";s("3268")},"5d40":function(t,e,s){},"744a":function(t,e,s){"use strict";s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return r})),s.d(e,"d",(function(){return o})),s.d(e,"b",(function(){return a}));var i=s("20a4");const n=(()=>{const t="function"===typeof Promise&&"function"===typeof Promise.resolve;return t?t=>Promise.resolve().then(t):(t,e)=>e(t,0)})(),r=i["a"].WebSocket||i["a"].MozWebSocket,o=!0,a="arraybuffer"},7846:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.chatVisible,expression:"chatVisible"}],staticClass:"chats"},[e("div",{staticClass:"chats-wrapper"},[e("div",{staticClass:"chats-window"},[e("div",{staticClass:"side-menu"},[e("div",{staticClass:"side-menu--top"},[e("i",{staticClass:"iconfont bg-close",on:{click:t.closeChat}})]),e("div",{staticClass:"side-menu--bottom",on:{click:t.createNewChat}},[e("div",{staticClass:"create-chat"},[t._v("+")])])]),e("div",{staticClass:"chat-list",style:t.mobileChatListStyle},[e("div",{staticClass:"search"},[t.isMobile?e("div",{staticClass:"back",on:{click:t.closeChat}},[e("i",{staticClass:"hanser icon-zuohuadong"})]):t._e(),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchUser,expression:"searchUser"}],staticClass:"search-input",attrs:{placeholder:"搜索用户名"},domProps:{value:t.searchUser},on:{input:function(e){e.target.composing||(t.searchUser=e.target.value)}}}),t.isMobile?e("div",{staticClass:"create-chat--mobile",on:{click:t.createNewChat}},[t._v("+")]):t._e()]),e("div",{staticClass:"chat-user--wrapper"},t._l(t.chatUserList,(function(s){return e("div",{key:s.user.uid,staticClass:"chat-user",class:{"current-chat":s.user.uid===t.chatingUid},on:{click:function(e){return t.openChat(s)}}},[e("div",{staticClass:"close",on:{click:function(e){return e.stopPropagation(),t.deleteSession(s.user.uid)}}},[e("i",{staticClass:"iconfont bg-close"})]),e("div",{staticClass:"user-info"},[e("div",{staticClass:"avatar"},[e("avatar",{attrs:{size:40,iconSize:14,avatar:s.user.avatar,auth:s.user.auth,authentication:s.user.authentication,nickname:s.user.nickname}})],1),e("div",{staticClass:"user-community--info"},[e("p",{staticClass:"nickname"},[t._v(" "+t._s(s.user.nickname)+" ")]),e("p",{staticClass:"last-message"},[t._v(t._s(s.lastMessage))])])]),e("div",{staticClass:"time-and-unread"},[e("div",{staticClass:"time"},[t._v(t._s(t.formatPostTime(s.time)))]),e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:s.unread,expression:"chat.unread"}],staticClass:"unread"},[t._v(t._s(s.unread))])])])])})),0),t.chatUserList.length?t._e():e("div",{staticClass:"no-data"},[t._v("暂无会话")])]),e("div",{staticClass:"chating-user",style:t.mobileChatUserStyle},[t.chatingUid?e("div",{staticClass:"chating-window"},[e("div",{staticClass:"chating-window--top"},[e("div",{staticClass:"username"},[t.isMobile?e("div",{staticClass:"back",on:{click:t.closeSession}},[e("i",{staticClass:"hanser icon-zuohuadong"})]):t._e(),e("span",[t._v(t._s(t.chatingUser.user.nickname))])]),t._m(0)]),e("div",{staticClass:"content-and-editor"},[e("div",{ref:"chating-window--content",staticClass:"chating-window--content",on:{scroll:t.messageScroll}},[t.messageLoadDone?t._e():e("div",{ref:"load-more",staticClass:"load-more"},[e("i",{staticClass:"el-icon-loading"})]),t._l(t.chatingMessage,(function(s){return["time"===s.type?e("div",{key:s.id,staticClass:"message-time"},[t._v(" "+t._s(t.formatPostTime(s.time,!0))+" ")]):s.from===t.user.uid?e("self-chat",{key:s.id+"self",ref:"chat"+s.id,refInFor:!0,class:"chat"+s.id,attrs:{user:t.myUserInfo,message:s,levels:t.levels,time:s.time,hide:!0}}):s.from===t.chatingUid?e("other-chat",{key:s.id+"other",ref:"chat"+s.id,refInFor:!0,class:"chat"+s.id,attrs:{user:t.otherUserInfo,message:s,levels:t.levels,time:s.time,hide:!0}}):t._e()]}))],2),e("div",{staticClass:"chating-window--editor",style:t.heightStyle},[e("div",{staticClass:"expand-input",style:t.rotateStyle,on:{click:t.expandInput}},[e("i",{staticClass:"hanser icon-fanhuidingduan"})]),t.newUnread?e("div",{staticClass:"new-unread",on:{click:t.toNewUnread}},[t._v(" 有"+t._s(t.newUnread)+"条新消息 ")]):t._e(),e("editor",{ref:"editor",staticClass:"post-editor",attrs:{height:t.inputHeight},on:{post:t.sendChat}})],1)])]):e("div",{staticClass:"no-selected-chating"})])])]),t.showCreateChat?e("div",{staticClass:"new-chat--creator"},[e("div",{staticClass:"new-chat--creator__wrapper"},[e("div",{staticClass:"search-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchCreateUser,expression:"searchCreateUser"}],staticClass:"search-input create-search-input",attrs:{placeholder:"搜索用户名或UID"},domProps:{value:t.searchCreateUser},on:{input:function(e){e.target.composing||(t.searchCreateUser=e.target.value)}}}),e("h-button",{attrs:{size:"small"},on:{click:t.searchChatUser}},[t._v("搜索")])],1),e("div",{staticClass:"user-to-create"},t._l(t.searchCreateList,(function(s){return e("div",{key:s.uid,staticClass:"user",class:{"user-active":s.uid===t.chatToCreate},on:{click:function(e){return t.setChatToCreate(s)}}},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:s.avatar,width:"40",height:"40",alt:s.nickname}})]),e("div",{staticClass:"nickname"},[t._v(t._s(s.nickname))])])})),0),e("div",{staticClass:"operation"},[e("h-button",{attrs:{plain:"",size:"small"},on:{click:t.closeCreateChat}},[t._v("取消")]),e("h-button",{attrs:{size:"small"},on:{click:t.createNewUserChat}},[t._v("创建聊天")])],1)])]):t._e()])},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"expand"},[e("i",{staticClass:"hanser icon-gengduo"})])}],r=(s("14d9"),s("3c65"),s("db04")),o=s("365c"),a=s("d800"),h=s("2f62"),c=s("e914"),u=s("ed08"),l=s.n(u),f=s("c450"),d=s("e100"),p=s("daa8"),g=s("be6f"),m=s("2d28"),y=s("97f6"),v=s("d43c"),b=s("dbbe"),w={name:"chats",data(){return{chatVisible:!1,chatList:[],chatingUid:0,searchUser:"",inputHeight:100,socket:null,chatingMessage:[],messageLoadDone:!1,chatWin:null,newUnread:0,timer:null,token:"",showCreateChat:!1,searchCreateUser:"",searchCreateList:[],chatToCreate:0}},components:{Editor:c["a"],SelfChat:m["a"],OtherChat:y["a"],HButton:b["a"],Avatar:f["a"]},methods:{formatPostTime:d["a"],...Object(h["c"])({setNotice:"notice/setNotice"}),showChat(){this.getChatList()},createNewChat(){this.showCreateChat=!0},closeChat(){this.chatVisible=!1,this.chatingUid=0,this.socket&&(this.socket.disconnect(),this.socket=null),this.updateNotice()},openChat(t){this.chatingUid=t.user.uid,t.unread=0},searchChatUser(){this.searchCreateUser?(this.chatToCreate=0,r["a"].get(o["a"].searchUser,{params:{keyword:this.searchCreateUser}}).then(t=>{0===t.code&&(this.searchCreateList=t.list)})):this.$message({type:"warning",message:"请输入搜索内容"})},closeCreateChat(){this.showCreateChat=!1,this.searchCreateUser="",this.searchCreateList=[]},setChatToCreate(t){this.chatToCreate=t.uid},async createNewUserChat(){if(!this.chatToCreate)return void this.$message({type:"warning",message:"请选择要创建的聊天对象"});const t=await r["a"].post(a["a"].chatCreate,{uid:this.chatToCreate});0===t.code?(await this.getChatList(),this.chatingUid=this.chatToCreate,this.closeCreateChat()):this.$message({type:"warning",message:t.msg})},async getChatList(){const t=await r["a"].get(a["a"].chatList);0===t.code&&(this.chatList=t.list,this.searchUser="",this.token=t.token,this.socket||this.linkToChat(),this.chatVisible=!0)},sendChat(t){this.$refs["editor"].clear(),this.socket.emit("send-message-"+this.user.uid,this.chatingUid,t)},expandInput(){this.inputHeight=200-this.inputHeight+100},closeSession(){this.chatingUid=0},locateToBottom(){this.chatWin&&(this.chatWin.scrollTop=this.chatWin.scrollHeight+10)},linkToChat(){this.socket=Object(p["a"])(`${g.PROTOCAL}://${g.IP}/personal`,{reconnectionDelayMax:1e4,path:"/socket.io",transports:["websocket"],secure:!0,auth:{token:this.token,uid:this.user.uid}}),this.socket.on("close"+this.user.uid,()=>{this.socket.disconnect()}),this.socket.on("disconnect",()=>{console.log("disconnect")}),this.chatingUser&&this.socket.emit("update-chating",this.chatingUid),this.socket.on("update-chating-"+this.user.uid,t=>{this.chatingUid!==t&&(this.chatingUid=t)}),this.socket.on("exception-"+this.user.uid,t=>{this.$alert(t,"提示",{type:"error"})}),this.socket.on("receive-message-"+this.user.uid,async t=>{if(t.from===this.chatingUid||t.to===this.chatingUid){this.chatingMessage.push({content:t.content,from:t.from,id:t.id,status:0,time:t.time,to:t.to,type:0});const e=this.chatList.find(e=>e.user.uid===t.from||e.user.uid===t.to);if(e.time=t.time,e.lastMessage=t.briefContent,e.unread=0,this.chatingUid){await this.$nextTick();const e=document.getElementsByClassName("chat"+t.id)[0];if(e){const t=e.getElementsByClassName("message-content")[0].getElementsByTagName("img"),s=[...t].map(t=>t.src);s.length&&await l.a.imagesLoadDone(s)}const s=this.chatWin.scrollHeight-this.chatWin.scrollTop-this.chatWin.clientHeight-e.clientHeight-40;s<10?this.locateToBottom():this.newUnread++}}else{const e=this.chatList.find(e=>e.user.uid===t.from||t.to===e.user.uid);if(e)e.time=t.time,e.lastMessage=t.briefContent,e.unread+=1;else{const e=await r["a"].get(o["a"].getUserInfo,{params:{uid:t.from}});this.chatList.unshift({isTop:!1,lastMessage:t.briefContent,time:t.time,unread:1,user:{avatar:e.info.avatar,exp:e.info.exp,nickname:e.info.nickname,uid:t.from}})}}})},async getChatingMessage(){const t=await r["a"].get(a["a"].chatHistory,{params:{id:this.lastMessageId,uid:this.chatingUid}});if(0===t.code){var e;const s=(null===(e=this.chatingMessage[0])||void 0===e?void 0:e.id)||0;if(this.chatingMessage.unshift(...t.list),t.list.length<20&&(this.messageLoadDone=!0),this.chatingMessage.length===t.list.length){if(await this.$nextTick(),this.chatWin=document.getElementsByClassName("chating-window--content")[0],this.chatWin){const t=this.chatWin.getElementsByTagName("img"),e=[...t].map(t=>t.src);await l.a.imagesLoadDone(e),this.locateToBottom()}if(!this.messageLoadDone){const t=new IntersectionObserver(t=>{t[0].intersectionRatio&&(this.messageLoadDone||this.getChatingMessage())}),e=this.$refs["load-more"];t.observe(e)}}else{await this.$nextTick();const t=document.getElementsByClassName("chat"+s)[0];t.scrollIntoView()}}},messageScroll(){this.timer||(this.timer=setTimeout(()=>{const t=this.chatWin.scrollHeight-this.chatWin.scrollTop-this.chatWin.clientHeight-40;t<10?(this.newUnread=0,clearTimeout(this.timer),this.timer=null):(clearTimeout(this.timer),this.timer=null,this.messageScroll())},200))},toNewUnread(){this.newUnread=0,this.locateToBottom()},deleteSession(t){r["a"].post(a["a"].deleteChat,{uid:t}).then(e=>{0===e.code&&(this.chatList=this.chatList.filter(e=>e.user.uid!==t))})},updateNotice(){r["a"].get(o["a"].noticeCount).then(t=>{0===t.code&&this.setNotice(t.count)})},getNewestChat(){this.chatingUid&&(this.chatingMessage.length?r["a"].get(a["a"].newestChats,{params:{uid:this.chatingUid,id:this.chatingMessage.slice(-1)[0].id}}).then(async t=>{0===t.code&&t.list.length&&(this.chatingMessage.push(...t.list),await this.$nextTick(),this.locateToBottom(),this.socket.emit("update-chating",this.chatingUid))}):this.getChatingMessage())}},mounted(){window.addEventListener("open-chat",async t=>{if(0!==this.user.status)return void this.$message({type:"warning",message:"封禁后无法使用私信"});if(!t.detail.uid)return void this.getChatList();if(t.detail.uid===this.user.uid)return void this.$message({type:"warning",message:"无法私聊自己"});const e=await r["a"].post(a["a"].chatCreate,{uid:t.detail.uid});0===e.code?(await this.getChatList(),this.chatingUid=Number(t.detail.uid)):this.$message({type:"warning",message:e.msg})}),v["a"].addEventListener("statechange",t=>{"passive"!=t.oldState&&"active"!=t.oldState||"hidden"!=t.newState||!this.socket?"hidden"!=t.oldState||"passive"!=t.newState&&"active"!==t.newState||!this.chatVisible||(this.getChatList(),this.socket.connect(),this.getNewestChat()):this.socket.disconnect()})},beforeDestroy(){this.socket&&this.socket.disconnect()},computed:{...Object(h["d"])({user:t=>t.users.userInfo,levels:t=>t.level.levels,isMobile:t=>t.media.isMobile}),isLogin(){return!!this.user.uid},chatUserList(){return this.searchUser?this.chatList.filter(t=>t.user.nickname.includes(this.searchUser)):this.chatList},chatingUser(){const t={user:{uid:0,nickname:""}};return this.chatingUid&&this.chatList.length&&this.chatList.find(t=>t.user.uid===this.chatingUid)||t},heightStyle(){return`height: ${this.inputHeight+100}px`},rotateStyle(){return`transform: rotate(${180*(this.inputHeight>>7&1)}deg)`},mobileChatListStyle(){return this.isMobile?this.chatingUid?"display: none":"display: block; width: 100%;":""},mobileChatUserStyle(){return this.isMobile?this.chatingUid?"display: block":"display: none":""},myUserInfo(){return{uid:this.user.uid,nickname:this.user.nickname,avatar:this.user.avatar,auth:this.user.auth,authentication:this.user.authentication}},otherUserInfo(){const t=this.chatList.find(t=>t.user.uid===this.chatingUid);return{uid:t.user.uid,nickname:t.user.nickname,avatar:t.user.avatar,auth:t.user.auth,authentication:t.user.authentication}},lastMessageId(){return this.chatingMessage.length?this.chatingMessage[0].id:0}},watch:{async chatingUid(t){var e;this.inputHeight=100,this.chatingMessage=[],this.messageLoadDone=!1,this.newUnread=0,null===(e=this.$refs["editor"])||void 0===e||e.clear(),this.chatVisible&&t&&(this.socket&&this.socket.emit("update-chating",this.chatingUid),await this.getChatingMessage())}}},C=w,k=(s("b324"),s("2877")),_=Object(k["a"])(C,i,n,!1,null,"13fdcf28",null);e["a"]=_.exports},8343:function(t,e,s){"use strict";s("e791")},9152:function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,s,i,n){var r,o,a=8*n-i-1,h=(1<<a)-1,c=h>>1,u=-7,l=s?n-1:0,f=s?-1:1,d=t[e+l];for(l+=f,r=d&(1<<-u)-1,d>>=-u,u+=a;u>0;r=256*r+t[e+l],l+=f,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=i;u>0;o=256*o+t[e+l],l+=f,u-=8);if(0===r)r=1-c;else{if(r===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),r-=c}return(d?-1:1)*o*Math.pow(2,r-i)},e.write=function(t,e,s,i,n,r){var o,a,h,c=8*r-n-1,u=(1<<c)-1,l=u>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:r-1,p=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),e+=o+l>=1?f/h:f*Math.pow(2,1-l),e*h>=2&&(o++,h/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(e*h-1)*Math.pow(2,n),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;t[s+d]=255&a,d+=p,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;t[s+d]=255&o,d+=p,o/=256,c-=8);t[s+d-p]|=128*g}},"97f6":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"other-chat"},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"info"},[e("level-nickname",{attrs:{colors:t.levelLabel.color,uid:t.user.uid,nickname:t.user.nickname}}),t.time?e("div",{staticClass:"time"},[t._v(t._s(t.formatPostTime(t.time)))]):t._e()],1),e("div",{staticClass:"content-wrapper"},[e("div",{staticClass:"avatar"},[e("avatar",{attrs:{avatar:t.user.avatar,size:40,iconSize:14,auth:t.user.auth,authentication:t.user.authentication,nickname:t.user.name}})],1),e("div",{staticClass:"cart",style:t.cartStyle}),e("div",{staticClass:"message-content",style:t.bubbleStyle},[e("div",{domProps:{innerHTML:t._s(t.message.content)}}),t.operations.length&&!t.hide?e("el-popover",{attrs:{placement:"top-start",width:"50",trigger:"click","popper-class":"chat-popper"}},[e("ul",{staticClass:"operation-actions"},t._l(t.operations,(function(s){return e("li",{key:s.id,staticClass:"action",on:{click:function(e){return t.setAction(s)}}},[e("div",[e("i",{class:s.icon}),t._v(" "+t._s(s.text))])])})),0),e("div",{staticClass:"operations",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"hanser icon-gengduo"})])]):t._e()],1)])])])},n=[],r=s("e100"),o=s("c450"),a=s("e51f"),h={name:"other-chat",props:["user","isAdmin","levels","hide","message","time"],components:{Avatar:o["a"],LevelNickname:a["a"]},methods:{formatPostTime:r["a"],setAction(t){this.$emit(t.event,this.message.id)}},computed:{bubbleStyle(){return"background-color: var(--theme-chat-other-bubble-bg-color)"},cartStyle(){return"border-right-color: var(--theme-chat-other-bubble-bg-color);"},operations(){return this.isAdmin?[{id:1,text:"撤回",icon:"iconfont chehui",event:"withdraw"}]:[]},level(){const t=this.user.exp||0;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t}}},c=h,u=(s("8343"),s("2877")),l=Object(u["a"])(c,i,n,!1,null,"7ac22574",null);e["a"]=l.exports},"99ea":function(t,e,s){"use strict";function i(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}function n(t){let e={},s=t.split("&");for(let i=0,n=s.length;i<n;i++){let t=s[i].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}s.d(e,"b",(function(){return i})),s.d(e,"a",(function(){return n}))},af7f:function(t,e,s){"use strict";s.d(e,"c",(function(){return n})),s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return c}));var i=s("20a4");function n(t,...e){return e.reduce((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e),{})}const r=setTimeout,o=clearTimeout;function a(t,e){e.useNativeTimers?(t.setTimeoutFn=r.bind(i["a"]),t.clearTimeoutFn=o.bind(i["a"])):(t.setTimeoutFn=setTimeout.bind(i["a"]),t.clearTimeoutFn=clearTimeout.bind(i["a"]))}const h=1.33;function c(t){return"string"===typeof t?u(t):Math.ceil((t.byteLength||t.size)*h)}function u(t){let e=0,s=0;for(let i=0,n=t.length;i<n;i++)e=t.charCodeAt(i),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(i++,s+=4);return s}},b007:function(t,e,s){"use strict";function i(t){if(t)return n(t)}function n(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}s.d(e,"a",(function(){return i})),i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},i.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<i.length;n++)if(s=i[n],s===e||s.fn===e){i.splice(n,1);break}return 0===i.length&&delete this._callbacks["$"+t],this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){s=s.slice(0);i=0;for(var n=s.length;i<n;++i)s[i].apply(this,e)}return this},i.prototype.emitReserved=i.prototype.emit,i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}},b324:function(t,e,s){"use strict";s("c2b0")},b639:function(t,e,s){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var i=s("1fb5"),n=s("9152"),r=s("e3db");function o(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"===typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=c.prototype):(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,s){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(t,e,s);if("number"===typeof t){if("string"===typeof e)throw new Error("If encoding is specified then the first argument must be a string");return d(this,t)}return u(this,t,e,s)}function u(t,e,s,i){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer?m(t,e,s,i):"string"===typeof e?p(t,e,s):y(t,e)}function l(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e,s,i){return l(e),e<=0?h(t,e):void 0!==s?"string"===typeof i?h(t,e).fill(s,i):h(t,e).fill(s):h(t,e)}function d(t,e){if(l(e),t=h(t,e<0?0:0|v(e)),!c.TYPED_ARRAY_SUPPORT)for(var s=0;s<e;++s)t[s]=0;return t}function p(t,e,s){if("string"===typeof s&&""!==s||(s="utf8"),!c.isEncoding(s))throw new TypeError('"encoding" must be a valid string encoding');var i=0|w(e,s);t=h(t,i);var n=t.write(e,s);return n!==i&&(t=t.slice(0,n)),t}function g(t,e){var s=e.length<0?0:0|v(e.length);t=h(t,s);for(var i=0;i<s;i+=1)t[i]=255&e[i];return t}function m(t,e,s,i){if(e.byteLength,s<0||e.byteLength<s)throw new RangeError("'offset' is out of bounds");if(e.byteLength<s+(i||0))throw new RangeError("'length' is out of bounds");return e=void 0===s&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,s):new Uint8Array(e,s,i),c.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=c.prototype):t=g(t,e),t}function y(t,e){if(c.isBuffer(e)){var s=0|v(e.length);return t=h(t,s),0===t.length?t:(e.copy(t,0,0,s),t)}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!==typeof e.length||et(e.length)?h(t,0):g(t,e);if("Buffer"===e.type&&r(e.data))return g(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function b(t){return+t!=t&&(t=0),c.alloc(+t)}function w(t,e){if(c.isBuffer(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var s=t.length;if(0===s)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":case void 0:return X(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return Q(t).length;default:if(i)return X(t).length;e=(""+e).toLowerCase(),i=!0}}function C(t,e,s){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if(s>>>=0,e>>>=0,s<=e)return"";t||(t="utf8");while(1)switch(t){case"hex":return M(this,e,s);case"utf8":case"utf-8":return U(this,e,s);case"ascii":return N(this,e,s);case"latin1":case"binary":return I(this,e,s);case"base64":return L(this,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,s);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function k(t,e,s){var i=t[e];t[e]=t[s],t[s]=i}function _(t,e,s,i,n){if(0===t.length)return-1;if("string"===typeof s?(i=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,isNaN(s)&&(s=n?0:t.length-1),s<0&&(s=t.length+s),s>=t.length){if(n)return-1;s=t.length-1}else if(s<0){if(!n)return-1;s=0}if("string"===typeof e&&(e=c.from(e,i)),c.isBuffer(e))return 0===e.length?-1:E(t,e,s,i,n);if("number"===typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,s):Uint8Array.prototype.lastIndexOf.call(t,e,s):E(t,[e],s,i,n);throw new TypeError("val must be string, number or Buffer")}function E(t,e,s,i,n){var r,o=1,a=t.length,h=e.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,s/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var u=-1;for(r=s;r<a;r++)if(c(t,r)===c(e,-1===u?0:r-u)){if(-1===u&&(u=r),r-u+1===h)return u*o}else-1!==u&&(r-=r-u),u=-1}else for(s+h>a&&(s=a-h),r=s;r>=0;r--){for(var l=!0,f=0;f<h;f++)if(c(t,r+f)!==c(e,f)){l=!1;break}if(l)return r}return-1}function A(t,e,s,i){s=Number(s)||0;var n=t.length-s;i?(i=Number(i),i>n&&(i=n)):i=n;var r=e.length;if(r%2!==0)throw new TypeError("Invalid hex string");i>r/2&&(i=r/2);for(var o=0;o<i;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[s+o]=a}return o}function T(t,e,s,i){return tt(X(e,t.length-s),t,s,i)}function R(t,e,s,i){return tt(G(e),t,s,i)}function O(t,e,s,i){return R(t,e,s,i)}function S(t,e,s,i){return tt(Q(e),t,s,i)}function B(t,e,s,i){return tt(Z(e,t.length-s),t,s,i)}function L(t,e,s){return 0===e&&s===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,s))}function U(t,e,s){s=Math.min(t.length,s);var i=[],n=e;while(n<s){var r,o,a,h,c=t[n],u=null,l=c>239?4:c>223?3:c>191?2:1;if(n+l<=s)switch(l){case 1:c<128&&(u=c);break;case 2:r=t[n+1],128===(192&r)&&(h=(31&c)<<6|63&r,h>127&&(u=h));break;case 3:r=t[n+1],o=t[n+2],128===(192&r)&&128===(192&o)&&(h=(15&c)<<12|(63&r)<<6|63&o,h>2047&&(h<55296||h>57343)&&(u=h));break;case 4:r=t[n+1],o=t[n+2],a=t[n+3],128===(192&r)&&128===(192&o)&&128===(192&a)&&(h=(15&c)<<18|(63&r)<<12|(63&o)<<6|63&a,h>65535&&h<1114112&&(u=h))}null===u?(u=65533,l=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),n+=l}return x(i)}e.Buffer=c,e.SlowBuffer=b,e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:o(),e.kMaxLength=a(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,s){return u(null,t,e,s)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,s){return f(null,t,e,s)},c.allocUnsafe=function(t){return d(null,t)},c.allocUnsafeSlow=function(t){return d(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var s=t.length,i=e.length,n=0,r=Math.min(s,i);n<r;++n)if(t[n]!==e[n]){s=t[n],i=e[n];break}return s<i?-1:i<s?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!r(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var s;if(void 0===e)for(e=0,s=0;s<t.length;++s)e+=t[s].length;var i=c.allocUnsafe(e),n=0;for(s=0;s<t.length;++s){var o=t[s];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n),n+=o.length}return i},c.byteLength=w,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)k(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)k(this,e,e+3),k(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)k(this,e,e+7),k(this,e+1,e+6),k(this,e+2,e+5),k(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?U(this,0,t):C.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",s=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,s,i,n){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===s&&(s=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||s>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=s)return 0;if(i>=n)return-1;if(e>=s)return 1;if(e>>>=0,s>>>=0,i>>>=0,n>>>=0,this===t)return 0;for(var r=n-i,o=s-e,a=Math.min(r,o),h=this.slice(i,n),u=t.slice(e,s),l=0;l<a;++l)if(h[l]!==u[l]){r=h[l],o=u[l];break}return r<o?-1:o<r?1:0},c.prototype.includes=function(t,e,s){return-1!==this.indexOf(t,e,s)},c.prototype.indexOf=function(t,e,s){return _(this,t,e,s,!0)},c.prototype.lastIndexOf=function(t,e,s){return _(this,t,e,s,!1)},c.prototype.write=function(t,e,s,i){if(void 0===e)i="utf8",s=this.length,e=0;else if(void 0===s&&"string"===typeof e)i=e,s=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(s)?(s|=0,void 0===i&&(i="utf8")):(i=s,s=void 0)}var n=this.length-e;if((void 0===s||s>n)&&(s=n),t.length>0&&(s<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var r=!1;;)switch(i){case"hex":return A(this,t,e,s);case"utf8":case"utf-8":return T(this,t,e,s);case"ascii":return R(this,t,e,s);case"latin1":case"binary":return O(this,t,e,s);case"base64":return S(this,t,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,e,s);default:if(r)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),r=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function x(t){var e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);var s="",i=0;while(i<e)s+=String.fromCharCode.apply(String,t.slice(i,i+=P));return s}function N(t,e,s){var i="";s=Math.min(t.length,s);for(var n=e;n<s;++n)i+=String.fromCharCode(127&t[n]);return i}function I(t,e,s){var i="";s=Math.min(t.length,s);for(var n=e;n<s;++n)i+=String.fromCharCode(t[n]);return i}function M(t,e,s){var i=t.length;(!e||e<0)&&(e=0),(!s||s<0||s>i)&&(s=i);for(var n="",r=e;r<s;++r)n+=J(t[r]);return n}function D(t,e,s){for(var i=t.slice(e,s),n="",r=0;r<i.length;r+=2)n+=String.fromCharCode(i[r]+256*i[r+1]);return n}function j(t,e,s){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>s)throw new RangeError("Trying to access beyond buffer length")}function Y(t,e,s,i,n,r){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<r)throw new RangeError('"value" argument is out of bounds');if(s+i>t.length)throw new RangeError("Index out of range")}function q(t,e,s,i){e<0&&(e=65535+e+1);for(var n=0,r=Math.min(t.length-s,2);n<r;++n)t[s+n]=(e&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function H(t,e,s,i){e<0&&(e=4294967295+e+1);for(var n=0,r=Math.min(t.length-s,4);n<r;++n)t[s+n]=e>>>8*(i?n:3-n)&255}function F(t,e,s,i,n,r){if(s+i>t.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function $(t,e,s,i,r){return r||F(t,e,s,4,34028234663852886e22,-34028234663852886e22),n.write(t,e,s,i,23,4),s+4}function z(t,e,s,i,r){return r||F(t,e,s,8,17976931348623157e292,-17976931348623157e292),n.write(t,e,s,i,52,8),s+8}c.prototype.slice=function(t,e){var s,i=this.length;if(t=~~t,e=void 0===e?i:~~e,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)s=this.subarray(t,e),s.__proto__=c.prototype;else{var n=e-t;s=new c(n,void 0);for(var r=0;r<n;++r)s[r]=this[r+t]}return s},c.prototype.readUIntLE=function(t,e,s){t|=0,e|=0,s||j(t,e,this.length);var i=this[t],n=1,r=0;while(++r<e&&(n*=256))i+=this[t+r]*n;return i},c.prototype.readUIntBE=function(t,e,s){t|=0,e|=0,s||j(t,e,this.length);var i=this[t+--e],n=1;while(e>0&&(n*=256))i+=this[t+--e]*n;return i},c.prototype.readUInt8=function(t,e){return e||j(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||j(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||j(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||j(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||j(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,s){t|=0,e|=0,s||j(t,e,this.length);var i=this[t],n=1,r=0;while(++r<e&&(n*=256))i+=this[t+r]*n;return n*=128,i>=n&&(i-=Math.pow(2,8*e)),i},c.prototype.readIntBE=function(t,e,s){t|=0,e|=0,s||j(t,e,this.length);var i=e,n=1,r=this[t+--i];while(i>0&&(n*=256))r+=this[t+--i]*n;return n*=128,r>=n&&(r-=Math.pow(2,8*e)),r},c.prototype.readInt8=function(t,e){return e||j(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||j(t,2,this.length);var s=this[t]|this[t+1]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt16BE=function(t,e){e||j(t,2,this.length);var s=this[t+1]|this[t]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt32LE=function(t,e){return e||j(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||j(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||j(t,4,this.length),n.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||j(t,4,this.length),n.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||j(t,8,this.length),n.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||j(t,8,this.length),n.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,s,i){if(t=+t,e|=0,s|=0,!i){var n=Math.pow(2,8*s)-1;Y(this,t,e,s,n,0)}var r=1,o=0;this[e]=255&t;while(++o<s&&(r*=256))this[e+o]=t/r&255;return e+s},c.prototype.writeUIntBE=function(t,e,s,i){if(t=+t,e|=0,s|=0,!i){var n=Math.pow(2,8*s)-1;Y(this,t,e,s,n,0)}var r=s-1,o=1;this[e+r]=255&t;while(--r>=0&&(o*=256))this[e+r]=t/o&255;return e+s},c.prototype.writeUInt8=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):q(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):q(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):H(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):H(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,s,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*s-1);Y(this,t,e,s,n-1,-n)}var r=0,o=1,a=0;this[e]=255&t;while(++r<s&&(o*=256))t<0&&0===a&&0!==this[e+r-1]&&(a=1),this[e+r]=(t/o>>0)-a&255;return e+s},c.prototype.writeIntBE=function(t,e,s,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*s-1);Y(this,t,e,s,n-1,-n)}var r=s-1,o=1,a=0;this[e+r]=255&t;while(--r>=0&&(o*=256))t<0&&0===a&&0!==this[e+r+1]&&(a=1),this[e+r]=(t/o>>0)-a&255;return e+s},c.prototype.writeInt8=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):q(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):q(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):H(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,s){return t=+t,e|=0,s||Y(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):H(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,s){return $(this,t,e,!0,s)},c.prototype.writeFloatBE=function(t,e,s){return $(this,t,e,!1,s)},c.prototype.writeDoubleLE=function(t,e,s){return z(this,t,e,!0,s)},c.prototype.writeDoubleBE=function(t,e,s){return z(this,t,e,!1,s)},c.prototype.copy=function(t,e,s,i){if(s||(s=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<s&&(i=s),i===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-s&&(i=t.length-e+s);var n,r=i-s;if(this===t&&s<e&&e<i)for(n=r-1;n>=0;--n)t[n+e]=this[n+s];else if(r<1e3||!c.TYPED_ARRAY_SUPPORT)for(n=0;n<r;++n)t[n+e]=this[n+s];else Uint8Array.prototype.set.call(t,this.subarray(s,s+r),e);return r},c.prototype.fill=function(t,e,s,i){if("string"===typeof t){if("string"===typeof e?(i=e,e=0,s=this.length):"string"===typeof s&&(i=s,s=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==i&&"string"!==typeof i)throw new TypeError("encoding must be a string");if("string"===typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"===typeof t&&(t&=255);if(e<0||this.length<e||this.length<s)throw new RangeError("Out of range index");if(s<=e)return this;var r;if(e>>>=0,s=void 0===s?this.length:s>>>0,t||(t=0),"number"===typeof t)for(r=e;r<s;++r)this[r]=t;else{var o=c.isBuffer(t)?t:X(new c(t,i).toString()),a=o.length;for(r=0;r<s-e;++r)this[r+e]=o[r%a]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function W(t){if(t=K(t).replace(V,""),t.length<2)return"";while(t.length%4!==0)t+="=";return t}function K(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function J(t){return t<16?"0"+t.toString(16):t.toString(16)}function X(t,e){var s;e=e||1/0;for(var i=t.length,n=null,r=[],o=0;o<i;++o){if(s=t.charCodeAt(o),s>55295&&s<57344){if(!n){if(s>56319){(e-=3)>-1&&r.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&r.push(239,191,189);continue}n=s;continue}if(s<56320){(e-=3)>-1&&r.push(239,191,189),n=s;continue}s=65536+(n-55296<<10|s-56320)}else n&&(e-=3)>-1&&r.push(239,191,189);if(n=null,s<128){if((e-=1)<0)break;r.push(s)}else if(s<2048){if((e-=2)<0)break;r.push(s>>6|192,63&s|128)}else if(s<65536){if((e-=3)<0)break;r.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;r.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return r}function G(t){for(var e=[],s=0;s<t.length;++s)e.push(255&t.charCodeAt(s));return e}function Z(t,e){for(var s,i,n,r=[],o=0;o<t.length;++o){if((e-=2)<0)break;s=t.charCodeAt(o),i=s>>8,n=s%256,r.push(n),r.push(i)}return r}function Q(t){return i.toByteArray(W(t))}function tt(t,e,s,i){for(var n=0;n<i;++n){if(n+s>=e.length||n>=t.length)break;e[n+s]=t[n]}return n}function et(t){return t!==t}}).call(this,s("c8ba"))},be6f:function(t){t.exports=JSON.parse('{"PROTOCAL":"https","IP":"2550505.com","PORT":2500,"BL_ROOM":13337778,"DY_ROOM":"3727854"}')},c2b0:function(t,e,s){},c973:function(t,e,s){},d800:function(t,e,s){"use strict";e["a"]={chatCreate:"/chat/create",chatList:"/chat/list",deleteChat:"/chat/delete",chatHistory:"/chat/history",newestChats:"/chat/chat-newest",groupMessageCount:"/chat/group-message-count",groupNewest:"/chat/group-newest",groupHistory:"/chat/group-history",groupTimeMessageChange:"/chat/group-time-message-change",showGroupMessage:"/chat/show-group-message"}},daa8:function(t,e,s){"use strict";s.d(e,"a",(function(){return G}));var i={};s.r(i),s.d(i,"protocol",(function(){return Y})),s.d(i,"PacketType",(function(){return q})),s.d(i,"Encoder",(function(){return H})),s.d(i,"Decoder",(function(){return F}));var n=s("34ba"),r=s("29c2"),o=s("99ea"),a=s("33e8");let h=!1;try{h="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Z){}const c=h;var u=s("20a4");function l(t){const e=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!e||c))return new XMLHttpRequest}catch(s){}if(!e)try{return new(u["a"][["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}var f=s("b007"),d=s("af7f");function p(){}const g=function(){const t=new l({xdomain:!1});return null!=t.responseType}();class m extends n["a"]{constructor(t){if(super(t),this.polling=!1,"undefined"!==typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?"443":"80"),this.xd="undefined"!==typeof location&&t.hostname!==location.hostname||s!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=g&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)};Object(a["b"])(t,this.socket.binaryType).forEach(e),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,Object(a["d"])(t,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Object(r["a"])()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const i=Object(o["b"])(t),n=-1!==this.opts.hostname.indexOf(":");return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new y(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",(t,e)=>{this.onError("xhr post error",t,e)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(t,e)=>{this.onError("xhr poll error",t,e)}),this.pollXhr=t}}class y extends f["a"]{constructor(t,e){super(),Object(d["b"])(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=Object(d["c"])(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new l(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(s){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{e.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"===typeof e.status?e.status:0)},0))},e.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}"undefined"!==typeof document&&(this.index=y.requestsCount++,y.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=p,t)try{this.xhr.abort()}catch(e){}"undefined"!==typeof document&&delete y.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(y.requestsCount=0,y.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",v);else if("function"===typeof addEventListener){const t="onpagehide"in u["a"]?"pagehide":"unload";addEventListener(t,v,!1)}function v(){for(let t in y.requests)y.requests.hasOwnProperty(t)&&y.requests[t].abort()}var b=s("1f49");const w={websocket:b["a"],polling:m},C=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,k=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _(t){const e=t,s=t.indexOf("["),i=t.indexOf("]");-1!=s&&-1!=i&&(t=t.substring(0,s)+t.substring(s,i).replace(/:/g,";")+t.substring(i,t.length));let n=C.exec(t||""),r={},o=14;while(o--)r[k[o]]=n[o]||"";return-1!=s&&-1!=i&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=E(r,r["path"]),r.queryKey=A(r,r["query"]),r}function E(t,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||i.splice(0,1),"/"==e.slice(-1)&&i.splice(i.length-1,1),i}function A(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(s[e]=i)})),s}class T extends f["a"]{constructor(t,e={}){super(),t&&"object"===typeof t&&(e=t,t=null),t?(t=_(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=_(e.host).host),Object(d["b"])(this,e),this.secure=null!=e.secure?e.secure:"undefined"!==typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"===typeof this.opts.query&&(this.opts.query=Object(o["a"])(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=a["e"],e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new w[t](s)}open(){let t;if(this.opts.rememberUpgrade&&T.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(t){let e=this.createTransport(t),s=!1;T.priorWebsocketSuccess=!1;const i=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",t=>{if(!s)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;T.priorWebsocketSuccess="websocket"===e.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(c(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}}))};function n(){s||(s=!0,c(),e.close(),e=null)}const r=t=>{const s=new Error("probe error: "+t);s.transport=e.name,n(),this.emitReserved("upgradeError",s)};function o(){r("transport closed")}function a(){r("socket closed")}function h(t){e&&t.name!==e.name&&n()}const c=()=>{e.removeListener("open",i),e.removeListener("error",r),e.removeListener("close",o),this.off("close",a),this.off("upgrading",h)};e.once("open",i),e.once("error",r),e.once("close",o),this.once("close",a),this.once("upgrading",h),e.open()}onOpen(){if(this.readyState="open",T.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){const t=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!t)return this.writeBuffer;let e=1;for(let s=0;s<this.writeBuffer.length;s++){const t=this.writeBuffer[s].data;if(t&&(e+=Object(d["a"])(t)),s>0&&e>this.maxPayload)return this.writeBuffer.slice(0,s);e+=2}return this.writeBuffer}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,i){if("function"===typeof e&&(i=e,e=void 0),"function"===typeof s&&(i=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;s=s||{},s.compress=!1!==s.compress;const n={type:t,data:e,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}onError(t){T.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let s=0;const i=t.length;for(;s<i;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}T.protocol=a["e"];var R=s("744a");T.protocol;function O(t,e="",s){let i=t;s=s||"undefined"!==typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"===typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t="undefined"!==typeof s?s.protocol+"//"+t:"https://"+t),i=_(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const n=-1!==i.host.indexOf(":"),r=n?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+e,i.href=i.protocol+"://"+r+(s&&s.port===i.port?"":":"+i.port),i}const S="function"===typeof ArrayBuffer,B=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,L=Object.prototype.toString,U="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===L.call(Blob),P="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===L.call(File);function x(t){return S&&(t instanceof ArrayBuffer||B(t))||U&&t instanceof Blob||P&&t instanceof File}function N(t,e){if(!t||"object"!==typeof t)return!1;if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(N(t[e]))return!0;return!1}if(x(t))return!0;if(t.toJSON&&"function"===typeof t.toJSON&&1===arguments.length)return N(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&N(t[s]))return!0;return!1}function I(t){const e=[],s=t.data,i=t;return i.data=M(s,e),i.attachments=e.length,{packet:i,buffers:e}}function M(t,e){if(!t)return t;if(x(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=M(t[i],e);return s}if("object"===typeof t&&!(t instanceof Date)){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=M(t[i],e));return s}return t}function D(t,e){return t.data=j(t.data,e),t.attachments=void 0,t}function j(t,e){if(!t)return t;if(t&&!0===t._placeholder){const s="number"===typeof t.num&&t.num>=0&&t.num<e.length;if(s)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=j(t[s],e);else if("object"===typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=j(t[s],e));return t}const Y=5;var q;(function(t){t[t["CONNECT"]=0]="CONNECT",t[t["DISCONNECT"]=1]="DISCONNECT",t[t["EVENT"]=2]="EVENT",t[t["ACK"]=3]="ACK",t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR",t[t["BINARY_EVENT"]=5]="BINARY_EVENT",t[t["BINARY_ACK"]=6]="BINARY_ACK"})(q||(q={}));class H{constructor(t){this.replacer=t}encode(t){return t.type!==q.EVENT&&t.type!==q.ACK||!N(t)?[this.encodeAsString(t)]:(t.type=t.type===q.EVENT?q.BINARY_EVENT:q.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==q.BINARY_EVENT&&t.type!==q.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=I(t),s=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(s),i}}class F extends f["a"]{constructor(t){super(),this.reviver=t}add(t){let e;if("string"===typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===q.BINARY_EVENT||e.type===q.BINARY_ACK?(this.reconstructor=new $(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!x(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===q[s.type])throw new Error("unknown packet type "+s.type);if(s.type===q.BINARY_EVENT||s.type===q.BINARY_ACK){const i=e+1;while("-"!==t.charAt(++e)&&e!=t.length);const n=t.substring(i,e);if(n!=Number(n)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(n)}if("/"===t.charAt(e+1)){const i=e+1;while(++e){const s=t.charAt(e);if(","===s)break;if(e===t.length)break}s.nsp=t.substring(i,e)}else s.nsp="/";const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const i=e+1;while(++e){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(i,e+1))}if(t.charAt(++e)){const i=this.tryParse(t.substr(e));if(!F.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case q.CONNECT:return"object"===typeof e;case q.DISCONNECT:return void 0===e;case q.CONNECT_ERROR:return"string"===typeof e||"object"===typeof e;case q.EVENT:case q.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case q.ACK:case q.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class ${constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=D(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function z(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const V=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class W extends f["a"]{constructor(t,e,s){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[z(t,"open",this.onopen.bind(this)),z(t,"packet",this.onpacket.bind(this)),z(t,"error",this.onerror.bind(this)),z(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io["_reconnecting"]||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(V.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');e.unshift(t);const s={type:q.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"===typeof e[e.length-1]){const t=this.ids++,i=e.pop();this._registerAckCallback(t,i),s.id=t}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,n=this.flags.volatile&&(!i||!this.connected);return n||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){const s=this.flags.timeout;if(void 0===s)return void(this.acks[t]=e);const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))},s);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(i),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this.packet({type:q.CONNECT,data:t})}):this.packet({type:q.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){const e=t.nsp===this.nsp;if(e)switch(t.type){case q.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case q.EVENT:case q.BINARY_EVENT:this.onevent(t);break;case q.ACK:case q.BINARY_ACK:this.onack(t);break;case q.DISCONNECT:this.ondisconnect();break;case q.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e);break}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:q.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];"function"===typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io["_destroy"](this)}disconnect(){return this.connected&&this.packet({type:q.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function K(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}K.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-s:t+s}return 0|Math.min(t,this.max)},K.prototype.reset=function(){this.attempts=0},K.prototype.setMin=function(t){this.ms=t},K.prototype.setMax=function(t){this.max=t},K.prototype.setJitter=function(t){this.jitter=t};class J extends f["a"]{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,Object(d["b"])(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=e.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new K({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const n=e.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new T(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=z(e,"open",(function(){s.onopen(),t&&t()})),n=z(e,"error",e=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",e),t?t(e):s.maybeReconnectOnOpen()});if(!1!==this._timeout){const t=this._timeout;0===t&&i();const s=this.setTimeoutFn(()=>{i(),e.close(),e.emit("error",new Error("timeout"))},t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(i),this.subs.push(n),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(z(t,"ping",this.onping.bind(this)),z(t,"data",this.ondata.bind(this)),z(t,"error",this.onerror.bind(this)),z(t,"close",this.onclose.bind(this)),z(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Object(R["c"])(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s||(s=new W(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e){const t=this.nsps[s];if(t.active)return}this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()}))},e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const X={};function G(t,e){"object"===typeof t&&(e=t,t=void 0),e=e||{};const s=O(t,e.path||"/socket.io"),i=s.source,n=s.id,r=s.path,o=X[n]&&r in X[n]["nsps"],a=e.forceNew||e["force new connection"]||!1===e.multiplex||o;let h;return a?h=new J(i,e):(X[n]||(X[n]=new J(i,e)),h=X[n]),s.query&&!e.query&&(e.query=s.queryKey),h.socket(s.path,e)}Object.assign(G,{Manager:J,Socket:W,io:G,connect:G})},e3db:function(t,e){var s={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==s.call(t)}},e791:function(t,e,s){},e914:function(t,e,s){"use strict";var i=s("feeb"),n=s("2f62"),r=s("1ab4"),o=(s("db04"),s("365c"),s("1655"));const a={bold:o["a"],italic:o["d"],image:o["b"],link:o["e"],emoticons:o["c"],video:o["i"]};var h,c,u,l,f={name:"chat-editor",components:{EditorContent:r["b"]},props:{draftContent:{type:String,require:!1},value:{type:String,require:!1},toolbar:{type:Array,require:!1},onChange:{type:Function,require:!1},height:{type:Number,require:!1},limit:{type:Number,require:!1}},provide(){var t,e;return{uid:null===this||void 0===this||null===(t=this.userInfo)||void 0===t?void 0:t.uid,nickname:null===this||void 0===this||null===(e=this.userInfo)||void 0===e?void 0:e.nickname}},inject:["observedEditor"],computed:{editor(){return this.observedEditor.editor},...Object(n["d"])({uuid:t=>t.users.uuid,code:t=>t.users.code,userInfo:t=>t.users.userInfo}),currentCount(){return this.editor.storage.characterCount.characters()||0},percentage(){return Math.round(100/this.limit*this.currentCount)}},mounted(){this.$watch("editor",()=>{this.editor.on("update",({editor:t})=>{this.$emit("input",t.getHTML())})}),this.$watch("draftContent",()=>{var t;this.editor.commands.setContent(null!==(t=this.draftContent)&&void 0!==t?t:"")})},methods:{handleContentClick(){this.editor.commands.focus()},clearContent(){this.editor.commands.clearContent()}},render(){var t;const e=arguments[0];return e("div",{class:"chat-editor"},[this.editor&&e("div",{class:"chat-editor-toolbar"},[(null===(t=this.toolbar)||void 0===t?void 0:t.length)>0&&this.toolbar.map(t=>{const s=a[t];return s?e("span",{class:{"chat-editor-toolbar-item":!0,"is-active":this.editor.isActive(t)}},[e(s)]):null})]),e("div",{style:{height:this.height+"px"},class:"chat-editor-content",on:{click:this.handleContentClick}},[e(r["b"],{attrs:{editor:this.editor}})])])}},d=f,p=(s("5185"),s("2877")),g=Object(p["a"])(d,h,c,!1,null,"47c412ee",null),m=g.exports,y=s("dbbe"),v=s("6275"),b=s("f1f3"),w={name:"chat-editor-wrapper",components:{ChatEditor:m,EditorProvider:i["a"],HButton:y["a"],HInput:v["a"]},props:{limitWords:Number,height:Number},data(){return{draftContent:"",chatContent:"",toolbarConfig:["bold","italic","image","link","emoticons"],pluginConfig:{[b["a"].IMAGE]:null,[b["a"].LINK]:null,[b["a"].CHARACTER_COUNT]:{limit:this.limitWords||1e4}}}},methods:{handlePost(){this.$emit("post",{content:this.chatContent})},clear(){this.chatContent="",this.$refs["editor"].clearContent()},addContent(){this.draftContent=""}},render(){const t=arguments[0];return t("div",{class:"chat-editor-wrapper"},[t("editor-provider",{attrs:{type:"chat",plugins:this.pluginConfig}},[t("chat-editor",{ref:"editor",attrs:{height:this.height,draftContent:this.draftContent,toolbar:this.toolbarConfig,limit:this.limitWords||1e4},model:{value:this.chatContent,callback:t=>{this.chatContent=t}}})]),t("div",{class:"chat-editor-wrapper-footer"},[t("h-button",{attrs:{size:"mini"},on:{click:this.handlePost}},["发送"])])])}},C=w,k=(s("39bc"),Object(p["a"])(C,u,l,!1,null,"6271e144",null));e["a"]=k.exports},ed08:function(t,e){const s={dateFormat:(t,e)=>{let s;const i={"Y+":e.getFullYear().toString(),"m+":(e.getMonth()+1).toString(),"d+":e.getDate().toString(),"H+":e.getHours().toString(),"M+":e.getMinutes().toString(),"S+":e.getSeconds().toString()};for(let n in i)s=new RegExp("("+n+")").exec(t),s&&(t=t.replace(s[1],1==s[1].length?i[n]:i[n].padStart(s[1].length,"0")));return t},getLevelInfo(t,e){let s=0;while(s<e.length){if(s===e.length-1)return e[s];if(t>=e[s].exp&&t<e[s+1].exp)return e[s];s++}},imagesLoadDone:async t=>{const e=t.map(t=>new Promise(e=>{const s=new Image;s.src=t,s.onload=()=>{e(t)}}));return Promise.all(e)},dateInrange:(t,e,s)=>{const i=new Date(t),n=new Date(e);return n.valueOf()-i.valueOf()<s}};t.exports=s}}]);