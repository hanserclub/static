(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-133f4a39"],{"04b6":function(t,e,s){"use strict";s("a55c")},"079b":function(t,e,s){},"083a":function(t,e,s){"use strict";var i=s("0d51"),a=TypeError;t.exports=function(t,e){if(!delete t[e])throw a("Cannot delete property "+i(e)+" of "+i(t))}},"0f16":function(t,e,s){},"13d5":function(t,e,s){"use strict";var i=s("23e7"),a=s("d58f").left,o=s("a640"),l=s("2d00"),n=s("605d"),r=o("reduce"),c=!n&&l>79&&l<83;i({target:"Array",proto:!0,forced:!r||c},{reduce:function(t){var e=arguments.length;return a(this,t,e,e>1?arguments[1]:void 0)}})},"16dc":function(t,e,s){},3300:function(t,e,s){},"3a89":function(t,e,s){"use strict";s("cafa")},"3c65":function(t,e,s){"use strict";var i=s("23e7"),a=s("7b0b"),o=s("07fa"),l=s("3a34"),n=s("083a"),r=s("3511"),c=1!==[].unshift(0),d=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:c||d},{unshift:function(t){var e=a(this),s=o(e),i=arguments.length;if(i){r(s+i);var c=s;while(c--){var d=c+i;c in e?e[d]=e[c]:n(e,d)}for(var h=0;h<i;h++)e[h]=arguments[h]}return l(e,s+i)}})},"3cc0":function(t,e,s){},4718:function(t,e,s){"use strict";s("50d3")},"4a38":function(t,e,s){"use strict";s("7231")},"50d3":function(t,e,s){},"5ad1":function(t,e,s){},"605d":function(t,e,s){var i=s("c6b6"),a=s("da84");t.exports="process"==i(a.process)},"69d5":function(t,e,s){"use strict";s.d(e,"g",(function(){return o})),s.d(e,"d",(function(){return l})),s.d(e,"i",(function(){return n})),s.d(e,"j",(function(){return r})),s.d(e,"h",(function(){return c})),s.d(e,"l",(function(){return m})),s.d(e,"k",(function(){return f})),s.d(e,"n",(function(){return g})),s.d(e,"m",(function(){return y})),s.d(e,"o",(function(){return _})),s.d(e,"f",(function(){return k})),s.d(e,"e",(function(){return w})),s.d(e,"c",(function(){return b})),s.d(e,"b",(function(){return C})),s.d(e,"a",(function(){return x}));var i=s("db04"),a=s("50fc");const o=t=>i["a"].get(a["a"].getAvatarCheckList,{params:t}),l=t=>i["a"].post(a["a"].approveAvatarCheck,t),n=t=>i["a"].get(a["a"].getLogList,{params:t}),r=t=>i["a"].get(a["a"].getRecoverList,{params:t}),c=t=>i["a"].get(a["a"].banList,{params:t}),d=t=>i["a"].post(`${a["a"].removePost}/${t}`),h=t=>i["a"].post(`${a["a"].setPostValued}/${t}`),p=t=>i["a"].post(`${a["a"].removePostValued}/${t}`),u=t=>i["a"].post(`${a["a"].setPostTopping}/${t}`),v=t=>i["a"].post(`${a["a"].removePostTopping}/${t}`),m=t=>i["a"].get(a["a"].nicknameApplyList,{params:t}),f=t=>i["a"].post(a["a"].nicknameApplyCheck,t),g=t=>i["a"].get(a["a"].signApplyList,{params:t}),y=t=>i["a"].post(a["a"].signApplyCheck,t),_=t=>i["a"].post(`${a["a"].unban}${t.uid}`,t),k=[{key:void 0,value:"全部"},{key:0,value:"待审核"},{key:1,value:"审核通过"},{key:2,value:"审核不通过"}],w=[{key:0,value:"在使用"},{key:1,value:"已过期"},{key:2,value:"被撤销"},{key:3,value:"全部"}],b=[{key:void 0,value:"全部"},{key:1,value:"删帖相关"},{key:2,value:"屏蔽相关"},{key:3,value:"加精相关"},{key:4,value:"置顶相关"}],C={5:"加精",6:"取消加精",7:"置顶",8:"取消置顶"},x={1:d,3:null,4:null,5:h,6:p,7:u,8:v}},"6a3b":function(t,e,s){},7198:function(t,e,s){"use strict";s("5ad1")},7231:function(t,e,s){},"779e":function(t,e,s){"use strict";s("0f16")},"78e5":function(t,e,s){},7984:function(t,e,s){"use strict";s("ce68")},"8bb5":function(t,e,s){},"8e01":function(t,e,s){"use strict";s("8bb5")},9264:function(t,e,s){"use strict";s("f330")},"9fbf":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"brief-author"},["post-details"===t.type?e("detail-avatar",{attrs:{avatar:t.avatar,level:t.level,uid:t.uid,nickname:t.nickname,focusHe:t.focusHe,exp:t.exp,auth:t.auth,iconSize:t.iconSize,authentication:t.authentication},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[e("template",{slot:"avatar-slot"},[e("link-avatar",{attrs:{avatar:t.avatar,size:t.size,auth:t.auth,uid:t.uid,iconSize:t.iconSize,authentication:t.authentication,nickname:t.nickname}})],1)],2):e("link-avatar",{attrs:{avatar:t.avatarUrl,size:t.size,auth:t.auth,uid:t.uid,iconSize:t.iconSize,authentication:t.authentication,nickname:t.nickname}}),e("level-nickname",{staticClass:"level-nickname-wrapper",attrs:{colors:t.colors,uid:t.uid,nickname:t.nickname}}),t._t("default")],2)},a=[],o=s("c362"),l=s("e51f"),n=s("919f"),r={name:"brief-author",props:["type","nickname","colors","iconSize","uid","avatar","size","auth","authentication","level","exp","focusHe"],components:{LinkAvatar:o["a"],LevelNickname:l["a"],DetailAvatar:n["a"]},computed:{avatarUrl(){return this.avatar||"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png"}},methods:{getUserInfo(){this.$emit("getUserInfo",this.uid)},followUser(t,e){this.$emit("followUser",t,e)}}},c=r,d=(s("4a38"),s("2877")),h=Object(d["a"])(c,i,a,!1,null,"5ff0f064",null);e["a"]=h.exports},a0d4:function(t,e,s){},a197:function(t,e,s){"use strict";s("16dc")},a55c:function(t,e,s){},a640:function(t,e,s){"use strict";var i=s("d039");t.exports=function(t,e){var s=[][t];return!!s&&i((function(){s.call(null,e||function(){return 1},1)}))}},ab90:function(t,e,s){},ad97:function(t,e,s){"use strict";s("78e5")},b17c:function(t,e,s){},b4eb:function(t,e,s){"use strict";s("b17c")},b533:function(t,e,s){"use strict";s("f7cf")},b717:function(t,e,s){},c9c2:function(t,e,s){"use strict";s("3300")},cafa:function(t,e,s){},cd15:function(t,e,s){"use strict";s("ab90")},ce68:function(t,e,s){},cf1b:function(t,e,s){"use strict";s("d6c0")},cf3d:function(t,e,s){"use strict";s("6a3b")},d1e1:function(t,e,s){"use strict";s("3cc0")},d58f:function(t,e,s){var i=s("59ed"),a=s("7b0b"),o=s("44ad"),l=s("07fa"),n=TypeError,r=function(t){return function(e,s,r,c){i(s);var d=a(e),h=o(d),p=l(d),u=t?p-1:0,v=t?-1:1;if(r<2)while(1){if(u in h){c=h[u],u+=v;break}if(u+=v,t?u<0:p<=u)throw n("Reduce of empty array with no initial value")}for(;t?u>=0:p>u;u+=v)u in h&&(c=s(c,h[u],u,d));return c}};t.exports={left:r(!1),right:r(!0)}},d6c0:function(t,e,s){},d930:function(t,e,s){"use strict";s("a0d4")},de6d:function(t,e,s){"use strict";s("079b")},f26e:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-details"},[e("div",{staticClass:"post-details__wrapper"},[e("div",{staticClass:"post-details__container"},[1===t.detailData.status?e("span",{staticClass:"delete-info"},[t._v("注：此贴已删除，仅供管理员查看，请勿进行其他操作！")]):t._e(),t.contentShow?e("post-content",{attrs:{levels:t.levels,isSelf:t.isSelf,detail:t.detailData},on:{edit:t.edit,likePost:t.likePost,lock:t.lockPost,unlock:t.unLockPost,favorite:t.favorite,delete:t.handleDelete,reportPost:t.handleReportPost}}):e("content-skeleton"),e("post-reply",{ref:"post-reply",staticStyle:{"margin-top":"24px"},attrs:{levels:t.levels,user:t.user,isMobile:t.isMobile,isAuthor:t.isSelf,currentPostId:t.currentPostId},on:{followUser:t.followUser,replyFloor:t.handlePostByFloor,replyReplyInReply:t.replyReplyInReply,getUserInfo:t.getUserInfo,delete:t.handleDelete}}),t.isMobile?t._e():e("div",{staticClass:"post-details__editor"},[e("div",{staticClass:"post-details__editor-main"},[e("hanser-editor",{ref:"editor",staticClass:"post-editor",attrs:{cammandList:t.cammandList,useAt:!0,limit:1e3},on:{post:t.handlePost}})],1)])],1)]),e("div",{staticClass:"post-details__right"},[t.authorInfoShow?e("post-author",{attrs:{levels:t.levels,author:t.detailData.author,isFollowing:t.isFollowing,isSelf:t.isSelf},on:{followAuthor:t.followAuthor}}):e("author-skeleton")],1)])},a=[],o=(s("3c65"),s("14d9"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-author"},[e("div",{staticClass:"post-author-title"},[e("span",[t._v("帖主")]),t.isAdmin?e("el-popover",{attrs:{"popper-class":"post-action-popover",placement:"bottom",trigger:"click"}},[e("ul",{staticClass:"operations"},t._l(t.operations,(function(s){return e("li",{key:s.text,class:["operation",s.textStyle],on:{click:s.callback}},[e("i",{class:["hanser",s.icon]}),t._v(" "+t._s(s.text)+" ")])})),0),e("div",{staticClass:"more",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"hanser icon-gengduo"})])]):t._e()],1),e("div",{staticClass:"post-author-baseInfo"},[e("div",{staticClass:"post-author-baseInfo__avatar"},[e("link-avatar",{attrs:{avatar:t.authorInfo.avatar,size:80,uid:t.authorInfo.uid,auth:t.authorInfo.auth,authentication:t.authorInfo.authentication,nickname:t.authorInfo.nickname}})],1),e("div",{staticClass:"post-author-baseInfo__nickname"},[e("level-nickname",{attrs:{nickname:t.authorInfo.nickname,uid:t.authorInfo.uid,colors:t.levelLabel.color}})],1),t.levelShow?e("div",{staticClass:"post-author-baseInfo__level"},[e("level-label",{attrs:{level:t.currentLevel}})],1):t._e()]),e("div",{staticClass:"post-author-info"},[e("div",{staticClass:"post-author-info__count"},t._l(t.data,(function(s){return e("router-link",{key:s.text,staticClass:"post-author-info__item",attrs:{to:"/space/"+t.authorInfo.uid+s.hash,target:"_blank"}},[e("div",{staticClass:"post-author-info__text"},[t._v(t._s(s.text))]),e("div",{staticClass:"post-author-info__value"},[t._v(t._s(t.counts[s.key]))])])})),1)]),t.isSelf?t._e():e("div",{staticClass:"post-author-action"},[e("h-button",{attrs:{plain:t.followBtnPlain},on:{click:t.followAuthor},nativeOn:{mousemove:function(e){return t.hoverOnFollow.apply(null,arguments)},mouseleave:function(e){return t.outHoverOnFollow.apply(null,arguments)}}},[t._v(t._s(t.hoverOnFollowText))]),e("h-button",{on:{click:function(e){return t.openChat(t.authorInfo.uid)}}},[t._v("私聊")])],1)])}),l=[],n=(s("13d5"),s("d9e2"),s("dbbe")),r=s("c362"),c=s("e51f"),d=s("99ca"),h=s("2f62"),p=s("db04"),u=s("50fc"),v={components:{HButton:n["a"],LinkAvatar:r["a"],LevelNickname:c["a"],LevelLabel:d["a"]},name:"details-author",props:["levels","author","isFollowing","isSelf"],data(){return{authorInfo:{},levelShow:!1,currentLevel:null,defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",hover:{follow:!1},data:[{text:"动态",key:"post",hash:"#posts"},{text:"关注",key:"follow",hash:"#follow"},{text:"粉丝",key:"fans",hash:"#fans"}],counts:{follow:0,fans:0,post:0}}},mounted(){this.authorInfo=this.author,this.counts.follow=this.authorInfo.follow,this.counts.fans=this.authorInfo.fans,this.counts.post=this.authorInfo.posts,this.currentLevel=this.getLevel()},computed:{...Object(h["d"])({user:t=>t.users.userInfo,isMobile:t=>t.media.isMobile,bilibiliScores:t=>t.score.bilibili,douyuScores:t=>t.score.douyu}),...Object(h["b"])("users",{isAdmin:"isAdmin",isHanser:"isHanser"}),bilibiliScore(){return this.bilibiliScores.length?this.bilibiliScores.map(t=>t.point).reduce((t,e)=>t+e):0},douyuScore(){return this.douyuScores.length?this.douyuScores.map(t=>t.point).reduce((t,e)=>t+e):0},level(){const{exp:t}=this.author;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t},avatar(){return this.authorInfo.avatar||this.defaultAvatar},userLink(){return"/space/"+this.authorInfo.uid},hoverOnFollowText(){return this.isFollowing?this.hover.follow?"取消关注":"已关注":"+关注"},followBtnPlain(){return this.isFollowing},isAuthorAdmin(){return this.authorInfo.role>=256},operations(){let t=[];return t=1==this.authorInfo.status?[{text:"已被封禁",icon:"icon-fengjin",textStyle:"icon-disabled",callback:this.recover}]:[{text:"封禁",icon:"icon-fengjin",textStyle:null,callback:this.banUser}],this.isHanser?this.isAuthorAdmin?[...t,{text:"取消管理员",icon:"icon-gerenzhongxin",textStyle:null,callback:this.cancelAdmin}]:[...t,{text:"设为管理员",icon:"icon-gerenzhongxin",textStyle:null,callback:this.setAdmin}]:this.isAdmin?t:[]}},methods:{getLevel(){const{exp:t}=this.authorInfo;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),this.levelShow=!0,e},openChat(t){const e=new CustomEvent("open-chat",{detail:{uid:t}});window.dispatchEvent(e)},followAuthor(){this.$emit("followAuthor",this.authorInfo.uid)},hoverOnFollow(){this.hover.follow=!0},outHoverOnFollow(){this.hover.follow=!1},banUser(){this.$showBanDialog(this.authorInfo,0,this.isMobile,()=>this.authorInfo.status=1)},async setAdmin(){try{let t=await p["a"].post(u["a"].setAdmin,{uid:this.authorInfo.uid});if(0!=t.code)throw new Error(t.msg);this.$message({type:"success",message:t.msg}),this.authorInfo.role=100}catch(t){console.log(t)}},async cancelAdmin(){try{let t=await p["a"].post(u["a"].cancelAdmin,{uid:this.authorInfo.uid});if(0!=t.code)throw new Error(t.msg);this.$message({type:"success",message:t.msg}),this.authorInfo.role=0}catch(t){console.log(t)}},recover(){this.$message({type:"warning",message:"已被封禁，不可操作"})}}},m=v,f=(s("3a89"),s("2877")),g=Object(f["a"])(m,o,l,!1,null,"734d1f00",null),y=g.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-content"},[e("div",{staticClass:"post-content-title"},[e("ul",{staticClass:"labels"},t._l(t.detailData.labels,(function(s){return e("li",{key:s.labelId},[e("span",{staticClass:"label",style:t.labelStyle(s)},[t._v(t._s(s.labelName))])])})),0),e("span",{staticClass:"title"},[t._v(t._s(t.detailData.title))])]),e("div",{staticClass:"post-content__inner"},[e("div",{staticClass:"post-content__inner-main"},[e("post-user",{attrs:{avatar:t.detailData.author.avatar,size:50,auth:t.detailData.author.auth,authentication:t.detailData.author.authentication,nickname:t.detailData.author.nickname,uid:t.detailData.author.uid,colors:t.levelLabel.color,level:t.level},scopedSlots:t._u([{key:"bottom",fn:function(){return[e("span",{staticClass:"post-content__time"},[t._v(" "+t._s(t.postTime)+" ")]),t.detailData.location?e("span",{staticClass:"ip-location"},[t._v(t._s(t.detailData.location))]):t._e()]},proxy:!0}])}),e("div",{staticClass:"post-content__inner-text"},[e("detail-content",{attrs:{content:t.detailData.content,isTop:!1}}),t.detailData.voteId?e("vote-panel",{attrs:{postId:t.detailData.id,voteId:t.detailData.voteId,expandVotePanel:!0,hideToggleButton:!0}}):t._e()],1),e("div",{staticClass:"post-content__inner-tags"},t._l(t.detailData.tags,(function(s,i){return e("span",{key:i},[e("router-link",{staticClass:"post-content__tags",attrs:{target:"_blank",to:"/tag/"+s.id}},[t._v("#"+t._s(s.name))])],1)})),0),e("div",{staticClass:"post-content__inner-banner"},[e("span",{staticClass:"post-content__action"},[t._m(0),t._v(" "+t._s(t.detailData.readings)+" ")]),e("span",{staticClass:"post-content__action",class:{liked:t.detailData.liked},on:{click:function(e){return t.like()}}},[t.showLike?e("div",{staticClass:"like-animation"},[e("img",{attrs:{src:"https://cdn.2550505.com/share/legacy-sso/like.gif",width:"64",height:"42"}})]):t._e(),e("div",{staticClass:"post-content__action-icon"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}})],1),t._v(" "+t._s(t.detailData.likes)+" ")]),e("span",{staticClass:"post-content__action",class:{favorited:t.detailData.favorite},on:{click:t.favorite}},[e("div",{staticClass:"post-content__action-icon"},[e("icon",{attrs:{icon:"hanser icon-shoucang"}})],1),t._v(" "+t._s(t.favoriteText)+" ")]),e("span",{staticClass:"post-reply__share"},[e("post-action",{attrs:{type:"post",userInfo:t.detailData.author,isAuthor:t.detailData.author.uid===t.user.uid,isSelf:t.isSelf},on:{handleLock:t.handleLock,handleUnLock:t.handleUnLock,handleEdit:t.handleEdit,handleDelete:t.handleDelete,handleReportPost:t.handleReportPost}})],1)])],1)])])},k=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-content__action-icon"},[e("i",{staticClass:"hanser icon-chakan"})])}],w=s("9579"),b=function(){var t,e=this,s=e._self._c;return s("div",{staticClass:"vote-panel"},[e.voteCollapse?s("div",[e.hideToggleButton?e._e():s("div",{staticClass:"vote-expand-button",attrs:{size:"mini"},on:{click:e.handleVoteExpand}},[s("i",{staticClass:"fa-solid fa-square-poll-vertical vote-button-icon"}),e._v(" 查看投票 ")])]):s("div",[!0===e.loading?s("div",[1===(null===(t=e.vote)||void 0===t?void 0:t.type)?s("vote-skeleton-image"):s("vote-skeleton-text")],1):s("div",{class:{"vote-container":!0,"vote-progressing":!e.voteHasExpired}},[e.hideToggleButton?e._e():s("div",{staticClass:"vote-collapse-button",attrs:{size:"mini"},on:{click:e.handleVoteCollapse}},[s("i",{staticClass:"fa-solid fa-square-poll-vertical vote-button-icon"}),e._v("收起投票 ")]),s("div",{staticClass:"vote-header"},[s("div",{staticClass:"vote-title"},[s("i",{staticClass:"fa-solid fa-square-poll-vertical vote-button-icon"}),e._v(" "+e._s(e.vote.title)+" ")]),s("div",{staticClass:"vote-info"},[s("div",{staticClass:"vote-person-count"},[e._v(" 参与人数："),s("span",[e._v(e._s(e.total))]),e._v("人 ")]),e.votePeopleButtonVisible?s("div",{staticClass:"vote-see-people",attrs:{size:"mini"},on:{click:e.handleSeeVotePeople}},[e._v(" 查看投票人 ")]):e._e()])]),s("div",{staticClass:"vote-footer"},[s("div",{staticClass:"vote-footer-row"},[s("div",{staticClass:"vote-footer-item vote-check-type"},[e._v(" 投票类型："+e._s(0===e.vote.checkType?"单选":`多选 最多选${e.vote.max}项`)+" ")]),s("div",{staticClass:"vote-footer-item"},[e._v(" "+e._s(e.voteTimeStatus)+" ")])])]),s("div",{staticClass:"vote-content"},[0===e.vote.type?s("div",{staticClass:"vote-item-list-text"},e._l(e.options,(function(t,i){return s("div",{key:t.id,class:{"vote-item":!0,"vote-item-not-voted":!e.currentUserHasVoted,"vote-item-voted":e.selectedOptionIdList.includes(t.id)},on:{click:function(s){!e.voteHasExpired&&!e.currentUserHasVoted&&e.handleOptionClick(t)}}},[e.currentUserHasVoted||e.voteHasExpired?s("div",{staticClass:"vote-item-bg",style:{width:e.calculateVotePercentage(t.num),"border-top-right-radius":"100%"===e.calculateVotePercentage(t.num)?"8px":"0","border-bottom-right-radius":"100%"===e.calculateVotePercentage(t.num)?"8px":"0"}}):e._e(),s("div",{staticClass:"vote-item-content"},[s("div",{staticClass:"vote-item-index"},[e._v(e._s(i+1)+".")]),s("div",{staticClass:"vote-item-title",attrs:{title:t.text}},[e._v(" "+e._s(t.text)+" ")]),s("div",{staticClass:"vote-item-status"},[s("span",{staticClass:"vote-item-selected"},[e._v(" "+e._s(e.currentUserHasVoted&&null!==t&&void 0!==t&&t.voted?"✅":"")+" "+e._s(!e.currentUserHasVoted&&e.selectedOptionIdList.includes(t.id)?"✅":"")+" ")]),e.currentUserHasVoted||e.voteHasExpired?s("span",{staticClass:"vote-item-count"},[e._v(" "+e._s(t.num)+"票 ")]):e._e()])])])})),0):s("div",{staticClass:"vote-item-list-image"},e._l(e.options,(function(t,i){return s("el-card",{key:t.id,class:{"vote-item":!0,"vote-item-not-voted":!e.currentUserHasVoted,"vote-item-voted":e.selectedOptionIdList.includes(t.id),"vote-item-highlight":!e.currentUserHasVoted&&e.cardBorderVisible},attrs:{"body-style":{padding:"0px",height:"100%",position:"relative"}},nativeOn:{click:function(s){!e.voteHasExpired&&!e.currentUserHasVoted&&e.handleOptionClick(t)},mouseover:function(t){return e.handleCardMouseOver.apply(null,arguments)},mouseleave:function(t){return e.handleCardMouseLeave.apply(null,arguments)}}},[s("el-image",{key:t.image,staticClass:"image vote-item-image",attrs:{slot:"header",lazy:"",fit:"cover",src:t.image},on:{click:function(s){return s.stopPropagation(),e.handlePreview(t.image)}},nativeOn:{mouseover:function(t){return t.stopPropagation(),e.handleImageMouseOver.apply(null,arguments)},mouseleave:function(t){return t.stopPropagation(),e.handleImageMouseLeave.apply(null,arguments)}},slot:"header"},[s("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[s("img",{attrs:{width:"120",height:"120",alt:"loading",src:"https://cdn.2550505.com/share/legacy-sso/loading.jpg"}})]),s("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[s("img",{attrs:{width:"120",height:"120",alt:"failed",src:"https://cdn.2550505.com/share/legacy-sso/fail.jpg"}})])]),e.currentUserHasVoted||e.voteHasExpired?s("div",{staticClass:"vote-item-bg",style:{width:e.calculateVotePercentage(t.num),"border-top-right-radius":"100%"===e.calculateVotePercentage(t.num)?"8px":"0","border-bottom-right-radius":"100%"===e.calculateVotePercentage(t.num)?"8px":"0"}}):e._e(),s("div",{staticClass:"vote-item-body"},[s("div",{staticClass:"vote-item-index"},[e._v(e._s(i+1)+".")]),s("div",{staticClass:"vote-item-title",attrs:{title:t.text}},[e._v(" "+e._s(t.text)+" ")]),s("div",{staticClass:"vote-item-status"},[s("span",{staticClass:"vote-item-selected"},[e._v(" "+e._s(e.currentUserHasVoted&&null!==t&&void 0!==t&&t.voted?"✅":"")+" "+e._s(!e.currentUserHasVoted&&e.selectedOptionIdList.includes(t.id)?"✅":"")+" ")]),e.currentUserHasVoted||e.voteHasExpired?s("span",{staticClass:"vote-item-count"},[e._v(" "+e._s(t.num)+"票 ")]):e._e()])])],1)})),1),s("div",{staticClass:"vote-commit-button-container"},[e.currentUserHasVoted||e.voteHasExpired?e._e():s("h-button",{staticClass:"vote-commit-button",attrs:{size:"mini",disabled:0===e.selectedOptionIdList.length},on:{click:e.handleVoteConfirm}},[e._v("投票")])],1)]),s("el-dialog",{attrs:{width:"720px",visible:e.modelVisible,title:"参与投票的人","append-to-body":!0,fullscreen:e.isMobile},on:{"update:visible":function(t){e.modelVisible=t}}},[s("vote-people",{attrs:{voteId:e.voteId}})],1)],1),e.showViewer?s("el-image-viewer",{attrs:{"url-list":e.primaryPictures,"on-close":e.handlePreviewClose}}):e._e()],1)])},C=[],x=s("00b6"),I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"vote-skeleton"},[e("el-skeleton",{attrs:{animated:""}},[e("template",{slot:"template"},[e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"50%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"20%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"30%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"100%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"100%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-rect",staticStyle:{width:"50px",height:"20px"},attrs:{variant:"rect"}})],1),e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"100%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"skeleton-row"},[e("el-skeleton-item",{staticClass:"skeleton-text",staticStyle:{width:"100%"},attrs:{variant:"text"}})],1)])],2)],1)},S=[],P={name:"vote-skeleton-text"},$=P,L=(s("b4eb"),Object(f["a"])($,I,S,!1,null,"3ca2c92b",null)),E=L.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"vote-skeleton"},[e("el-skeleton",{attrs:{animated:""}},[e("template",{slot:"template"},[e("div",{staticClass:"skeleton-container"},[e("div",{staticClass:"skeleton-card"},[e("el-skeleton",{attrs:{rows:4,loading:!0,animated:""}},[e("template",{slot:"template"},[e("el-skeleton-item",{staticClass:"skeleton-image",staticStyle:{width:"100%",height:"120px"},attrs:{variant:"image"}}),e("div",{staticClass:"skeleton-content"},[e("el-skeleton-item",{staticStyle:{width:"80%"},attrs:{variant:"p"}}),e("el-skeleton-item",{staticStyle:{width:"60%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"40%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}})],1)],1)],2)],1),e("div",{staticClass:"skeleton-card"},[e("el-skeleton",{attrs:{rows:4,loading:!0,animated:""}},[e("template",{slot:"template"},[e("el-skeleton-item",{staticClass:"skeleton-image",staticStyle:{width:"100%",height:"120px"},attrs:{variant:"image"}}),e("div",{staticClass:"skeleton-content"},[e("el-skeleton-item",{staticStyle:{width:"60%"},attrs:{variant:"p"}}),e("el-skeleton-item",{staticStyle:{width:"40%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"10%"},attrs:{variant:"text"}})],1)],1)],2)],1),e("div",{staticClass:"skeleton-card"},[e("el-skeleton",{attrs:{rows:4,loading:!0,animated:""}},[e("template",{slot:"template"},[e("el-skeleton-item",{staticClass:"skeleton-image",staticStyle:{width:"100%",height:"120px"},attrs:{variant:"image"}}),e("div",{staticClass:"skeleton-content"},[e("el-skeleton-item",{staticStyle:{width:"40%"},attrs:{variant:"p"}}),e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"10%"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"5%"},attrs:{variant:"text"}})],1)],1)],2)],1)])])],2)],1)},T=[],A={name:"vote-skeleton-image"},R=A,U=(s("fd01"),Object(f["a"])(R,D,T,!1,null,"948b0e1e",null)),O=U.exports,F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"vote-people"},[t.loading?e("content-skeleton"):e("div",[e("div",{staticClass:"vote-people-select-container"},[e("el-select",{staticClass:"vote-people-select",attrs:{placeholder:"请选择"},model:{value:t.voteIndex,callback:function(e){t.voteIndex=e},expression:"voteIndex"}},t._l(t.votePeople,(function(t,s){var i;return e("el-option",{key:t.id,attrs:{label:`${t.text} (${(null!==(i=null===t||void 0===t?void 0:t.voted)&&void 0!==i?i:[]).length}人)`,value:s}})})),1)],1),t.votePeople[t.voteIndex]?e("div",[0===t.votePeople[t.voteIndex].voted.length?e("div",{staticClass:"vote-people-empty"},[t._v("暂时无人投票")]):e("div",{staticClass:"vote-people-list-container"},[e("div",{staticClass:"vote-people-list"},t._l(t.pagedVotePeople,(function(s){return e("div",{key:s.uid,staticClass:"vote-people-item"},[e("div",{staticClass:"vote-people-avatar"},[e("link-avatar",{attrs:{avatar:s.avatar,size:50,auth:s.auth,uid:s.uid,authentication:s.authentication,nickname:s.nickname}})],1),e("div",{staticClass:"vote-people-nickname"},[t._v(t._s(s.nickname))])])})),0),t.totalPages>=2?e("el-pagination",{staticClass:"vote-people-pagination",attrs:{"current-page":t.currentPage,"page-size":t.pageSize,"prev-text":"上一页","next-text":"下一页",layout:"prev, pager, next, jumper",total:t.votePeople[t.voteIndex].voted.length},on:{"current-change":t.handleCurrentChange}}):t._e()],1)]):t._e()])],1)},V=[],M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-skeleton"},[e("el-skeleton",{attrs:{animated:""}},[e("template",{slot:"template"},[e("div",{staticClass:"sk-title"},[e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-divider"}),e("div",{staticClass:"sk-body"},[e("div",{staticClass:"sk-body__aside"},[e("el-skeleton-item",{staticStyle:{width:"50px",height:"50px"},attrs:{variant:"image"}})],1),e("div",{staticClass:"sk-body__main"},[e("div",{staticClass:"sk-info"},[e("el-skeleton-item",{staticStyle:{width:"64px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"80px",margin:"0 5px"},attrs:{variant:"text"}})],1),e("el-skeleton-item",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}})],1)])])],2)],1)},H=[],j={name:"content-skeleton"},z=j,B=(s("04b6"),Object(f["a"])(z,M,H,!1,null,"52302b5d",null)),N=B.exports,q={name:"vote-people",props:{voteId:{type:Number,require:!0}},components:{ContentSkeleton:N,LinkAvatar:r["a"]},data(){return{votePeople:[],loading:!1,voteIndex:0,currentPage:1}},watch:{voteIndex(){this.currentPage=1}},computed:{...Object(h["d"])({isMobile:t=>t.media.isMobile}),pageSize(){return null!==this&&void 0!==this&&this.isMobile?10:25},totalPages(){return Math.ceil(this.votePeople[this.voteIndex].voted.length/this.pageSize)},pagedVotePeople(){let t=(this.currentPage-1)*this.pageSize,e=t+this.pageSize;return this.votePeople[this.voteIndex].voted.slice(t,e)}},methods:{handleCurrentChange(t){this.currentPage=t},fetchVotePeople:async function(){this.loading=!0;try{const{code:t,msg:e,list:s}=await p["a"].get(""+x["a"].people,{params:{id:this.voteId}});0!==t?this.$message({type:"warning",message:"获取投票人信息失败: "+e}):this.votePeople=s}catch(t){this.$message({type:"error",message:"发生错误，请重试",zIndex:1e4})}finally{this.loading=!1}}},async mounted(){await this.fetchVotePeople()}},J=q,W=(s("d930"),Object(f["a"])(J,F,V,!1,null,"29ec110e",null)),G=W.exports,K=s("08a9"),Q={name:"vote-panel",props:{voteId:{type:Number,required:!0},postId:{type:Number,required:!0},expandVotePanel:{type:Boolean,required:!1,default:!1},hideToggleButton:{type:Boolean,required:!1,default:!1}},components:{voteSkeletonText:E,voteSkeletonImage:O,VotePeople:G,HButton:n["a"],ElImageViewer:K["a"]},data(){return{modelVisible:!1,voteCollapse:!this.expandVotePanel,loading:!1,options:[],vote:{},total:0,selectedOptionIdList:[],showViewer:!1,primaryPictures:[],cardBorderVisible:!0}},computed:{...Object(h["d"])({isMobile:t=>t.media.isMobile}),currentUserHasVoted(){var t;return null===(t=this.options)||void 0===t?void 0:t.some(t=>null===t||void 0===t?void 0:t.voted)},voteHasExpired(){var t;return 1===(null===(t=this.vote)||void 0===t?void 0:t.status)},votePeopleButtonVisible(){var t;return 0===(null===(t=this.vote)||void 0===t?void 0:t.privacy)&&(this.voteHasExpired||this.currentUserHasVoted)},voteTimeStatus(){if(this.voteHasExpired)return"已结束";{const t=new Date(this.vote.endTime),e=new Date,s=t-e;if(s<0)return"已结束";const i=Math.floor(s/1e3),a=Math.floor(i/60),o=Math.floor(a/60),l=Math.floor(o/24);return l>0?`距结束还有${l}天${o%24}时`:o>0?`距结束还有${o}时${a%60}分`:a>0?`距结束还有${a}分${i%60}秒`:`距结束还有${i}秒`}},totalVoteCount:function(){return 0===this.vote.checkType?this.total:this.options.reduce((t,e)=>{var s;return null!==(s=t+(null===e||void 0===e?void 0:e.num))&&void 0!==s?s:0},0)}},mounted:function(){this.expandVotePanel&&this.handleVoteDataFetch()},methods:{handleCardMouseOver(){this.cardBorderVisible=!0},handleCardMouseLeave(){this.cardBorderVisible=!1},handleImageMouseOver(){this.cardBorderVisible=!1},handleImageMouseLeave(){this.cardBorderVisible=!0},calculateVotePercentage(t){return 0===this.totalVoteCount?"0%":t===this.totalVoteCount?"100%":(t/this.totalVoteCount*100).toFixed(2)+"%"},handlePreviewClose(){this.showViewer=!1},handlePreview(t){this.primaryPictures=[t],this.showViewer=!0},handleModelClose:function(){this.modelVisible=!1},handleVoteCollapse:function(){this.voteCollapse=!0},handleVoteExpand:async function(){this.voteCollapse=!1,await this.handleVoteDataFetch()},handleVoteDataFetch:async function(){this.loading=!0;try{const{code:t,vote:e,options:s,total:i,msg:a}=await p["a"].get(`${x["a"].info}${this.voteId}`);0!==t?this.$message({type:"warning",message:"获取投票信息失败: "+a}):(this.vote=null!==e&&void 0!==e?e:{},this.options=null!==s&&void 0!==s?s:[],this.total=i,this.selectedOptionIdList=s.filter(t=>null===t||void 0===t?void 0:t.voted).map(t=>t.id))}catch(t){this.$message({type:"error",message:"发生错误，请重试"})}finally{this.loading=!1}},handleSeeVotePeople:function(){this.modelVisible=!0},handleOptionClick:async function(t){0===this.vote.checkType?this.selectedOptionIdList.includes(t.id)?this.selectedOptionIdList=[]:this.selectedOptionIdList=[t.id]:this.selectedOptionIdList.includes(t.id)?this.selectedOptionIdList=this.selectedOptionIdList.filter(e=>e!==t.id):this.selectedOptionIdList.length<this.vote.max?this.selectedOptionIdList.push(t.id):this.$message({type:"warning",message:`最多只能选择${this.vote.max}项`})},handleVoteConfirm:async function(){try{const{code:t,msg:e}=await p["a"].post(x["a"].vote,{postId:this.postId,voteId:this.voteId,vote:this.selectedOptionIdList});0!==t?this.$message({type:"warning",message:"投票失败: "+e}):(this.$message({type:"success",message:"投票成功"}),this.handleVoteDataFetch())}catch(t){this.$message({type:"error",message:"发生错误，请重试"})}}}},X=Q,Y=(s("c9c2"),Object(f["a"])(X,b,C,!1,null,"67f0bcbc",null)),Z=Y.exports,tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-wrapper"},[e("div",{attrs:{id:"content"},domProps:{innerHTML:t._s(t.htmlTemplate)}})])},et=[],st={name:"detail-content",props:["content","isTop"],data(){return{contentLocal:""}},computed:{...Object(h["d"])({isMobile:t=>t.media.isMobile}),htmlTemplate(){const t=this.isTop?'<div class="top-label">置顶</div>':"";return`<div class="content">${t}${this.content}</div>`}}},it=st,at=(s("cd15"),Object(f["a"])(it,tt,et,!1,null,"6148e4a7",null)),ot=at.exports,lt=function(){var t=this,e=t._self._c;return e("el-popover",{attrs:{width:80,"popper-class":"post-action-popover",placement:"bottom",trigger:"click"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("ul",{staticClass:"post-action-list"},[t.observedPostStatus.isAdmin&&"post"==t.type?t._l(t.actionNameList,(function(s){return e("li",{key:s.id,staticClass:"post-action-list-item",on:{click:function(e){return t.handleExcuteAction(s.id)}}},[t._v(" "+t._s(s.name)+" ")])})):t._e(),t.observedPostStatus.isAdmin?e("ul",{staticClass:"post-action-list-item"},t._l(t.operations,(function(s){return e("li",{key:s.text,on:{click:s.callback}},[t._v(" "+t._s(s.text)+" ")])})),0):t._e(),t.observedPostStatus.isAdmin&&"post"==t.type&&2!==t.postData.detailData.status?e("li",{staticClass:"post-action-list-item",on:{click:t.handleLock}},[t._v(" 锁定帖子 ")]):t._e(),t.observedPostStatus.isAdmin&&"post"==t.type&&2===t.postData.detailData.status?e("li",{staticClass:"post-action-list-item",on:{click:t.handleUnLock}},[t._v(" 解锁帖子 ")]):t._e(),t.isSelf&&"post"==t.type&&0===t.postData.detailData.type?e("li",{staticClass:"post-action-list-item",on:{click:t.handleEdit}},[t._v(" 编辑帖子 ")]):t._e(),t.isSelf||t.observedPostStatus.isAdmin?e("li",{staticClass:"post-action-list-item",on:{click:t.handleDelete}},[t._v(" "+t._s(t.actionText)+" ")]):t._e(),"floor"==t.type&&(t.isAuthor||t.observedPostStatus.isAdmin)?e("li",{staticClass:"post-action-list-item",on:{click:t.setTop}},[t._v(" "+t._s(t.topText)+" ")]):t._e(),"post"==t.type?e("li",{staticClass:"post-action-list-item",on:{click:t.handleReportPost}},[t._v("举报帖子")]):t._e()],2),e("div",{staticClass:"post-action__origin",attrs:{slot:"reference"},slot:"reference"},["post"===t.type||t.isSelf||t.observedPostStatus.isAdmin||t.isAuthor?e("i",{staticClass:"hanser icon-gengduo"}):t._e()])])},nt=[],rt=s("69d5");const ct=[{type:"post",title:"删帖确认",needId:!1},{type:"floor",title:"删除楼层确认",needId:!0},{type:"reply",title:"删除回复确认",needId:!0}],dt={"删帖确认":"请输入删帖原因","删除楼层确认":"请输入删楼层原因","删除回复确认":"确认删除？"};var ht={name:"post-action",inject:["postId","postMethods","observedPostStatus","postData"],props:["type","isSelf","id","userInfo","isTop","isAuthor"],data(){return{visible:!1}},computed:{actionNameList(){const t={...rt["b"]},{isValued:e,isToped:s}=this.observedPostStatus;e?t["5"]=null:t["6"]=null,s?t["7"]=null:t["8"]=null;const i=[];for(const[a,o]of Object.entries(t))a&&o&&i.push({id:a,name:o});return i},actionText(){switch(this.type){case"post":return"删除帖子";case"reply":return"删除回复";case"floor":return"删除楼层";default:return""}},topText(){return this.isTop?"取消置顶":"置顶"},operations(){return this.observedPostStatus.isAdmin?[{text:"封禁",icon:"icon-fengjin",callback:this.banUser}]:[]},...Object(h["d"])({isMobile:t=>t.media.isMobile})},methods:{async handleExcuteAction(t){try{if(!this.postId)return;const e=rt["a"][t];if(!e)return;await e(this.postId),this.$message({type:"success",message:(rt["b"][t]||"操作")+"成功~"}),await this.postMethods(this.postId)}catch(e){console.log(e)}},handleLock(){this.$confirm("锁定帖子后，除本人以外无法在首页刷到此贴，是否锁定","锁定帖子",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(()=>{this.$emit("handleLock",{type:this.type,id:this.id})}).catch(()=>{this.$message({type:"success",message:"已取消锁定~"})})},handleUnLock(){this.$confirm("解锁帖子后，所有人可在首页刷到此贴，是否解锁","解锁帖子",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(()=>{this.$emit("handleUnLock",{type:this.type,id:this.id})}).catch(()=>{this.$message({type:"success",message:"已取消解除锁定~"})})},handleDelete(){let t=ct.find(t=>t.type===this.type);this.$confirm(dt[t.title],t.title,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",showInput:this.observedPostStatus.isAdmin&&!this.isSelf,inputPlaceholder:"内容包含违规信息",inputType:"textarea",inputValue:"",closeOnClickModal:!1}).then(({value:e})=>{const s=null!==e&&void 0!==e?e:"";t.needId?this.$emit("handleDelete",{type:this.type,id:this.id,reason:s}):this.$emit("handleDelete",{type:this.type,reason:s})}).catch(()=>{this.$message({type:"success",message:"已取消删除~"})})},setTop(){this.visible=!1,this.$emit("set-top",{id:this.id})},banUser(){this.visible=!1,this.$showBanDialog(this.userInfo,0,this.isMobile,()=>{})},handleEdit(){this.visible=!1,this.$emit("handleEdit")},async handleReportPost(){this.visible=!1;const t=await this.$showReportDialog();t&&this.$emit("handleReportPost",{reason:t})}}},pt=ht,ut=(s("de6d"),Object(f["a"])(pt,lt,nt,!1,null,null,null)),vt=ut.exports,mt={components:{DetailContent:ot,PostAction:vt,PostUser:w["a"],VotePanel:Z},name:"post-details",props:["levels","detail","isSelf"],data(){return{showLike:!1,detailData:{},defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png"}},beforeMount(){this.detailData=this.detail},computed:{...Object(h["d"])({user:t=>t.users.userInfo}),level(){const{exp:t}=this.detailData.author;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},avatar(){return this.detailData.author.avatar||this.defaultAvatar},favoriteText(){return this.detailData.favorite?"已收藏":"收藏"},postTime(){var t=Date.parse(new Date(this.detailData.post_time.substr(0,10).toString().replace(/-/g,"/")+" "+this.detailData.post_time.substr(11,8).toString().replace(/-/g,"/"))),e=new Date(t+576e5).toISOString();return e.replace(/T/g," ").substr(0,16)},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t}},methods:{labelStyle(t){return`background: ${t.color};`},like(){!this.detailData.liked&&this.user.uid&&(this.showLike=!0,setTimeout(()=>{this.showLike=!1},1e3)),this.$emit("likePost")},favorite(){this.$emit("favorite")},handleDelete(t){this.$emit("delete",t)},handleEdit(){this.$emit("edit")},handleLock(t){this.$emit("lock",t)},handleUnLock(t){this.$emit("unlock",t)},handleReportPost(t){this.$emit("reportPost",t)}}},ft=mt,gt=(s("4718"),Object(f["a"])(ft,_,k,!1,null,"b9cd44c8",null)),yt=gt.exports,_t=function(){var t=this,e=t._self._c;return e("div",[e("span",{staticClass:"replyLocate"}),e("div",{staticClass:"post-reply"},[e("div",{staticClass:"post-reply-head"},[t._m(0),e("post-reply-order")],1),t.replyShow?e("div",[t.repliesLocal.length>0?e("div",{staticClass:"post-reply-main"},t._l(t.replyList,(function(s,i){return e("div",{key:s.floorId+""+i,staticClass:"post-reply__box",attrs:{"data-on-top":s.onTop}},[e("div",{staticClass:"post-reply__box-main"},[e("post-user",{attrs:{type:"post-details",avatar:s.author.avatar,size:50,auth:s.author.auth,authentication:s.author.authentication,nickname:s.author.nickname,uid:s.author.uid,colors:s.author.levelLabel.color,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser},scopedSlots:t._u([{key:"bottom",fn:function(){return[e("span",{staticClass:"post-reply__tag-time"},[t._v(t._s(s.formatPostTime))]),s.location?e("span",{staticClass:"ip-location"},[t._v(t._s(s.location))]):t._e()]},proxy:!0}],null,!0)},[s.author.isPostMaster?e("template",{slot:"post-master"},[e("post-master")],1):t._e()],2),e("div",{staticClass:"post-reply__box-text"},[e("detail-content",{staticClass:"post-content",attrs:{isTop:s.isTop,content:s.content}})],1),e("div",{staticClass:"post-reply__box-banner"},[s.onTop?t._e():e("span",{staticClass:"post-reply__tag-floor"},[t._v(t._s(s.floor)+"楼")]),e("span",{staticClass:"post-reply__tag-like",class:{liked:s.liked},on:{click:function(e){return t.like(s.floorId,i,s)}}},[s.showLike?e("div",{staticClass:"like-animation"},[e("img",{attrs:{src:"https://cdn.2550505.com/share/legacy-sso/like.gif",width:"64",height:"42"}})]):t._e(),e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}})],1),t._v(" "+t._s(s.likes)+" ")]),t.isMobile?e("span",{staticClass:"post-reply__tag-reply",on:{click:function(e){return t.showReplyFloor(s)}}},[e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]):e("span",{staticClass:"post-reply__tag-reply",on:{click:function(e){return t.replyFloor(s.floor,s.floorId,i)}}},[e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]),e("span",{staticClass:"post-reply__share"},[e("post-action",{attrs:{type:"floor",id:s.floorId,isAuthor:t.isAuthor,isTop:s.isTop,userInfo:s.author,isSelf:s.author.uid===t.user.uid},on:{"set-top":t.setFloorTop,handleDelete:t.handleDelete}})],1)]),s.hanserReply||s.hanserLike?e("div",{staticClass:"hanser-action"},[s.hanserReply?e("div",{staticClass:"hanser-reply"},[e("icon",{attrs:{icon:"hanser icon-huifu"}}),t._v(" hanser回复过 ")],1):t._e(),s.hanserLike&&!s.hanserReply?e("div",{staticClass:"hanser-like"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}}),t._v(" hanser赞过 ")],1):t._e()]):t._e(),e("div",{staticClass:"post-reply__box-reply"},[s.replies.length>0?e("list-reply",{ref:"listReply",refInFor:!0,attrs:{levels:t.levels,replies:s.replies,floor:s.floor,floorId:s.floorId,user:t.user,index:i},on:{followUser:t.followUser,replyReplyInReply:t.replyReplyInReply,openEditorInReply:t.openEditorInReply,getUserInfo:t.getUserInfo,handleDelete:t.handleDelete}}):t._e()],1),t.showFloorEditor[i]?e("div",{staticClass:"post-reply__box-editor"},[e("div",{staticClass:"post-details__editor-main"},[e("hanser-editor",{ref:"editor",refInFor:!0,attrs:{limit:1e3,useAt:!0},on:{post:t.handleReply}})],1),t.user.uid&&1!==t.user.status?t._e():e("div",{staticClass:"cover"},[t.user.uid?e("span",{staticClass:"tip-text"},[t._v(" 你已被封禁,封禁解除后才可发帖 ")]):e("span",{staticClass:"tip-text"},[e("router-link",{staticClass:"to-login",attrs:{to:"/login"}},[t._v("登录")]),t._v(" 后才可回复 ")],1)])]):t._e()],1)])})),0):e("div",{staticClass:"post-reply-main"},[e("p",[t._v("暂无回复")])]),t.isMobile?e("load-more",{key:"post-reply",attrs:{name:"post-reply","have-more":!t.loadDone},on:{"load-more":t.loadMoreReplys}}):t._e(),t.isMobile?t._e():e("div",{staticClass:"post-reply-bottom"},[e("el-pagination",{attrs:{"prev-text":"上一页","next-text":"下一页","current-page":t.page,"page-size":10,layout:"prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1):e("reply-skeleton")],1)])},kt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-reply-head__title"},[e("span",[t._v("帖子回复")])])}],wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"list-reply"},[t._l(t.showReplies,(function(s,i){return e("div",{key:i},[s.show?e("div",{staticClass:"list-reply__box"},[e("div",{staticClass:"list-reply__box-main"},[e("div",{staticClass:"list-reply__box-top"},[e("div",{staticClass:"list-reply__username"},[s.mention?t._e():[e("div",{staticClass:"reply-wrapper"},[e("brief-author",{attrs:{type:"post-details",avatar:s.author.avatar,iconSize:14,size:t.size,colors:s.author.levelLabel.color,auth:s.author.auth,uid:s.author.uid,authentication:s.author.authentication,nickname:s.author.nickname,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[s.author.isPostMaster?e("post-master"):t._e()],1),e("span",{staticClass:"colon"},[t._v("：")])],1),e("div",{staticClass:"list-reply__text post-content",domProps:{innerHTML:t._s(s.content)}})],s.mention?[e("div",{staticClass:"reply-wrapper"},[e("brief-author",{attrs:{type:"post-details",avatar:s.author.avatar,iconSize:14,size:t.size,colors:s.author.levelLabel.color,auth:s.author.auth,uid:s.author.uid,authentication:s.author.authentication,nickname:s.author.nickname,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[s.author.isPostMaster?e("post-master"):t._e()],1),s.mention?e("span",{staticClass:"reply-text"},[t._v("回复")]):t._e(),s.mention&&s.mention.author?e("replied-user",{attrs:{nickname:s.mention.author.nickname,uid:s.mention.author.uid,colors:s.mention.author.levelLabel.color}},[s.mention.author.isPostMaster?e("post-master"):t._e()],1):t._e(),s.mention&&!s.mention.author?e("span",{staticClass:"noreply-text"},[t._v("内容已被删除")]):t._e(),s.mention?e("span",{staticClass:"colon"},[t._v("：")]):t._e()],1),e("div",{staticClass:"list-reply__text post-content",domProps:{innerHTML:t._s(s.content)}})]:t._e()],2)]),e("div",{staticClass:"list-reply__box-banner"},[e("span",{staticClass:"list-reply__tag-time"},[t._v(" "+t._s(s.formatPostTime)+" ")]),s.location?e("span",{staticClass:"ip-location"},[t._v(t._s(s.location))]):t._e(),t.isMobile?e("span",{staticClass:"list-reply__tag-reply",on:{click:function(e){return t.showReplyFloor(s,i)}}},[e("div",{staticClass:"list-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]):e("span",{staticClass:"list-reply__tag-reply",on:{click:function(e){return t.openEditor(s,i)}}},[e("div",{staticClass:"list-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]),e("span",{staticClass:"list-reply__share"},[e("post-action",{attrs:{type:"reply",id:s.id,userInfo:s.author,isSelf:s.author.uid===t.user.uid},on:{handleDelete:t.handleDelete}})],1)]),s.editorShow?e("div",{staticClass:"list-reply__box-editor"},[e("div",{staticClass:"post-details__editor-main"},[e("hanser-editor",{ref:"editor",refInFor:!0,staticClass:"post-editor",attrs:{useAt:!0,limit:1e3},on:{post:e=>t.handleReply(e,s)}})],1),t.user.uid&&1!==t.user.status?t._e():e("div",{staticClass:"cover"},[t.user.uid?e("span",{staticClass:"tip-text"},[t._v(" 你已被封禁,封禁解除后才可发帖 ")]):e("span",{staticClass:"tip-text"},[e("router-link",{staticClass:"to-login",attrs:{to:"/login"}},[t._v("登录")]),t._v(" 后才可回复 ")],1)])]):t._e()])]):t._e()])})),t.replies.length>10&&t.showAllReplies&&!this.isMobile?e("div",{staticClass:"list-reply-bottom"},[e("el-pagination",{attrs:{"prev-text":"上一页","next-text":"下一页","current-page":t.page,"page-size":10,layout:"prev, pager, next, jumper",total:t.replies.length},on:{"current-change":t.handleCurrentChange}})],1):t._e(),t.replies.length>3?e("div",{staticClass:"list-reply__action"},[e("span",{staticClass:"list-reply__action-text"},[t._v("共"+t._s(t.replies.length)+"条回复")]),e("span",{staticClass:"list-reply__action-expand",on:{click:t.expandReply}},[t._v(t._s(t.expandShowText))])]):t._e()],2)},bt=[],Ct=s("e100"),xt=s("9fbf"),It=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-master"},[t._v("楼主")])},St=[],Pt={name:"post-master"},$t=Pt,Lt=(s("ad97"),Object(f["a"])($t,It,St,!1,null,"b36d0dd8",null)),Et=Lt.exports,Dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"replied-user"},[e("level-nickname",{attrs:{nickname:t.nickname,uid:t.uid,colors:t.colors}}),t._t("default")],2)},Tt=[],At={name:"replied-user",props:["nickname","colors","uid"],components:{LevelNickname:c["a"]}},Rt=At,Ut=(s("d1e1"),Object(f["a"])(Rt,Dt,Tt,!1,null,"51212048",null)),Ot=Ut.exports,Ft=s("b0b1"),Vt={name:"list-reply",props:["replies","floor","floorId","levels","user","index"],components:{HanserEditor:Ft["a"],BriefAuthor:xt["a"],PostMaster:Et,PostAction:vt,RepliedUser:Ot},data(){return{defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",replyContent:"",currentShowIndex:-1,repliesLocal:[],repliesShowBrief:[],loading:!1,showAllReplies:!0,num:0,postReply:"",page:1}},created(){let t=JSON.parse(JSON.stringify(this.replies));if(this.replies.length>3){this.showAllReplies=!1;const e=JSON.parse(JSON.stringify(t.slice(0,3)));this.repliesShowBrief=this.preProcessForAll(e)}this.repliesLocal=this.preProcessForAll(t)},computed:{...Object(h["d"])({isMobile:t=>t.media.isMobile,theme:t=>t.config.theme,themeWithAvatarBorder:t=>t.config.themeWithAvatarBorder}),showReplies(){return this.showAllReplies?this.isMobile?this.repliesLocal:this.repliesLocal.slice(10*(this.page-1),10*this.page):this.repliesShowBrief},expandShowText(){return this.showAllReplies?"点击收起":"展开全部"},size(){return this.themeWithAvatarBorder.includes(this.theme)?50:30}},methods:{handleReply(t,e){this.replyContent=t;const s=this.replyContent;0==this.replyContent.length?this.$message({type:"warning",message:"请输入回复内容"}):s.match(/^[ ]*$/)?this.$message({type:"warning",message:"输入不能全为空格~"}):(this.loading=!0,this.$emit("replyReplyInReply",{content:this.replyContent,floorId:this.floorId,uid:e.author.uid,id:e.id}),this.replyContent="",setTimeout(()=>{this.loading=!1},5e3))},async showReplyFloor(t){this.replyContent=await this.$showContentEditor("回复楼中楼"),this.replyContent&&this.handleReply(this.replyContent,t)},openEditor(t,e){this.currentShowIndex!=e?(-1!=this.currentShowIndex?this.closeEditors(!0):this.$emit("openEditorInReply",{reply:t,floor:this.floor,floorId:this.floorId,index:this.index}),t.editorShow=!0,this.currentShowIndex=e,this.postReply=`回复@${t.author.nickname}：`,this.$nextTick(()=>{const t=document.getElementsByClassName("list-reply__box-editor-input")[0];null===t||void 0===t||t.scrollIntoView({block:"center",behavior:"smooth"})})):this.closeEditors(!0)},getUserInfo(t){this.$emit("getUserInfo",t)},followUser(t,e){this.$emit("followUser",t,e)},expandReply(){this.showAllReplies=!this.showAllReplies},toUser(t){window.open("/space/"+t)},closeEditors(t){this.repliesLocal.forEach((t,e)=>{this.$set(this.repliesLocal[e],"editorShow",!1),this.repliesShowBrief[e]&&this.$set(this.repliesShowBrief[e],"editorShow",!1)}),t&&(this.currentShowIndex=-1)},preProcessForAll(t){var e=JSON.parse(JSON.stringify(t));return e.forEach((t,s)=>{var i;e[s].formatPostTime=Object(Ct["a"])(t.time),e[s].editorShow=!1,e[s].show=!0;const a=this.level(t.author.exp);if(Object.assign(t.author,{level:a,levelLabel:this.levels.find(t=>t.level===a.level)}),null!=(null===t||void 0===t||null===(i=t.mention)||void 0===i?void 0:i.author)){const e=this.level(t.mention.author.exp);Object.assign(t.mention.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})}}),JSON.parse(JSON.stringify(e))},handleCurrentChange(t){this.closeEditors(!0),this.page=t},handleDelete(t){this.$emit("handleDelete",t)},level(t){let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e}}},Mt=Vt,Ht=(s("8e01"),Object(f["a"])(Mt,wt,bt,!1,null,"02f8f478",null)),jt=Ht.exports,zt=s("4445"),Bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"reply-skeleton"},[e("el-skeleton",{attrs:{animated:"",count:5}},[e("template",{slot:"template"},[e("div",{staticClass:"sk-body"},[e("div",{staticClass:"sk-body__aside"},[e("el-skeleton-item",{staticStyle:{width:"50px",height:"50px"},attrs:{variant:"image"}})],1),e("div",{staticClass:"sk-body__main"},[e("div",{staticClass:"sk-info"},[e("el-skeleton-item",{staticStyle:{width:"64px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"80px",margin:"0 5px"},attrs:{variant:"text"}})],1),e("el-skeleton-item",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}})],1)]),e("div",{staticClass:"sk-divider"})])],2)],1)},Nt=[],qt={name:"reply-skeleton"},Jt=qt,Wt=(s("7984"),Object(f["a"])(Jt,Bt,Nt,!1,null,"2bf9a7f8",null)),Gt=Wt.exports,Kt=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"post-reply-order"},[e("div",{staticClass:"order__checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.replyType,expression:"replyType"}],staticClass:"order__checkbox-toggle",attrs:{id:"cb",type:"checkbox"},domProps:{checked:Array.isArray(t.replyType)?t._i(t.replyType,null)>-1:t.replyType},on:{change:function(e){var s=t.replyType,i=e.target,a=!!i.checked;if(Array.isArray(s)){var o=null,l=t._i(s,o);i.checked?l<0&&(t.replyType=s.concat([o])):l>-1&&(t.replyType=s.slice(0,l).concat(s.slice(l+1)))}else t.replyType=a}}}),t._m(0)])])},Qt=[function(){var t=this,e=t._self._c;return e("label",{staticClass:"order__checkbox-toggle",attrs:{for:"cb"}},[e("span",{staticClass:"order__checkbox-toggle__item"})])}],Xt={name:"post-reply-order",data(){return{replyType:Number(this.$route.query.order)||0}},watch:{replyType(t){this.$router.replace({path:this.$route.path,query:{order:Number(t)}})}}},Yt=Xt,Zt=(s("779e"),Object(f["a"])(Yt,Kt,Qt,!1,null,"0e342fb4",null)),te=Zt.exports,ee=s("365c"),se=s("ed08"),ie=s.n(se),ae={name:"post-reply",props:["levels","user","isMobile","currentPostId","isAuthor"],data(){return{defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",replyContent:"",repliesLocal:[],topReplies:[],showFloorEditor:[],currentShowEditor:-1,currentShowFloorEditor:-1,currentFloorId:-1,currentReplyId:-1,page:1,pageSize:10,loading:!1,authorOnly:!1,showLike:!1,loadDone:!1,replyShow:!1,total:null,totalFloor:null,liking:!1}},components:{ListReply:jt,HanserEditor:Ft["a"],DetailContent:ot,PostAction:vt,LoadMore:zt["a"],PostUser:w["a"],PostMaster:Et,ReplySkeleton:Gt,PostReplyOrder:te},watch:{currentPostId(t){t&&this.changePage(3)},"$route.query.order"(){this.changePage(1)}},async mounted(){this.currentPostId&&await this.changePage(3)},methods:{...Object(h["c"])({addUserExp:"users/addUserExp"}),openChat(t){const e=new CustomEvent("open-chat",{detail:{uid:t}});window.dispatchEvent(e)},getLevels(){this.repliesLocal.forEach(t=>{const e=this.level(t.author.exp);t.author=Object.assign(t.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})}),this.topReplies.forEach(t=>{const e=this.level(t.author.exp);t.author=Object.assign(t.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})})},level(t){let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},async like(t,e,s){!s.liked&&this.user.uid?(s.showLike=!0,1===this.user.uid&&(s.hanserLike=!0),setTimeout(()=>{s.showLike=!1},1e3)):s.liked&&this.user.uid&&1===this.user.uid&&(s.hanserLike=!1),this.checkLogin()&&(this.liking?this.$message({type:"warning",message:"操作太快了~"}):(this.liking=!0,await p["a"].post(ee["a"].likeReply+t+"?liked="+s.liked).then(e=>{0==e.code&&(this.addUserExp(e.exp),1==e.status?(this.repliesLocal.forEach(e=>{e.floorId===t&&(e.liked=!0,e.likes+=1)}),this.topReplies.forEach(e=>{e.floorId===t&&(e.liked=!0,e.likes+=1)})):(this.repliesLocal.forEach(e=>{e.floorId===t&&(e.liked=!1,e.likes-=1)}),this.topReplies.forEach(e=>{e.floorId===t&&(e.liked=!1,e.likes-=1)})),this.liking=!1)})))},replyFloor(t,e,s){var i;if(null===(i=this.$refs["listReply"])||void 0===i||i.forEach(t=>{t.closeEditors(!0)}),this.currentShowFloorEditor=-1,this.currentReplyId=-1,-1!=this.currentShowEditor){if(this.currentShowEditor==s)return this.clearShowFloorEditor(),this.currentShowEditor=-1,void(this.currentFloorId=-1);this.clearShowFloorEditor()}this.$set(this.showFloorEditor,s,!0),this.currentShowEditor=s,this.currentFloorId=e,this.$nextTick(()=>{const t=document.getElementsByClassName("post-reply__box-editor-input")[0];"undefined"!==typeof t&&t.scrollIntoView({block:"center",behavior:"smooth"})})},async showReplyFloor(t){this.replyContent=await this.$showContentEditor("回复楼层"),this.currentFloorId=t.floorId,this.replyContent&&this.$emit("replyFloor",{content:this.replyContent,floorId:this.currentFloorId})},openEditorInReply(t){const{reply:e,floorId:s,index:i}=t;if(this.$refs["listReply"].forEach((t,e)=>{e!=i&&t.closeEditors(!0),e==i&&t.closeEditors(!1)}),-1!=this.currentShowEditor&&(this.clearShowFloorEditor(),this.currentShowEditor=-1,this.currentFloorId=-1),-1!=this.currentShowFloorEditor){if(this.currentShowFloorEditor==i&&e.id==this.currentReplyId)return this.$set(this.showFloorEditor,this.currentShowFloorEditor,!1),this.$refs["listReply"].forEach((t,e)=>{e!=i&&t.closeEditors(!0),e==i&&t.closeEditors(!1)}),this.currentShowFloorEditor=-1,void(this.currentFloorId=-1);this.$set(this.showFloorEditor,this.currentShowFloorEditor,!1)}this.currentShowFloorEditor=i,this.currentFloorId=s,this.currentReplyId=e.id},clearShowFloorEditor(){this.showFloorEditor.forEach((t,e)=>{this.$set(this.showFloorEditor,e,!1)})},handleReply(t){this.replyContent=t;const{plaintext:e}=ie.a.parseHtml(t);e?(this.loading=!0,this.$emit("replyFloor",{content:this.replyContent,plaintext:e,floorId:this.currentFloorId}),this.replyContent="",setTimeout(()=>{this.loading=!1},5e3)):(this.$message({type:"warning",message:"请输入回复的内容~"}),this.replyContent="")},handleCurrentChange(t){this.page=t,this.changePage(4)},replyReplyInReply(t){this.$emit("replyReplyInReply",t)},getUserInfo(t){this.$emit("getUserInfo",t)},followUser(t,e){this.$emit("followUser",t,e)},showAuthorOnly(){},handleDelete(t){this.$emit("delete",t)},setFloorTop(t){p["a"].post(ee["a"].replySetTop,{postId:this.currentPostId,replyId:t.id}).then(t=>{0===t.code?(this.$message({type:"success",message:t.msg}),window.location.reload()):this.$message({type:"warning",message:t.msg})})},loadMoreReplys(){this.loadDone||(this.page++,this.changePage(2))},async changePage(t){1==t&&this.isMobile?(this.page=1,this.replyShow=!1,this.loadDone=!1):1==t&&(this.replyShow=!1);const e={page:this.page,pageSize:this.pageSize,order:this.$route.query.order||0};await p["a"].get(ee["a"].replyList+this.currentPostId,{params:e}).then(e=>{if(0==e.code){e.list.length<this.pageSize&&(this.loadDone=!0),this.totalFloor+=e.list.length;const s=document.getElementsByClassName("layout-body")[0],i=document.getElementsByClassName("post-content")[0];switch(this.isMobile||e.list.forEach(t=>{const e=document.createElement("div");e.innerHTML=t.content;const s=e.getElementsByTagName("iframe");Array.from(s).forEach(t=>{t.setAttribute("height","400")}),t.content=e.innerHTML}),1===this.page&&(this.topReplies=e.topList,this.topReplies.forEach((t,e)=>{this.$set(this.topReplies[e],"editorShow",!1),this.$set(this.topReplies[e],"showLike",!1),this.$set(this.topReplies[e],"onTop",!0),this.showFloorEditor.push(!1);const s=Object(Ct["a"])(t.time);this.$set(this.topReplies[e],"formatPostTime",s)})),t){case 1:this.repliesLocal=[...e.list],this.total=e.total,this.scrollToTop();break;case 2:this.repliesLocal.push(...e.list),this.total+=e.total;break;case 3:this.repliesLocal=e.list,this.total=e.total;break;case 4:this.repliesLocal=e.list,this.total=e.total,s.scrollTop=i.clientHeight+25;break;default:this.repliesLocal=e.list,this.total=e.total}this.getLevels(),this.showFloorEditor=[],this.repliesLocal.forEach((t,e)=>{this.$set(this.repliesLocal[e],"editorShow",!1),this.$set(this.repliesLocal[e],"showLike",!1),this.showFloorEditor.push(!1);const s=Object(Ct["a"])(t.time);this.$set(this.repliesLocal[e],"formatPostTime",s)}),this.replyShow=!0,this.isMobile&&1==t&&this.scrollToReply()}})},scrollToTop(){const t=document.getElementsByClassName("layout-body")[0];t.scrollTop=0},scrollToReply(){const t=document.getElementsByClassName("replyLocate")[0];"undefined"!==typeof t&&t.scrollIntoView({behavior:"smooth"})},checkLogin(){return!!this.user.uid||(this.$message({type:"warning",message:"请登录后重试"}),!1)}},computed:{replyList(){return[...this.topReplies,...this.repliesLocal]}}},oe=ae,le=(s("b533"),s("7198"),s("cf1b"),Object(f["a"])(oe,_t,kt,!1,null,"aa3b3e70",null)),ne=le.exports,re=function(){var t=this,e=t._self._c;return e("div",{staticClass:"author-skeleton"},[e("el-skeleton",{attrs:{animated:""}},[e("template",{slot:"template"},[e("div",{staticClass:"sk-title"},[e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body"},[e("div",{staticClass:"sk-body__image"},[e("el-skeleton-item",{staticStyle:{width:"80px",height:"80px"},attrs:{variant:"image"}})],1),e("div",{staticClass:"sk-body__username"},[e("el-skeleton-item",{staticStyle:{width:"50px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__label"},[e("el-skeleton-item",{staticStyle:{width:"114px",height:"20px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__info"},[e("el-skeleton-item",{staticStyle:{width:"150px",height:"32px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__action"},[e("el-skeleton-item",{staticStyle:{width:"78px",height:"40px"},attrs:{variant:"text"}})],1)])])],2)],1)},ce=[],de={name:"author-skeleton"},he=de,pe=(s("9264"),Object(f["a"])(he,re,ce,!1,null,"896397ca",null)),ue=pe.exports,ve=s("a026");const me={detailPost(t){return p["a"].get(ee["a"].detailPost+t)},postReply(t){return p["a"].post(ee["a"].replyPost+t.postId,t)},postReplyByFloor(t,e){const s={postId:t,...e};return p["a"].post(ee["a"].replyPostByFloor+e.floorId,s)},getFollows(t,e,s){const i={uid:t,page:e,pageSize:s};return p["a"].get(ee["a"].followList,{params:i})},getFollowsTotal(t){const e={uid:t};return p["a"].get(ee["a"].followTotal,{params:e})},follow(t,e){const s={uid:t,following:e};return p["a"].post(ee["a"].follow+"/"+t,s)},likeAPost(t,e,s){const i={author:t,liked:s};return p["a"].post(ee["a"].like+"/"+e,i)},lockPost(t){return p["a"].post(ee["a"].lock+"/"+t)},unLockPost(t){return p["a"].post(ee["a"].unlock+t)},replyReply(t){return p["a"].post(ee["a"].replyReply+t.floorId,t)},favoritePost(t,e){return p["a"].post(ee["a"].postFavorite+t+"?favorite="+e)},deletePost(t,e=""){return p["a"].post(ee["a"].deletePost+t,{reason:e})},deleteReply(t,e=""){return p["a"].post(ee["a"].deleteReply+t,{reason:e})},deleteFloor(t,e=""){return p["a"].post(ee["a"].deleteFloor+t,{reason:e})},reportPost(t,e,s){return p["a"].post(ee["a"].reportPost,{postId:t,author:e,desciption:s})}},fe=ve["default"].observable({isAdmin:!1,isToped:!1,isValued:!1,isSelf:!1,isHanser:!1});var ge={name:"post-details",data(){return{currentPostId:"",detailData:{},replies:[],authorInfoShow:!1,contentShow:!1,postContent:"",defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",pageSize:10,isFollowing:!1,liking:!1,isSelf:!1,myData:{follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0},lastUidInfo:0,popoverUserData:{follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0},popoverState:{isSelf:!1,popoverLoading:!0},replyLoading:!1}},metaInfo(){return{title:(this.detailData.title||"")+" - 毛怪俱乐部",meta:[{name:"keywords",content:""+this.tagsText},{name:"description",content:""+(this.detailData.title||"")}]}},components:{PostContent:yt,PostReply:ne,PostAuthor:y,ContentSkeleton:N,AuthorSkeleton:ue,HanserEditor:Ft["a"]},provide(){var t,e;return{postData:this.$data,postMethods:this.getCurrentPostId,postId:(null===this||void 0===this||null===(t=this.$route)||void 0===t||null===(e=t.params)||void 0===e?void 0:e.postId)||0,observedPostStatus:fe}},computed:{...Object(h["d"])({levels:t=>t.level.levels,user:t=>t.users.userInfo,isMobile:t=>t.media.isMobile}),...Object(h["b"])("users",{isAdmin:"isAdmin",isHanser:"isHanser"}),avatar(){return this.user.avatar||this.defaultAvatar},tagsText(){const t=["毛怪","hanser","社区","毛怪俱乐部"];return this.detailData.tags?(this.detailData.tags.forEach(e=>t.unshift(e.tagName)),[...new Set(t)].join(",")):""},cammandList(){const{uid:t,avatar:e,nickname:s}=this.user;return[{id:2,cammand:"签到天数",data:{uid:t,avatar:e,nickname:s}}]}},async mounted(){var t,e;this.currentPostId=(null===this||void 0===this||null===(t=this.$route)||void 0===t||null===(e=t.params)||void 0===e?void 0:e.postId)||0,await this.getMyData(),await this.getCurrentPostId(this.currentPostId),this.getPostData()},methods:{...Object(h["c"])({addUserExp:"users/addUserExp"}),async getCurrentPostId(t){await me.detailPost(t).then(t=>{var e;if(0!==t.code)return this.$message({type:"warning",message:t.msg}),void(404===t.code&&this.$router.replace("/post_not_found"));if(!this.isMobile){const e=document.createElement("div");e.innerHTML=t.info.content;const s=e.getElementsByTagName("iframe");Array.from(s).forEach(t=>{t.setAttribute("height","400")}),t.info.content=e.innerHTML}this.isFollowing=(null===(e=t.info.author)||void 0===e?void 0:e.focusHe)||!1,this.detailData=t.info,this.contentShow=!0});const e=this.detailData.author.uid;e==this.user.uid&&(this.isSelf=!0),fe.isAdmin=this.isAdmin,fe.isHanser=this.isHanser,fe.isToped=this.detailData.top,fe.isValued=this.detailData.valued,fe.isSelf=this.isSelf,await this.getUserData(e).then(t=>{this.detailData.author=Object.assign(this.detailData.author,t),this.authorInfoShow=!0})},async getUserData(t){const e={uid:t},{data:s}=await p["a"].get(ee["a"].dataCount,{params:e});return{follow:s.follow,fans:s.fans,posts:s.post,bilibiliScore:s.bilibiliScore,douyuScore:s.douyuScore}},async handlePost(t){if(!this.checkLogin())return;const{ats:e,pictures:s,videos:i,plaintext:a}=ie.a.parseHtml(t);if(0==a.length)return void this.$message({type:"warning",message:"请输入回复的内容~"});this.replyLoading=!0;const o={postId:Number(this.currentPostId),content:t,author:this.detailData.author.uid,ats:e,pictures:s,videos:i,plaintext:a};me.postReply(o).then(t=>{0==t.code?(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["editor"].clear(),this.$refs["post-reply"].changePage(1),this.replyLoading=!1):(this.$message({type:"warning",message:t.msg}),this.replyLoading=!1)})},async handlePostByFloor(t){const{content:e,floorId:s}=t;if(!this.checkLogin())return;const{ats:i,pictures:a,videos:o,plaintext:l}=ie.a.parseHtml(e);await me.postReplyByFloor(Number(this.currentPostId),{content:e,floorId:s,ats:i,pictures:a,videos:o,plaintext:l}).then(t=>{0==t.code?(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["post-reply"].changePage(1)):this.$message({type:"warning",message:t.msg})})},favorite(){me.favoritePost(Number(this.currentPostId),this.detailData.favorite).then(t=>{0===t.code?(this.$message({type:"success",message:t.msg}),this.detailData.favorite=!!t.status):this.$message({type:"warning",message:t.msg})})},async getMyData(){this.user.uid&&await this.getUserData(this.user.uid).then(t=>{this.myData=t})},async followAuthor(t){this.checkLogin()&&await me.follow(t,this.isFollowing).then(t=>{0==t.code&&(1==t.relation||null==t.relation?(this.isFollowing=!0,this.$message({type:"success",message:t.msg})):(this.isFollowing=!1,this.$message({type:"success",message:t.msg})))})},edit(){this.$showEditDialog(this.detailData.title,this.detailData.content,this.detailData.id)},async likePost(){this.checkLogin()&&(this.liking?this.$message({type:"warning",message:"操作太快了~"}):await me.likeAPost(this.detailData.author.uid,Number(this.currentPostId),this.detailData.liked).then(t=>{0==t.code&&(this.addUserExp(t.exp),this.detailData.liked=t.liked,t.liked?this.detailData.likes++:this.detailData.likes--),this.liking=!1}))},async lockPost(){this.checkLogin()&&await me.lockPost(Number(this.currentPostId)).then(t=>{0==t.code&&(this.$message({type:"success",message:"已锁定"}),this.$router.go(0))})},async unLockPost(){if(!this.checkLogin())return;const t=await me.unLockPost(Number(this.currentPostId));0==t.code&&(this.$message({type:"success",message:"已解锁"}),this.$router.go(0))},async replyReplyInReply(t){const{floorId:e,content:s,uid:i,id:a}=t,{ats:o,plaintext:l}=ie.a.parseHtml(s);this.checkLogin()&&await me.replyReply({uid:i,postId:+this.currentPostId,replyId:e,content:s,floorId:a,plaintext:l,ats:o}).then(t=>{0==t.code&&(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["post-reply"].changePage(1))})},checkLogin(){return!!this.user.uid||(this.$message({type:"warning",message:"请登录后重试"}),!1)},async getFollowList(t){return(await me.getFollows(t,null,null)).list},async getUserInfo(t){if(this.popoverState={isSelf:!1,popoverLoading:!0},t===this.user.uid)this.popoverUserData=this.myData,this.popoverState.isSelf=!0;else if(t!==this.lastUidInfo){this.popoverUserData={follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0};const e=await this.getUserData(t);this.popoverUserData=e}this.lastUidInfo=t,this.popoverState.popoverLoading=!1},async followUser(t,e=(()=>{})){this.checkLogin()&&await me.follow(t).then(s=>{0==s.code&&(1==s.relation||null==s.relation?(this.$message({type:"success",message:"关注成功~"}),t==this.detailData.author.uid&&(this.isFollowing=!0),e(!0)):(this.$message({type:"success",message:"取关成功~"}),t==this.detailData.author.uid&&(this.isFollowing=!1),e(!1)))})},async handleDelete(t){const{type:e}=t,{reason:s=""}=t;if("post"===e){const t=+this.currentPostId;await me.deletePost(t,s).then(t=>{0===t.code&&(this.$message({type:"success",message:"帖子已删除"}),this.$router.push("/"))})}else"floor"===e?await me.deleteReply(t.id,s).then(t=>{0==t.code&&(this.$message({type:"success",message:"楼层已删除"}),this.$refs["post-reply"].changePage(1))}):"reply"===e&&await me.deleteFloor(t.id,s).then(t=>{0==t.code&&(this.$message({type:"success",message:"回复已删除"}),this.$refs["post-reply"].changePage(1))})},getPostData(){const t={currentPostId:this.currentPostId,author:this.detailData.author};this.$emit("getPostData",t)},handleReportPost(t){const{reason:e=""}=t,s=+this.currentPostId;me.reportPost(s,this.detailData.author.uid,e).then(t=>{0===t.code?this.$message({type:"success",message:"举报成功"}):this.$message({type:"warning",message:t.msg})})}}},ye=ge,_e=(s("cf3d"),s("a197"),Object(f["a"])(ye,i,a,!1,null,"706aa396",null));e["default"]=_e.exports},f330:function(t,e,s){},f7cf:function(t,e,s){},fd01:function(t,e,s){"use strict";s("b717")}}]);