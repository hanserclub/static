(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67438f50"],{"20bd":function(t,e,s){"use strict";s("d831")},"29b0":function(t,e,s){"use strict";s.r(e);var o=s("feeb"),a=s("27e8"),i=s("dbbe"),r=s("6275"),n=s("f1f3");class l{constructor(){}get(t){var e;return console.log("[Draft] Getting draft: ",t),JSON.parse(null!==(e=localStorage.getItem("draft-"+t))&&void 0!==e?e:"{}")}save(t,e){console.log("[Draft] Saving draft: ",t,e),localStorage.setItem("draft-"+t,JSON.stringify(e))}clear(t){console.log("[Draft] Clear draft: ",t),localStorage.removeItem("draft-"+t)}}const c=new l;var d,h,v=c,p={name:"post-page",components:{PostEditor:a["a"],EditorProvider:o["a"],HButton:i["a"],HInput:r["a"]},props:{limitWords:Number,loading:Boolean,draftKey:String},data(){return{draftContent:"",postTitle:"",postContent:"",lockTime:!1,time:"",draftSaveTimer:null,isFirstSave:!0,toolbarConfig:["bold","italic","image","link","emoticons","video","vote"],pluginConfig:{[n["a"].IMAGE]:null,[n["a"].LINK]:null,[n["a"].MENTION]:null,[n["a"].HASH_TAG]:null,[n["a"].CHARACTER_COUNT]:{limit:this.limitWords||1e4}},voteData:{}}},beforeDestroy(){clearInterval(this.draftSaveTimer)},methods:{handlePost(){const t=/data:image\/.*;base64,/;if(t.test(this.postContent))return void this.$message({type:"danger",message:"有图片未通过编辑器上传，请勿直接拖拽或粘贴图片到编辑器"});let e={title:this.postTitle,content:this.postContent};e.voteData=this.voteData,this.lockTime&&this.time&&(e.lockTime=Number(this.lockTime),e.time=this.time),this.$emit("post",e)},clear(){this.postTitle="",this.postContent="",this.$refs["editor"].clearContent(),this.voteData={},this.$refs["editor"].resetForm(),v.clear(this.draftKey)},addContent(){this.draftContent=""},updateVoteData(t){this.voteData=t},onFocus(){var t,e;this.isFirstSave&&(null===(t=v.get(this.draftKey))||void 0===t||null===(e=t.content)||void 0===e?void 0:e.length)>0&&0===this.postContent.length?(this.isFirstSave=!1,this.$confirm("是否恢复本地草稿？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",zIndex:9999}).then(()=>{this.recoverDraft()}).finally(()=>{this.draftSaveTimer=setInterval(()=>{this.saveDraft()},5e3)})):this.draftSaveTimer||(this.draftSaveTimer=setInterval(()=>{this.saveDraft()},5e3))},onBlur(){this.draftSaveTimer&&clearInterval(this.draftSaveTimer),this.draftSaveTimer=null},saveDraft(t=!1){v.save(this.draftKey,{content:this.postContent}),t&&this.$message({type:"success",message:"已保存草稿~"})},recoverDraft(){var t;this.isFirstSave=!1;const e=v.get(this.draftKey);this.postContent=null!==(t=null===e||void 0===e?void 0:e.content)&&void 0!==t?t:"",this.$refs["editor"].setContent(this.postContent),this.$message({type:"success",message:"已恢复草稿~"})}},render(){const t=arguments[0];return t("div",{class:"post"},[t("div",{class:"post-header"},[t("img",{class:"post-creator-avatar"}),t("h-input",{class:"post-title-input",attrs:{maxlength:30,placeholder:"这里输入标题~"},model:{value:this.postTitle,callback:t=>{this.postTitle=t}}})]),t("editor-provider",{attrs:{type:"post",plugins:this.pluginConfig}},[t("post-editor",{ref:"editor",attrs:{draftContent:this.draftContent,toolbar:this.toolbarConfig,voteData:this.voteData,updateVoteData:this.updateVoteData,limit:this.limitWords||1e4},on:{focus:this.onFocus,blur:this.onBlur},model:{value:this.postContent,callback:t=>{this.postContent=t}}})]),t("div",{class:"post-footer"},[t("div",{class:"lock-time"},[t("el-checkbox",{class:"lock-time-checkbox",model:{value:this.lockTime,callback:t=>{this.lockTime=t}}},["定时发送"]),this.lockTime&&t("el-date-picker",{class:"time",attrs:{"popper-class":"time-popover","value-format":"yyyy-MM-dd HH:mm:ss",size:"small",type:"datetime",placeholder:"选择日期时间"},model:{value:this.time,callback:t=>{this.time=t}}})]),t("div",{class:"post-footer-action"},[t("span",{on:{click:this.recoverDraft},class:"post-footer-action-text"},["恢复草稿"]),t("span",{on:{click:()=>this.saveDraft(!0)},class:"post-footer-action-text"},["保存草稿"]),t("h-button",{on:{click:this.handlePost},attrs:{loading:this.loading}},["发布帖子"])])]),this.$slots.cover&&t("div",{class:"cover"},[this.$scopedSlots.cover({})])])}},f=p,m=(s("aca6"),s("20bd"),s("2877")),u=Object(m["a"])(f,d,h,!1,null,"6583b098",null);e["default"]=u.exports},"3b8e":function(t,e,s){},aca6:function(t,e,s){"use strict";s("3b8e")},d831:function(t,e,s){}}]);