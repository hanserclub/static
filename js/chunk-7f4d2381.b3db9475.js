(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f4d2381"],{"0008":function(t,e,s){"use strict";s("71f2")},"079b":function(t,e,s){},"083a":function(t,e,s){"use strict";var i=s("0d51"),o=TypeError;t.exports=function(t,e){if(!delete t[e])throw o("Cannot delete property "+i(e)+" of "+i(t))}},"0bf2":function(t,e,s){},"0f16":function(t,e,s){},"205f":function(t,e,s){},"250b":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"detail-editor"},[e("editor-provider",{attrs:{plugins:t.pluginConfig}},[e("post-editor",{ref:"editor",attrs:{limit:t.limit,toolbar:t.toolbarConfig},model:{value:t.postContent,callback:function(e){t.postContent=e},expression:"postContent"}})],1),e("div",{staticClass:"detail-editor__action"},[e("h-button",{attrs:{debonus:1e3,loading:t.loading},on:{click:t.post}},[t._v("发表回复")])],1)],1)},o=[],a=s("feeb"),l=s("27e8"),n=s("dbbe"),r=s("f1f3"),c={name:"detail-editor",props:["loading","limit"],components:{EditorProvider:a["a"],PostEditor:l["a"],HButton:n["a"]},data(){return{postContent:"",toolbarConfig:["bold","italic","image","link","emoticons","video"],pluginConfig:{[r["a"].IMAGE]:null,[r["a"].LINK]:null,[r["a"].MENTION]:null,[r["a"].HASH_TAG]:null,[r["a"].CHARACTER_COUNT]:{limit:this.limit||2e3}}}},methods:{post(){this.$emit("postReply",this.postContent)},clear(){this.postContent="",this.$refs["editor"].clearContent(),this.loading=!1}}},h=c,p=(s("ddd8"),s("2877")),d=Object(p["a"])(h,i,o,!1,null,"e7e635de",null);e["a"]=d.exports},"3a89":function(t,e,s){"use strict";s("cafa")},"3c65":function(t,e,s){"use strict";var i=s("23e7"),o=s("7b0b"),a=s("07fa"),l=s("3a34"),n=s("083a"),r=s("3511"),c=1!==[].unshift(0),h=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:c||h},{unshift:function(t){var e=o(this),s=a(e),i=arguments.length;if(i){r(s+i);var c=s;while(c--){var h=c+i;c in e?e[h]=e[c]:n(e,h)}for(var p=0;p<i;p++)e[p]=arguments[p]}return l(e,s+i)}})},"3cc0":function(t,e,s){},"3e0f":function(t,e,s){"use strict";s("0bf2")},"48e5":function(t,e,s){},4941:function(t,e,s){},"4a38":function(t,e,s){"use strict";s("7231")},"4f8a":function(t,e,s){"use strict";s("f757")},"69d5":function(t,e,s){"use strict";s.d(e,"g",(function(){return a})),s.d(e,"d",(function(){return l})),s.d(e,"i",(function(){return n})),s.d(e,"j",(function(){return r})),s.d(e,"h",(function(){return c})),s.d(e,"l",(function(){return v})),s.d(e,"k",(function(){return m})),s.d(e,"n",(function(){return y})),s.d(e,"m",(function(){return g})),s.d(e,"o",(function(){return _})),s.d(e,"f",(function(){return k})),s.d(e,"e",(function(){return w})),s.d(e,"c",(function(){return b})),s.d(e,"b",(function(){return C})),s.d(e,"a",(function(){return x}));var i=s("db04"),o=s("50fc");const a=t=>i["a"].get(o["a"].getAvatarCheckList,{params:t}),l=t=>i["a"].post(o["a"].approveAvatarCheck,t),n=t=>i["a"].get(o["a"].getLogList,{params:t}),r=t=>i["a"].get(o["a"].getRecoverList,{params:t}),c=t=>i["a"].get(o["a"].banList,{params:t}),h=t=>i["a"].post(`${o["a"].removePost}/${t}`),p=t=>i["a"].post(`${o["a"].setPostValued}/${t}`),d=t=>i["a"].post(`${o["a"].removePostValued}/${t}`),u=t=>i["a"].post(`${o["a"].setPostTopping}/${t}`),f=t=>i["a"].post(`${o["a"].removePostTopping}/${t}`),v=t=>i["a"].get(o["a"].nicknameApplyList,{params:t}),m=t=>i["a"].post(o["a"].nicknameApplyCheck,t),y=t=>i["a"].get(o["a"].signApplyList,{params:t}),g=t=>i["a"].post(o["a"].signApplyCheck,t),_=t=>i["a"].post(`${o["a"].unban}${t.uid}`,t),k=[{key:void 0,value:"全部"},{key:0,value:"待审核"},{key:1,value:"审核通过"},{key:2,value:"审核不通过"}],w=[{key:0,value:"在使用"},{key:1,value:"已过期"},{key:2,value:"被撤销"},{key:3,value:"全部"}],b=[{key:void 0,value:"全部"},{key:1,value:"删帖相关"},{key:2,value:"屏蔽相关"},{key:3,value:"加精相关"},{key:4,value:"置顶相关"}],C={5:"加精",6:"取消加精",7:"置顶",8:"取消置顶"},x={1:h,3:null,4:null,5:p,6:d,7:u,8:f}},"71f2":function(t,e,s){},7231:function(t,e,s){},"779e":function(t,e,s){"use strict";s("0f16")},"78e5":function(t,e,s){},7984:function(t,e,s){"use strict";s("ce68")},9264:function(t,e,s){"use strict";s("f330")},"9fbf":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"brief-author"},["post-details"===t.type?e("detail-avatar",{attrs:{avatar:t.avatar,level:t.level,uid:t.uid,nickname:t.nickname,focusHe:t.focusHe,exp:t.exp,auth:t.auth,iconSize:t.iconSize,authentication:t.authentication},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[e("template",{slot:"avatar-slot"},[e("link-avatar",{attrs:{avatar:t.avatar,size:t.size,auth:t.auth,uid:t.uid,iconSize:t.iconSize,authentication:t.authentication,nickname:t.nickname}})],1)],2):e("link-avatar",{attrs:{avatar:t.avatarUrl,size:t.size,auth:t.auth,uid:t.uid,iconSize:t.iconSize,authentication:t.authentication,nickname:t.nickname}}),e("level-nickname",{staticClass:"level-nickname-wrapper",attrs:{colors:t.colors,uid:t.uid,nickname:t.nickname}}),t._t("default")],2)},o=[],a=s("c362"),l=s("e51f"),n=s("919f"),r={name:"brief-author",props:["type","nickname","colors","iconSize","uid","avatar","size","auth","authentication","level","exp","focusHe"],components:{LinkAvatar:a["a"],LevelNickname:l["a"],DetailAvatar:n["a"]},computed:{avatarUrl(){return this.avatar||"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png"}},methods:{getUserInfo(){this.$emit("getUserInfo",this.uid)},followUser(t,e){this.$emit("followUser",t,e)}}},c=r,h=(s("4a38"),s("2877")),p=Object(h["a"])(c,i,o,!1,null,"5ff0f064",null);e["a"]=p.exports},a02a:function(t,e,s){"use strict";s("4941")},a140:function(t,e,s){},ad97:function(t,e,s){"use strict";s("78e5")},cafa:function(t,e,s){},ce68:function(t,e,s){},ceca:function(t,e,s){"use strict";s("205f")},d1e1:function(t,e,s){"use strict";s("3cc0")},ddd8:function(t,e,s){"use strict";s("48e5")},de6d:function(t,e,s){"use strict";s("079b")},e2dc:function(t,e,s){"use strict";s("a140")},f26e:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-details"},[e("div",{staticClass:"post-details__wrapper"},[e("div",{staticClass:"post-details__container"},[1===t.detailData.status?e("span",{staticClass:"delete-info"},[t._v("注：此贴已删除，仅供管理员查看，请勿进行其他操作！")]):t._e(),t.contentShow?e("post-content",{attrs:{levels:t.levels,isSelf:t.isSelf,detail:t.detailData},on:{edit:t.edit,likePost:t.likePost,lock:t.lockPost,unlock:t.unLockPost,favorite:t.favorite,delete:t.handleDelete,reportPost:t.handleReportPost}}):e("content-skeleton"),e("post-reply",{ref:"post-reply",staticStyle:{"margin-top":"24px"},attrs:{levels:t.levels,user:t.user,isMobile:t.isMobile,isAuthor:t.isSelf,currentPostId:t.currentPostId},on:{followUser:t.followUser,replyFloor:t.handlePostByFloor,replyReplyInReply:t.replyReplyInReply,getUserInfo:t.getUserInfo,delete:t.handleDelete}}),t.isMobile?t._e():e("div",{staticClass:"post-details__editor"},[e("div",{staticClass:"post-details__editor-main"},[e("detail-editor",{ref:"editor",attrs:{limit:500,loading:t.replyLoading},on:{postReply:t.handlePost}})],1),t.user.uid&&1!==t.user.status?t._e():e("div",{staticClass:"cover"},[t.user.uid?e("span",{staticClass:"tip-text"},[t._v(" 你已被封禁,封禁解除后才可发帖 ")]):e("span",{staticClass:"tip-text"},[e("router-link",{staticClass:"to-login",attrs:{to:"/login"}},[t._v("登录")]),t._v(" 后才可回复 ")],1)])])],1)]),e("div",{staticClass:"post-details__right"},[t.authorInfoShow?e("post-author",{attrs:{levels:t.levels,author:t.detailData.author,isFollowing:t.isFollowing,isSelf:t.isSelf},on:{followAuthor:t.followAuthor}}):e("author-skeleton")],1)])},o=[],a=(s("3c65"),s("14d9"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-author"},[e("div",{staticClass:"post-author-title"},[e("span",[t._v("帖主")]),t.isAdmin?e("el-popover",{attrs:{"popper-class":"post-action-popover",placement:"bottom",trigger:"click"}},[e("ul",{staticClass:"operations"},t._l(t.operations,(function(s){return e("li",{key:s.text,class:["operation",s.textStyle],on:{click:s.callback}},[e("i",{class:["hanser",s.icon]}),t._v(" "+t._s(s.text)+" ")])})),0),e("div",{staticClass:"more",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"hanser icon-gengduo"})])]):t._e()],1),e("div",{staticClass:"post-author-baseInfo"},[e("div",{staticClass:"post-author-baseInfo__avatar"},[e("link-avatar",{attrs:{avatar:t.authorInfo.avatar,size:80,uid:t.authorInfo.uid,auth:t.authorInfo.auth,authentication:t.authorInfo.authentication,nickname:t.authorInfo.nickname}})],1),e("div",{staticClass:"post-author-baseInfo__nickname"},[e("level-nickname",{attrs:{nickname:t.authorInfo.nickname,uid:t.authorInfo.uid,colors:t.levelLabel.color}})],1),t.levelShow?e("div",{staticClass:"post-author-baseInfo__level"},[e("level-label",{attrs:{level:t.currentLevel}})],1):t._e()]),e("div",{staticClass:"post-author-info"},[e("div",{staticClass:"post-author-info__count"},t._l(t.data,(function(s){return e("router-link",{key:s.text,staticClass:"post-author-info__item",attrs:{to:"/space/"+t.authorInfo.uid+s.hash,target:"_blank"}},[e("div",{staticClass:"post-author-info__text"},[t._v(t._s(s.text))]),e("div",{staticClass:"post-author-info__value"},[t._v(t._s(t.counts[s.key]))])])})),1)]),t.isSelf?t._e():e("div",{staticClass:"post-author-action"},[e("h-button",{attrs:{plain:t.followBtnPlain},on:{click:t.followAuthor},nativeOn:{mousemove:function(e){return t.hoverOnFollow.apply(null,arguments)},mouseleave:function(e){return t.outHoverOnFollow.apply(null,arguments)}}},[t._v(t._s(t.hoverOnFollowText))]),e("h-button",{on:{click:function(e){return t.openChat(t.authorInfo.uid)}}},[t._v("私聊")])],1)])}),l=[],n=(s("13d5"),s("d9e2"),s("dbbe")),r=s("c362"),c=s("e51f"),h=s("99ca"),p=s("2f62"),d=s("db04"),u=s("50fc"),f={components:{HButton:n["a"],LinkAvatar:r["a"],LevelNickname:c["a"],LevelLabel:h["a"]},name:"details-author",props:["levels","author","isFollowing","isSelf"],data(){return{authorInfo:{},levelShow:!1,currentLevel:null,defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",hover:{follow:!1},data:[{text:"动态",key:"post",hash:"#posts"},{text:"关注",key:"follow",hash:"#follow"},{text:"粉丝",key:"fans",hash:"#fans"}],counts:{follow:0,fans:0,post:0}}},mounted(){this.authorInfo=this.author,this.counts.follow=this.authorInfo.follow,this.counts.fans=this.authorInfo.fans,this.counts.post=this.authorInfo.posts,this.currentLevel=this.getLevel()},computed:{...Object(p["d"])({user:t=>t.users.userInfo,isMobile:t=>t.media.isMobile,bilibiliScores:t=>t.score.bilibili,douyuScores:t=>t.score.douyu}),...Object(p["b"])("users",{isAdmin:"isAdmin",isHanser:"isHanser"}),bilibiliScore(){return this.bilibiliScores.length?this.bilibiliScores.map(t=>t.point).reduce((t,e)=>t+e):0},douyuScore(){return this.douyuScores.length?this.douyuScores.map(t=>t.point).reduce((t,e)=>t+e):0},level(){const{exp:t}=this.author;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t},avatar(){return this.authorInfo.avatar||this.defaultAvatar},userLink(){return"/space/"+this.authorInfo.uid},hoverOnFollowText(){return this.isFollowing?this.hover.follow?"取消关注":"已关注":"+关注"},followBtnPlain(){return this.isFollowing},isAuthorAdmin(){return this.authorInfo.role>=256},operations(){let t=[];return t=1==this.authorInfo.status?[{text:"已被封禁",icon:"icon-fengjin",textStyle:"icon-disabled",callback:this.recover}]:[{text:"封禁",icon:"icon-fengjin",textStyle:null,callback:this.banUser}],this.isHanser?this.isAuthorAdmin?[...t,{text:"取消管理员",icon:"icon-gerenzhongxin",textStyle:null,callback:this.cancelAdmin}]:[...t,{text:"设为管理员",icon:"icon-gerenzhongxin",textStyle:null,callback:this.setAdmin}]:this.isAdmin?t:[]}},methods:{getLevel(){const{exp:t}=this.authorInfo;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),this.levelShow=!0,e},openChat(t){const e=new CustomEvent("open-chat",{detail:{uid:t}});window.dispatchEvent(e)},followAuthor(){this.$emit("followAuthor",this.authorInfo.uid)},hoverOnFollow(){this.hover.follow=!0},outHoverOnFollow(){this.hover.follow=!1},banUser(){this.$showBanDialog(this.authorInfo,0,this.isMobile,()=>this.authorInfo.status=1)},async setAdmin(){try{let t=await d["a"].post(u["a"].setAdmin,{uid:this.authorInfo.uid});if(0!=t.code)throw new Error(t.msg);this.$message({type:"success",message:t.msg}),this.authorInfo.role=100}catch(t){console.log(t)}},async cancelAdmin(){try{let t=await d["a"].post(u["a"].cancelAdmin,{uid:this.authorInfo.uid});if(0!=t.code)throw new Error(t.msg);this.$message({type:"success",message:t.msg}),this.authorInfo.role=0}catch(t){console.log(t)}},recover(){this.$message({type:"warning",message:"已被封禁，不可操作"})}}},v=f,m=(s("3a89"),s("2877")),y=Object(m["a"])(v,a,l,!1,null,"734d1f00",null),g=y.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-content"},[e("div",{staticClass:"post-content-title"},[e("ul",{staticClass:"labels"},t._l(t.detailData.labels,(function(s){return e("li",{key:s.labelId},[e("span",{staticClass:"label",style:t.labelStyle(s)},[t._v(t._s(s.labelName))])])})),0),e("span",{staticClass:"title"},[t._v(t._s(t.detailData.title))])]),e("div",{staticClass:"post-content__inner"},[e("div",{staticClass:"post-content__inner-main"},[e("post-user",{attrs:{avatar:t.detailData.author.avatar,size:50,auth:t.detailData.author.auth,authentication:t.detailData.author.authentication,nickname:t.detailData.author.nickname,uid:t.detailData.author.uid,colors:t.levelLabel.color,level:t.level},scopedSlots:t._u([{key:"bottom",fn:function(){return[e("span",{staticClass:"post-content__time"},[t._v(" "+t._s(t.postTime)+" ")]),t.detailData.location?e("span",{staticClass:"ip-location"},[t._v(t._s(t.detailData.location))]):t._e()]},proxy:!0}])}),e("div",{staticClass:"post-content__inner-text"},[e("detail-content",{attrs:{content:t.detailData.content,isTop:!1}}),t.detailData.voteId?e("vote-panel",{attrs:{postId:t.detailData.id,voteId:t.detailData.voteId,expandVotePanel:!0,hideToggleButton:!0}}):t._e()],1),e("div",{staticClass:"post-content__inner-tags"},t._l(t.detailData.tags,(function(s,i){return e("span",{key:i},[e("router-link",{staticClass:"post-content__tags",attrs:{target:"_blank",to:"/tag/"+s.tagId}},[t._v("#"+t._s(s.tagName))])],1)})),0),e("div",{staticClass:"post-content__inner-banner"},[e("span",{staticClass:"post-content__action"},[t._m(0),t._v(" "+t._s(t.detailData.readings)+" ")]),e("span",{staticClass:"post-content__action",class:{liked:t.detailData.liked},on:{click:function(e){return t.like()}}},[t.showLike?e("div",{staticClass:"like-animation"},[e("img",{attrs:{src:"https://cdn.2550505.com/share/legacy-sso/like.gif",width:"64",height:"42"}})]):t._e(),e("div",{staticClass:"post-content__action-icon"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}})],1),t._v(" "+t._s(t.detailData.likes)+" ")]),e("span",{staticClass:"post-content__action",class:{favorited:t.detailData.favorite},on:{click:t.favorite}},[e("div",{staticClass:"post-content__action-icon"},[e("icon",{attrs:{icon:"hanser icon-shoucang"}})],1),t._v(" "+t._s(t.favoriteText)+" ")]),e("span",{staticClass:"post-reply__share"},[e("post-action",{attrs:{type:"post",userInfo:t.detailData.author,isAuthor:t.detailData.author.uid===t.user.uid,isSelf:t.isSelf},on:{handleLock:t.handleLock,handleUnLock:t.handleUnLock,handleEdit:t.handleEdit,handleDelete:t.handleDelete,handleReportPost:t.handleReportPost}})],1)])],1)])])},k=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-content__action-icon"},[e("i",{staticClass:"hanser icon-chakan"})])}],w=s("9579"),b=s("cbff"),C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-wrapper"},[e("div",{attrs:{id:"content"},domProps:{innerHTML:t._s(t.htmlTemplate)}})])},x=[],I={name:"detail-content",props:["content","isTop"],data(){return{contentLocal:""}},computed:{...Object(p["d"])({isMobile:t=>t.media.isMobile}),htmlTemplate(){const t=this.isTop?'<div class="top-label">置顶</div>':"";return`<div class="content">${t}${this.content}</div>`}}},S=I,$=(s("3e0f"),Object(m["a"])(S,C,x,!1,null,"d8d96880",null)),P=$.exports,L=function(){var t=this,e=t._self._c;return e("el-popover",{attrs:{width:80,"popper-class":"post-action-popover",placement:"bottom",trigger:"click"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("ul",{staticClass:"post-action-list"},[t.observedPostStatus.isAdmin&&"post"==t.type?t._l(t.actionNameList,(function(s){return e("li",{key:s.id,staticClass:"post-action-list-item",on:{click:function(e){return t.handleExcuteAction(s.id)}}},[t._v(" "+t._s(s.name)+" ")])})):t._e(),t.observedPostStatus.isAdmin?e("ul",{staticClass:"post-action-list-item"},t._l(t.operations,(function(s){return e("li",{key:s.text,on:{click:s.callback}},[t._v(" "+t._s(s.text)+" ")])})),0):t._e(),t.observedPostStatus.isAdmin&&"post"==t.type&&2!==t.postData.detailData.status?e("li",{staticClass:"post-action-list-item",on:{click:t.handleLock}},[t._v(" 锁定帖子 ")]):t._e(),t.observedPostStatus.isAdmin&&"post"==t.type&&2===t.postData.detailData.status?e("li",{staticClass:"post-action-list-item",on:{click:t.handleUnLock}},[t._v(" 解锁帖子 ")]):t._e(),t.isSelf&&"post"==t.type&&0===t.postData.detailData.type?e("li",{staticClass:"post-action-list-item",on:{click:t.handleEdit}},[t._v(" 编辑帖子 ")]):t._e(),t.isSelf||t.observedPostStatus.isAdmin?e("li",{staticClass:"post-action-list-item",on:{click:t.handleDelete}},[t._v(" "+t._s(t.actionText)+" ")]):t._e(),"floor"==t.type&&(t.isAuthor||t.observedPostStatus.isAdmin)?e("li",{staticClass:"post-action-list-item",on:{click:t.setTop}},[t._v(" "+t._s(t.topText)+" ")]):t._e(),"post"==t.type?e("li",{staticClass:"post-action-list-item",on:{click:t.handleReportPost}},[t._v("举报帖子")]):t._e()],2),e("div",{staticClass:"post-action__origin",attrs:{slot:"reference"},slot:"reference"},["post"===t.type||t.isSelf||t.observedPostStatus.isAdmin||t.isAuthor?e("i",{staticClass:"hanser icon-gengduo"}):t._e()])])},D=[],E=s("69d5");const R=[{type:"post",title:"删帖确认",needId:!1},{type:"floor",title:"删除楼层确认",needId:!0},{type:"reply",title:"删除回复确认",needId:!0}],A={"删帖确认":"请输入删帖原因","删除楼层确认":"请输入删楼层原因","删除回复确认":"确认删除？"};var T={name:"post-action",inject:["postId","postMethods","observedPostStatus","postData"],props:["type","isSelf","id","userInfo","isTop","isAuthor"],data(){return{visible:!1}},computed:{actionNameList(){const t={...E["b"]},{isValued:e,isToped:s}=this.observedPostStatus;e?t["5"]=null:t["6"]=null,s?t["7"]=null:t["8"]=null;const i=[];for(const[o,a]of Object.entries(t))o&&a&&i.push({id:o,name:a});return i},actionText(){switch(this.type){case"post":return"删除帖子";case"reply":return"删除回复";case"floor":return"删除楼层";default:return""}},topText(){return this.isTop?"取消置顶":"置顶"},operations(){return this.observedPostStatus.isAdmin?[{text:"封禁",icon:"icon-fengjin",callback:this.banUser}]:[]},...Object(p["d"])({isMobile:t=>t.media.isMobile})},methods:{async handleExcuteAction(t){try{if(!this.postId)return;const e=E["a"][t];if(!e)return;await e(this.postId),this.$message({type:"success",message:(E["b"][t]||"操作")+"成功~"}),await this.postMethods(this.postId)}catch(e){console.log(e)}},handleLock(){this.$confirm("锁定帖子后，除本人以外无法在首页刷到此贴，是否锁定","锁定帖子",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(()=>{this.$emit("handleLock",{type:this.type,id:this.id})}).catch(()=>{this.$message({type:"success",message:"已取消锁定~"})})},handleUnLock(){this.$confirm("解锁帖子后，所有人可在首页刷到此贴，是否解锁","解锁帖子",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(()=>{this.$emit("handleUnLock",{type:this.type,id:this.id})}).catch(()=>{this.$message({type:"success",message:"已取消解除锁定~"})})},handleDelete(){let t=R.find(t=>t.type===this.type);this.$confirm(A[t.title],t.title,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",showInput:this.observedPostStatus.isAdmin&&!this.isSelf,inputPlaceholder:"内容包含违规信息",inputType:"textarea",inputValue:"",closeOnClickModal:!1}).then(({value:e})=>{const s=null!==e&&void 0!==e?e:"";t.needId?this.$emit("handleDelete",{type:this.type,id:this.id,reason:s}):this.$emit("handleDelete",{type:this.type,reason:s})}).catch(()=>{this.$message({type:"success",message:"已取消删除~"})})},setTop(){this.visible=!1,this.$emit("set-top",{id:this.id})},banUser(){this.visible=!1,this.$showBanDialog(this.userInfo,0,this.isMobile,()=>{})},handleEdit(){this.visible=!1,this.$emit("handleEdit")},async handleReportPost(){this.visible=!1;const t=await this.$showReportDialog();t&&this.$emit("handleReportPost",{reason:t})}}},F=T,U=(s("de6d"),Object(m["a"])(F,L,D,!1,null,null,null)),O=U.exports,M={components:{DetailContent:P,PostAction:O,PostUser:w["a"],VotePanel:b["a"]},name:"post-details",props:["levels","detail","isSelf"],data(){return{showLike:!1,detailData:{},defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png"}},beforeMount(){this.detailData=this.detail},computed:{...Object(p["d"])({user:t=>t.users.userInfo}),level(){const{exp:t}=this.detailData.author;let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},avatar(){return this.detailData.author.avatar||this.defaultAvatar},favoriteText(){return this.detailData.favorite?"已收藏":"收藏"},postTime(){var t=Date.parse(new Date(this.detailData.post_time.substr(0,10).toString().replace(/-/g,"/")+" "+this.detailData.post_time.substr(11,8).toString().replace(/-/g,"/"))),e=new Date(t+576e5).toISOString();return e.replace(/T/g," ").substr(0,16)},levelLabel(){const t=this.levels.find(t=>t.level===this.level.level);return t}},methods:{labelStyle(t){return`background: ${t.color};`},like(){!this.detailData.liked&&this.user.uid&&(this.showLike=!0,setTimeout(()=>{this.showLike=!1},1e3)),this.$emit("likePost")},favorite(){this.$emit("favorite")},handleDelete(t){this.$emit("delete",t)},handleEdit(){this.$emit("edit")},handleLock(t){this.$emit("lock",t)},handleUnLock(t){this.$emit("unlock",t)},handleReportPost(t){this.$emit("reportPost",t)}}},j=M,N=(s("4f8a"),Object(m["a"])(j,_,k,!1,null,"d624893c",null)),z=N.exports,B=function(){var t=this,e=t._self._c;return e("div",[e("span",{staticClass:"replyLocate"}),e("div",{staticClass:"post-reply"},[e("div",{staticClass:"post-reply-head"},[t._m(0),e("post-reply-order")],1),t.replyShow?e("div",[t.repliesLocal.length>0?e("div",{staticClass:"post-reply-main"},t._l(t.replyList,(function(s,i){return e("div",{key:s.floorId+""+i,staticClass:"post-reply__box",attrs:{"data-on-top":s.onTop}},[e("div",{staticClass:"post-reply__box-main"},[e("post-user",{attrs:{type:"post-details",avatar:s.author.avatar,size:50,auth:s.author.auth,authentication:s.author.authentication,nickname:s.author.nickname,uid:s.author.uid,colors:s.author.levelLabel.color,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser},scopedSlots:t._u([{key:"bottom",fn:function(){return[e("span",{staticClass:"post-reply__tag-time"},[t._v(t._s(s.formatPostTime))]),s.location?e("span",{staticClass:"ip-location"},[t._v(t._s(s.location))]):t._e()]},proxy:!0}],null,!0)},[s.author.isPostMaster?e("template",{slot:"post-master"},[e("post-master")],1):t._e()],2),e("div",{staticClass:"post-reply__box-text"},[e("detail-content",{attrs:{isTop:s.isTop,content:s.content}})],1),e("div",{staticClass:"post-reply__box-banner"},[s.onTop?t._e():e("span",{staticClass:"post-reply__tag-floor"},[t._v(t._s(s.floor)+"楼")]),e("span",{staticClass:"post-reply__tag-like",class:{liked:s.liked},on:{click:function(e){return t.like(s.floorId,i,s)}}},[s.showLike?e("div",{staticClass:"like-animation"},[e("img",{attrs:{src:"https://cdn.2550505.com/share/legacy-sso/like.gif",width:"64",height:"42"}})]):t._e(),e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}})],1),t._v(" "+t._s(s.likes)+" ")]),t.isMobile?e("span",{staticClass:"post-reply__tag-reply",on:{click:function(e){return t.showReplyFloor(s)}}},[e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]):e("span",{staticClass:"post-reply__tag-reply",on:{click:function(e){return t.replyFloor(s.floor,s.floorId,i)}}},[e("div",{staticClass:"post-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]),e("span",{staticClass:"post-reply__share"},[e("post-action",{attrs:{type:"floor",id:s.floorId,isAuthor:t.isAuthor,isTop:s.isTop,userInfo:s.author,isSelf:s.author.uid===t.user.uid},on:{"set-top":t.setFloorTop,handleDelete:t.handleDelete}})],1)]),s.hanserReply||s.hanserLike?e("div",{staticClass:"hanser-action"},[s.hanserReply?e("div",{staticClass:"hanser-reply"},[e("icon",{attrs:{icon:"hanser icon-huifu"}}),t._v(" hanser回复过 ")],1):t._e(),s.hanserLike&&!s.hanserReply?e("div",{staticClass:"hanser-like"},[e("icon",{attrs:{icon:"hanser icon-dianzan"}}),t._v(" hanser赞过 ")],1):t._e()]):t._e(),e("div",{staticClass:"post-reply__box-reply"},[s.replies.length>0?e("list-reply",{ref:"listReply",refInFor:!0,attrs:{levels:t.levels,replies:s.replies,floor:s.floor,floorId:s.floorId,user:t.user,index:i},on:{followUser:t.followUser,replyReplyInReply:t.replyReplyInReply,openEditorInReply:t.openEditorInReply,getUserInfo:t.getUserInfo,handleDelete:t.handleDelete}}):t._e()],1),t.showFloorEditor[i]?e("div",{staticClass:"post-reply__box-editor"},[e("div",{staticClass:"post-details__editor-main"},[e("detail-editor",{ref:"editor",refInFor:!0,attrs:{limit:500,loading:t.loading},on:{postReply:t.handleReply}})],1),t.user.uid&&1!==t.user.status?t._e():e("div",{staticClass:"cover"},[t.user.uid?e("span",{staticClass:"tip-text"},[t._v(" 你已被封禁,封禁解除后才可发帖 ")]):e("span",{staticClass:"tip-text"},[e("router-link",{staticClass:"to-login",attrs:{to:"/login"}},[t._v("登录")]),t._v(" 后才可回复 ")],1)])]):t._e()],1)])})),0):e("div",{staticClass:"post-reply-main"},[e("p",[t._v("暂无回复")])]),t.isMobile?e("load-more",{key:"post-reply",attrs:{name:"post-reply","have-more":!t.loadDone},on:{"load-more":t.loadMoreReplys}}):t._e(),t.isMobile?t._e():e("div",{staticClass:"post-reply-bottom"},[e("el-pagination",{attrs:{"prev-text":"上一页","next-text":"下一页","current-page":t.page,"page-size":10,layout:"prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1):e("reply-skeleton")],1)])},H=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-reply-head__title"},[e("span",[t._v("帖子回复")])])}],V=function(){var t=this,e=t._self._c;return e("div",{staticClass:"list-reply"},[t._l(t.showReplies,(function(s,i){return e("div",{key:i},[s.show?e("div",{staticClass:"list-reply__box"},[e("div",{staticClass:"list-reply__box-main"},[e("div",{staticClass:"list-reply__box-top"},[e("div",{staticClass:"list-reply__username"},[s.mention?t._e():[e("div",{staticClass:"reply-wrapper"},[e("brief-author",{attrs:{type:"post-details",avatar:s.author.avatar,iconSize:14,size:t.size,colors:s.author.levelLabel.color,auth:s.author.auth,uid:s.author.uid,authentication:s.author.authentication,nickname:s.author.nickname,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[s.author.isPostMaster?e("post-master"):t._e()],1),e("span",{staticClass:"colon"},[t._v("：")])],1),e("div",{staticClass:"list-reply__text",domProps:{innerHTML:t._s(s.content)}})],s.mention?[e("div",{staticClass:"reply-wrapper"},[e("brief-author",{attrs:{type:"post-details",avatar:s.author.avatar,iconSize:14,size:t.size,colors:s.author.levelLabel.color,auth:s.author.auth,uid:s.author.uid,authentication:s.author.authentication,nickname:s.author.nickname,level:s.author.level,exp:s.author.exp,focusHe:s.author.focusHe},on:{getUserInfo:t.getUserInfo,followUser:t.followUser}},[s.author.isPostMaster?e("post-master"):t._e()],1),s.mention?e("span",{staticClass:"reply-text"},[t._v("回复")]):t._e(),s.mention&&s.mention.author?e("replied-user",{attrs:{nickname:s.mention.author.nickname,uid:s.mention.author.uid,colors:s.mention.author.levelLabel.color}},[s.mention.author.isPostMaster?e("post-master"):t._e()],1):t._e(),s.mention&&!s.mention.author?e("span",{staticClass:"noreply-text"},[t._v("内容已被删除")]):t._e(),s.mention?e("span",{staticClass:"colon"},[t._v("：")]):t._e()],1),e("div",{staticClass:"list-reply__text",domProps:{innerHTML:t._s(s.content)}})]:t._e()],2)]),e("div",{staticClass:"list-reply__box-banner"},[e("span",{staticClass:"list-reply__tag-time"},[t._v(" "+t._s(s.formatPostTime)+" ")]),s.location?e("span",{staticClass:"ip-location"},[t._v(t._s(s.location))]):t._e(),t.isMobile?e("span",{staticClass:"list-reply__tag-reply",on:{click:function(e){return t.showReplyFloor(s,i)}}},[e("div",{staticClass:"list-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]):e("span",{staticClass:"list-reply__tag-reply",on:{click:function(e){return t.openEditor(s,i)}}},[e("div",{staticClass:"list-reply__tag-icon"},[e("icon",{attrs:{icon:"hanser icon-huifu"}})],1),t._v(" 回复 ")]),e("span",{staticClass:"list-reply__share"},[e("post-action",{attrs:{type:"reply",id:s.id,userInfo:s.author,isSelf:s.author.uid===t.user.uid},on:{handleDelete:t.handleDelete}})],1)]),s.editorShow?e("div",{staticClass:"list-reply__box-editor"},[e("div",{staticClass:"post-details__editor-main"},[e("detail-editor",{ref:"editor",refInFor:!0,attrs:{limit:500,loading:t.loading},on:{postReply:e=>t.handleReply(e,s)}})],1),t.user.uid&&1!==t.user.status?t._e():e("div",{staticClass:"cover"},[t.user.uid?e("span",{staticClass:"tip-text"},[t._v(" 你已被封禁,封禁解除后才可发帖 ")]):e("span",{staticClass:"tip-text"},[e("router-link",{staticClass:"to-login",attrs:{to:"/login"}},[t._v("登录")]),t._v(" 后才可回复 ")],1)])]):t._e()])]):t._e()])})),t.replies.length>10&&t.showAllReplies&&!this.isMobile?e("div",{staticClass:"list-reply-bottom"},[e("el-pagination",{attrs:{"prev-text":"上一页","next-text":"下一页","current-page":t.page,"page-size":10,layout:"prev, pager, next, jumper",total:t.replies.length},on:{"current-change":t.handleCurrentChange}})],1):t._e(),t.replies.length>3?e("div",{staticClass:"list-reply__action"},[e("span",{staticClass:"list-reply__action-text"},[t._v("共"+t._s(t.replies.length)+"条回复")]),e("span",{staticClass:"list-reply__action-expand",on:{click:t.expandReply}},[t._v(t._s(t.expandShowText))])]):t._e()],2)},J=[],q=s("250b"),W=s("e100"),G=s("9fbf"),K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-master"},[t._v("楼主")])},Q=[],X={name:"post-master"},Y=X,Z=(s("ad97"),Object(m["a"])(Y,K,Q,!1,null,"b36d0dd8",null)),tt=Z.exports,et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"replied-user"},[e("level-nickname",{attrs:{nickname:t.nickname,uid:t.uid,colors:t.colors}}),t._t("default")],2)},st=[],it={name:"replied-user",props:["nickname","colors","uid"],components:{LevelNickname:c["a"]}},ot=it,at=(s("d1e1"),Object(m["a"])(ot,et,st,!1,null,"51212048",null)),lt=at.exports,nt={name:"list-reply",props:["replies","floor","floorId","levels","user","index"],components:{DetailEditor:q["a"],BriefAuthor:G["a"],PostMaster:tt,PostAction:O,RepliedUser:lt},data(){return{defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",replyContent:"",currentShowIndex:-1,repliesLocal:[],repliesShowBrief:[],loading:!1,showAllReplies:!0,num:0,postReply:"",page:1}},created(){let t=JSON.parse(JSON.stringify(this.replies));if(this.replies.length>3){this.showAllReplies=!1;const e=JSON.parse(JSON.stringify(t.slice(0,3)));this.repliesShowBrief=this.preProcessForAll(e)}this.repliesLocal=this.preProcessForAll(t)},computed:{...Object(p["d"])({isMobile:t=>t.media.isMobile,theme:t=>t.config.theme,themeWithAvatarBorder:t=>t.config.themeWithAvatarBorder}),showReplies(){return this.showAllReplies?this.isMobile?this.repliesLocal:this.repliesLocal.slice(10*(this.page-1),10*this.page):this.repliesShowBrief},expandShowText(){return this.showAllReplies?"点击收起":"展开全部"},size(){return this.themeWithAvatarBorder.includes(this.theme)?50:30}},methods:{handleReply(t,e){this.replyContent=t;const s=this.replyContent;0==this.replyContent.length?this.$message({type:"warning",message:"请输入回复内容"}):s.match(/^[ ]*$/)?this.$message({type:"warning",message:"输入不能全为空格~"}):(this.loading=!0,this.$emit("replyReplyInReply",{content:this.replyContent,floorId:this.floorId,uid:e.author.uid,id:e.id}),this.replyContent="",setTimeout(()=>{this.loading=!1},5e3))},async showReplyFloor(t){this.replyContent=await this.$showContentEditor("回复楼中楼"),this.replyContent&&this.handleReply(this.replyContent,t)},openEditor(t,e){this.currentShowIndex!=e?(-1!=this.currentShowIndex?this.closeEditors(!0):this.$emit("openEditorInReply",{reply:t,floor:this.floor,floorId:this.floorId,index:this.index}),t.editorShow=!0,this.currentShowIndex=e,this.postReply=`回复@${t.author.nickname}：`,this.$nextTick(()=>{const t=document.getElementsByClassName("list-reply__box-editor-input")[0];null===t||void 0===t||t.scrollIntoView({block:"center",behavior:"smooth"})})):this.closeEditors(!0)},getUserInfo(t){this.$emit("getUserInfo",t)},followUser(t,e){this.$emit("followUser",t,e)},expandReply(){this.showAllReplies=!this.showAllReplies},toUser(t){window.open("/space/"+t)},closeEditors(t){this.repliesLocal.forEach((t,e)=>{this.$set(this.repliesLocal[e],"editorShow",!1),this.repliesShowBrief[e]&&this.$set(this.repliesShowBrief[e],"editorShow",!1)}),t&&(this.currentShowIndex=-1)},preProcessForAll(t){var e=JSON.parse(JSON.stringify(t));return e.forEach((t,s)=>{var i;e[s].formatPostTime=Object(W["a"])(t.time),e[s].editorShow=!1,e[s].show=!0;const o=this.level(t.author.exp);if(Object.assign(t.author,{level:o,levelLabel:this.levels.find(t=>t.level===o.level)}),null!=(null===t||void 0===t||null===(i=t.mention)||void 0===i?void 0:i.author)){const e=this.level(t.mention.author.exp);Object.assign(t.mention.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})}}),JSON.parse(JSON.stringify(e))},handleCurrentChange(t){this.closeEditors(!0),this.page=t},handleDelete(t){this.$emit("handleDelete",t)},level(t){let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e}}},rt=nt,ct=(s("ceca"),Object(m["a"])(rt,V,J,!1,null,"5cb58855",null)),ht=ct.exports,pt=s("4445"),dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"reply-skeleton"},[e("el-skeleton",{attrs:{animated:"",count:5}},[e("template",{slot:"template"},[e("div",{staticClass:"sk-body"},[e("div",{staticClass:"sk-body__aside"},[e("el-skeleton-item",{staticStyle:{width:"50px",height:"50px"},attrs:{variant:"image"}})],1),e("div",{staticClass:"sk-body__main"},[e("div",{staticClass:"sk-info"},[e("el-skeleton-item",{staticStyle:{width:"64px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"80px",margin:"0 5px"},attrs:{variant:"text"}})],1),e("el-skeleton-item",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}}),e("el-skeleton-item",{staticStyle:{width:"100%",margin:"5px 0"},attrs:{variant:"text"}})],1)]),e("div",{staticClass:"sk-divider"})])],2)],1)},ut=[],ft={name:"reply-skeleton"},vt=ft,mt=(s("7984"),Object(m["a"])(vt,dt,ut,!1,null,"2bf9a7f8",null)),yt=mt.exports,gt=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"post-reply-order"},[e("div",{staticClass:"order__checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.replyType,expression:"replyType"}],staticClass:"order__checkbox-toggle",attrs:{id:"cb",type:"checkbox"},domProps:{checked:Array.isArray(t.replyType)?t._i(t.replyType,null)>-1:t.replyType},on:{change:function(e){var s=t.replyType,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,l=t._i(s,a);i.checked?l<0&&(t.replyType=s.concat([a])):l>-1&&(t.replyType=s.slice(0,l).concat(s.slice(l+1)))}else t.replyType=o}}}),t._m(0)])])},_t=[function(){var t=this,e=t._self._c;return e("label",{staticClass:"order__checkbox-toggle",attrs:{for:"cb"}},[e("span",{staticClass:"order__checkbox-toggle__item"})])}],kt={name:"post-reply-order",data(){return{replyType:Number(this.$route.query.order)||0}},watch:{replyType(t){this.$router.replace({path:this.$route.path,query:{order:Number(t)}})}}},wt=kt,bt=(s("779e"),Object(m["a"])(wt,gt,_t,!1,null,"0e342fb4",null)),Ct=bt.exports,xt=s("365c"),It={name:"post-reply",props:["levels","user","isMobile","currentPostId","isAuthor"],data(){return{defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",replyContent:"",repliesLocal:[],topReplies:[],showFloorEditor:[],currentShowEditor:-1,currentShowFloorEditor:-1,currentFloorId:-1,currentReplyId:-1,page:1,pageSize:10,loading:!1,authorOnly:!1,showLike:!1,loadDone:!1,replyShow:!1,total:null,totalFloor:null,liking:!1}},components:{ListReply:ht,DetailEditor:q["a"],DetailContent:P,PostAction:O,LoadMore:pt["a"],PostUser:w["a"],PostMaster:tt,ReplySkeleton:yt,PostReplyOrder:Ct},watch:{currentPostId(t){t&&this.changePage(3)},"$route.query.order"(){this.changePage(1)}},async mounted(){this.currentPostId&&await this.changePage(3)},methods:{...Object(p["c"])({addUserExp:"users/addUserExp"}),openChat(t){const e=new CustomEvent("open-chat",{detail:{uid:t}});window.dispatchEvent(e)},getLevels(){this.repliesLocal.forEach(t=>{const e=this.level(t.author.exp);t.author=Object.assign(t.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})}),this.topReplies.forEach(t=>{const e=this.level(t.author.exp);t.author=Object.assign(t.author,{level:e,levelLabel:this.levels.find(t=>t.level===e.level)})})},level(t){let e=this.levels[0];return this.levels.forEach(s=>{s.exp<=t&&s.level>e.level&&(e=s)}),e},async like(t,e,s){!s.liked&&this.user.uid?(s.showLike=!0,1===this.user.uid&&(s.hanserLike=!0),setTimeout(()=>{s.showLike=!1},1e3)):s.liked&&this.user.uid&&1===this.user.uid&&(s.hanserLike=!1),this.checkLogin()&&(this.liking?this.$message({type:"warning",message:"操作太快了~"}):(this.liking=!0,await d["a"].post(xt["a"].likeReply+t).then(e=>{0==e.code&&(this.addUserExp(e.exp),1==e.status?(this.repliesLocal.forEach(e=>{e.floorId===t&&(e.liked=!0,e.likes+=1)}),this.topReplies.forEach(e=>{e.floorId===t&&(e.liked=!0,e.likes+=1)})):(this.repliesLocal.forEach(e=>{e.floorId===t&&(e.liked=!1,e.likes-=1)}),this.topReplies.forEach(e=>{e.floorId===t&&(e.liked=!1,e.likes-=1)})),this.liking=!1)})))},replyFloor(t,e,s){var i;if(null===(i=this.$refs["listReply"])||void 0===i||i.forEach(t=>{t.closeEditors(!0)}),this.currentShowFloorEditor=-1,this.currentReplyId=-1,-1!=this.currentShowEditor){if(this.currentShowEditor==s)return this.clearShowFloorEditor(),this.currentShowEditor=-1,void(this.currentFloorId=-1);this.clearShowFloorEditor()}this.$set(this.showFloorEditor,s,!0),this.currentShowEditor=s,this.currentFloorId=e,this.$nextTick(()=>{const t=document.getElementsByClassName("post-reply__box-editor-input")[0];"undefined"!==typeof t&&t.scrollIntoView({block:"center",behavior:"smooth"})})},async showReplyFloor(t){this.replyContent=await this.$showContentEditor("回复楼层"),this.currentFloorId=t.floorId,this.replyContent&&this.$emit("replyFloor",{content:this.replyContent,floorId:this.currentFloorId})},openEditorInReply(t){const{reply:e,floorId:s,index:i}=t;if(this.$refs["listReply"].forEach((t,e)=>{e!=i&&t.closeEditors(!0),e==i&&t.closeEditors(!1)}),-1!=this.currentShowEditor&&(this.clearShowFloorEditor(),this.currentShowEditor=-1,this.currentFloorId=-1),-1!=this.currentShowFloorEditor){if(this.currentShowFloorEditor==i&&e.id==this.currentReplyId)return this.$set(this.showFloorEditor,this.currentShowFloorEditor,!1),this.$refs["listReply"].forEach((t,e)=>{e!=i&&t.closeEditors(!0),e==i&&t.closeEditors(!1)}),this.currentShowFloorEditor=-1,void(this.currentFloorId=-1);this.$set(this.showFloorEditor,this.currentShowFloorEditor,!1)}this.currentShowFloorEditor=i,this.currentFloorId=s,this.currentReplyId=e.id},clearShowFloorEditor(){this.showFloorEditor.forEach((t,e)=>{this.$set(this.showFloorEditor,e,!1)})},handleReply(t){this.replyContent=t;const e=this.replyContent;0==this.replyContent.length||e.match(/^[ ]*$/)?(this.$message({type:"warning",message:"请输入回复的内容~"}),this.replyContent=""):(this.loading=!0,this.$emit("replyFloor",{content:this.replyContent,floorId:this.currentFloorId}),this.replyContent="",setTimeout(()=>{this.loading=!1},5e3))},handleCurrentChange(t){this.page=t,this.changePage(4)},replyReplyInReply(t){this.$emit("replyReplyInReply",t)},getUserInfo(t){this.$emit("getUserInfo",t)},followUser(t,e){this.$emit("followUser",t,e)},showAuthorOnly(){},handleDelete(t){this.$emit("delete",t)},setFloorTop(t){d["a"].post(xt["a"].replySetTop,{postId:this.currentPostId,replyId:t.id}).then(t=>{0===t.code?(this.$message({type:"success",message:t.msg}),window.location.reload()):this.$message({type:"warning",message:t.msg})})},loadMoreReplys(){this.loadDone||(this.page++,this.changePage(2))},async changePage(t){1==t&&this.isMobile?(this.page=1,this.replyShow=!1,this.loadDone=!1):1==t&&(this.replyShow=!1);const e={page:this.page,pageSize:this.pageSize,order:this.$route.query.order||0};await d["a"].get(xt["a"].replyList+this.currentPostId,{params:e}).then(e=>{if(0==e.code){e.list.length<this.pageSize&&(this.loadDone=!0),this.totalFloor+=e.list.length;const s=document.getElementsByClassName("layout-body")[0],i=document.getElementsByClassName("post-content")[0];switch(this.isMobile||e.list.forEach(t=>{const e=document.createElement("div");e.innerHTML=t.content;const s=e.getElementsByTagName("iframe");Array.from(s).forEach(t=>{t.setAttribute("height","400")}),t.content=e.innerHTML}),1===this.page&&(this.topReplies=e.topList,this.topReplies.forEach((t,e)=>{this.$set(this.topReplies[e],"editorShow",!1),this.$set(this.topReplies[e],"showLike",!1),this.$set(this.topReplies[e],"onTop",!0),this.showFloorEditor.push(!1);const s=Object(W["a"])(t.time);this.$set(this.topReplies[e],"formatPostTime",s)})),t){case 1:this.repliesLocal=[...e.list],this.total=e.total,this.scrollToTop();break;case 2:this.repliesLocal.push(...e.list),this.total+=e.total;break;case 3:this.repliesLocal=e.list,this.total=e.total;break;case 4:this.repliesLocal=e.list,this.total=e.total,s.scrollTop=i.clientHeight+25;break;default:this.repliesLocal=e.list,this.total=e.total}this.getLevels(),this.showFloorEditor=[],this.repliesLocal.forEach((t,e)=>{this.$set(this.repliesLocal[e],"editorShow",!1),this.$set(this.repliesLocal[e],"showLike",!1),this.showFloorEditor.push(!1);const s=Object(W["a"])(t.time);this.$set(this.repliesLocal[e],"formatPostTime",s)}),this.replyShow=!0,this.isMobile&&1==t&&this.scrollToReply()}})},scrollToTop(){const t=document.getElementsByClassName("layout-body")[0];t.scrollTop=0},scrollToReply(){const t=document.getElementsByClassName("replyLocate")[0];"undefined"!==typeof t&&t.scrollIntoView({behavior:"smooth"})},checkLogin(){return!!this.user.uid||(this.$message({type:"warning",message:"请登录后重试"}),!1)}},computed:{replyList(){return[...this.topReplies,...this.repliesLocal]}}},St=It,$t=(s("a02a"),s("0008"),Object(m["a"])(St,B,H,!1,null,"42f5c58c",null)),Pt=$t.exports,Lt=s("234f"),Dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"author-skeleton"},[e("el-skeleton",{attrs:{animated:""}},[e("template",{slot:"template"},[e("div",{staticClass:"sk-title"},[e("el-skeleton-item",{staticStyle:{width:"20%"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body"},[e("div",{staticClass:"sk-body__image"},[e("el-skeleton-item",{staticStyle:{width:"80px",height:"80px"},attrs:{variant:"image"}})],1),e("div",{staticClass:"sk-body__username"},[e("el-skeleton-item",{staticStyle:{width:"50px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__label"},[e("el-skeleton-item",{staticStyle:{width:"114px",height:"20px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__info"},[e("el-skeleton-item",{staticStyle:{width:"150px",height:"32px"},attrs:{variant:"text"}})],1),e("div",{staticClass:"sk-body__action"},[e("el-skeleton-item",{staticStyle:{width:"78px",height:"40px"},attrs:{variant:"text"}})],1)])])],2)],1)},Et=[],Rt={name:"author-skeleton"},At=Rt,Tt=(s("9264"),Object(m["a"])(At,Dt,Et,!1,null,"896397ca",null)),Ft=Tt.exports,Ut=s("a026");const Ot={detailPost(t){return d["a"].get(xt["a"].detailPost+t)},postReply(t,e,s){const i={postId:t,content:e,author:s};return d["a"].post(xt["a"].replyPost+t,i)},postReplyByFloor(t,e,s){const i={postId:t,content:e};return d["a"].post(xt["a"].replyPostByFloor+s,i)},getFollows(t,e,s){const i={uid:t,page:e,pageSize:s};return d["a"].get(xt["a"].followList,{params:i})},getFollowsTotal(t){const e={uid:t};return d["a"].get(xt["a"].followTotal,{params:e})},follow(t){const e={uid:t};return d["a"].post(xt["a"].follow+"/"+t,e)},likeAPost(t,e){const s={author:t};return d["a"].post(xt["a"].like+"/"+e,s)},lockPost(t){return d["a"].post(xt["a"].lock+"/"+t)},unLockPost(t){return d["a"].post(xt["a"].unlock+t)},replyReply(t,e,s,i,o){const a={postId:t,replyId:e,content:s,uid:i};return d["a"].post(xt["a"].replyReply+o,a)},favoritePost(t){return d["a"].post(xt["a"].postFavorite+t)},deletePost(t,e=""){return d["a"].post(xt["a"].deletePost+t,{reason:e})},deleteReply(t,e=""){return d["a"].post(xt["a"].deleteReply+t,{reason:e})},deleteFloor(t,e=""){return d["a"].post(xt["a"].deleteFloor+t,{reason:e})},reportPost(t,e,s){return d["a"].post(xt["a"].reportPost,{postId:t,author:e,desciption:s})}},Mt=Ut["default"].observable({isAdmin:!1,isToped:!1,isValued:!1,isSelf:!1,isHanser:!1});var jt={name:"post-details",data(){return{currentPostId:"",detailData:{},replies:[],authorInfoShow:!1,contentShow:!1,postContent:"",defaultAvatar:"https://cdn.2550505.com/share/legacy-sso/thumbnail.default.png",pageSize:10,isFollowing:!1,liking:!1,isSelf:!1,signed:!1,signedDays:0,myData:{follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0},lastUidInfo:0,popoverUserData:{follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0},popoverState:{isSelf:!1,popoverLoading:!0},replyLoading:!1}},metaInfo(){return{title:(this.detailData.title||"")+" - 毛怪俱乐部",meta:[{name:"keywords",content:""+this.tagsText},{name:"description",content:""+(this.detailData.title||"")}]}},components:{PostContent:z,PostReply:Pt,PostAuthor:g,DetailEditor:q["a"],ContentSkeleton:Lt["a"],AuthorSkeleton:Ft},provide(){var t,e;return{postData:this.$data,postMethods:this.getCurrentPostId,postId:(null===this||void 0===this||null===(t=this.$route)||void 0===t||null===(e=t.params)||void 0===e?void 0:e.postId)||0,observedPostStatus:Mt}},computed:{...Object(p["d"])({levels:t=>t.level.levels,user:t=>t.users.userInfo,isMobile:t=>t.media.isMobile}),...Object(p["b"])("users",{isAdmin:"isAdmin",isHanser:"isHanser"}),avatar(){return this.user.avatar||this.defaultAvatar},tagsText(){const t=["毛怪","hanser","社区","毛怪俱乐部"];return this.detailData.tags?(this.detailData.tags.forEach(e=>t.unshift(e.tagName)),[...new Set(t)].join(",")):""}},async mounted(){var t,e;this.currentPostId=(null===this||void 0===this||null===(t=this.$route)||void 0===t||null===(e=t.params)||void 0===e?void 0:e.postId)||0;const[s,i]=await Promise.all([d["a"].get(xt["a"].signed),d["a"].get(xt["a"].signedDays)]);this.signed=s.signed,this.signedDays=i.day,await this.getMyData(),await this.getCurrentPostId(this.currentPostId),this.getPostData()},methods:{...Object(p["c"])({addUserExp:"users/addUserExp"}),async getCurrentPostId(t){await Ot.detailPost(t).then(t=>{var e;if(0!==t.code)return this.$message({type:"warning",message:t.msg}),void(404===t.code&&this.$router.replace("/post_not_found"));if(!this.isMobile){const e=document.createElement("div");e.innerHTML=t.info.content;const s=e.getElementsByTagName("iframe");Array.from(s).forEach(t=>{t.setAttribute("height","400")}),t.info.content=e.innerHTML}this.isFollowing=(null===(e=t.info.author)||void 0===e?void 0:e.focusHe)||!1,this.detailData=t.info,this.contentShow=!0});const e=this.detailData.author.uid;e==this.user.uid&&(this.isSelf=!0),Mt.isAdmin=this.isAdmin,Mt.isHanser=this.isHanser,Mt.isToped=this.detailData.top,Mt.isValued=this.detailData.valued,Mt.isSelf=this.isSelf,await this.getUserData(e).then(t=>{this.detailData.author=Object.assign(this.detailData.author,t),this.authorInfoShow=!0})},async getUserData(t){const e={uid:t},{data:s}=await d["a"].get(xt["a"].dataCount,{params:e});return{follow:s.follow,fans:s.fans,posts:s.post,bilibiliScore:s.bilibiliScore,douyuScore:s.douyuScore}},async handlePost(t){if(!this.checkLogin())return;const e=t;if(0==t.length||e.replace(/<p>/g,"").replace(/<\/p>/g,"").match(/^[ ]*$/))return this.$message({type:"warning",message:"请输入回复的内容~"}),void this.$refs["editor"].clear();this.replyLoading=!0,await Ot.postReply(Number(this.currentPostId),t,this.detailData.author.uid).then(t=>{0==t.code?(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["editor"].clear(),this.$refs["post-reply"].changePage(1),this.replyLoading=!1):(this.$message({type:"warning",message:t.msg}),this.replyLoading=!1)})},async handlePostByFloor(t){const{content:e,floorId:s}=t;this.checkLogin()&&await Ot.postReplyByFloor(Number(this.currentPostId),e,s).then(t=>{0==t.code?(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["post-reply"].changePage(1)):this.$message({type:"warning",message:t.msg})})},sign(){d["a"].get(xt["a"].sign).then(t=>{0===t.code?(this.addUserExp(t.exp),this.$message({type:"success",message:"签到成功,经验+"+t.exp}),this.signedDays+=1,this.signed=!0):this.$message({type:"warning",message:t.msg})})},favorite(){Ot.favoritePost(Number(this.currentPostId)).then(t=>{0===t.code?(this.$message({type:"success",message:t.msg}),this.detailData.favorite=!!t.status):this.$message({type:"warning",message:t.msg})})},async getMyData(){this.user.uid&&await this.getUserData(this.user.uid).then(t=>{this.myData=t})},async followAuthor(t){this.checkLogin()&&await Ot.follow(t).then(t=>{0==t.code&&(1==t.relation||null==t.relation?(this.isFollowing=!0,this.$message({type:"success",message:t.msg})):(this.isFollowing=!1,this.$message({type:"success",message:t.msg})))})},edit(){this.$showEditDialog(this.detailData.title,this.detailData.content,this.detailData.id)},async likePost(){this.checkLogin()&&(this.liking?this.$message({type:"warning",message:"操作太快了~"}):await Ot.likeAPost(this.detailData.author.uid,Number(this.currentPostId)).then(t=>{0==t.code&&(this.addUserExp(t.exp),this.detailData.liked=t.liked,t.liked?this.detailData.likes++:this.detailData.likes--),this.liking=!1}))},async lockPost(){this.checkLogin()&&await Ot.lockPost(Number(this.currentPostId)).then(t=>{0==t.code&&(this.$message({type:"success",message:"已锁定"}),this.$router.go(0))})},async unLockPost(){if(!this.checkLogin())return;const t=await Ot.unLockPost(Number(this.currentPostId));0==t.code&&(this.$message({type:"success",message:"已解锁"}),this.$router.go(0))},async replyReplyInReply(t){const{floorId:e,content:s,uid:i,id:o}=t;this.checkLogin()&&await Ot.replyReply(Number(this.currentPostId),e,s,i,o).then(t=>{0==t.code&&(this.$message({type:"success",message:t.msg}),this.addUserExp(t.exp),this.$refs["post-reply"].changePage(1))})},checkLogin(){return!!this.user.uid||(this.$message({type:"warning",message:"请登录后重试"}),!1)},async getFollowList(t){return(await Ot.getFollows(t,null,null)).list},async getUserInfo(t){if(this.popoverState={isSelf:!1,popoverLoading:!0},t===this.user.uid)this.popoverUserData=this.myData,this.popoverState.isSelf=!0;else if(t!==this.lastUidInfo){this.popoverUserData={follow:0,fans:0,posts:0,bilibiliScore:0,douyuScore:0};const e=await this.getUserData(t);this.popoverUserData=e}this.lastUidInfo=t,this.popoverState.popoverLoading=!1},async followUser(t,e=(()=>{})){this.checkLogin()&&await Ot.follow(t).then(s=>{0==s.code&&(1==s.relation||null==s.relation?(this.$message({type:"success",message:"关注成功~"}),t==this.detailData.author.uid&&(this.isFollowing=!0),e(!0)):(this.$message({type:"success",message:"取关成功~"}),t==this.detailData.author.uid&&(this.isFollowing=!1),e(!1)))})},async handleDelete(t){const{type:e}=t,{reason:s=""}=t;if("post"===e){const t=+this.currentPostId;await Ot.deletePost(t,s).then(t=>{0===t.code&&(this.$message({type:"success",message:"帖子已删除"}),this.$router.push("/"))})}else"floor"===e?await Ot.deleteReply(t.id,s).then(t=>{0==t.code&&(this.$message({type:"success",message:"楼层已删除"}),this.$refs["post-reply"].changePage(1))}):"reply"===e&&await Ot.deleteFloor(t.id,s).then(t=>{0==t.code&&(this.$message({type:"success",message:"回复已删除"}),this.$refs["post-reply"].changePage(1))})},getPostData(){const t={currentPostId:this.currentPostId,author:this.detailData.author};this.$emit("getPostData",t)},handleReportPost(t){const{reason:e=""}=t,s=+this.currentPostId;Ot.reportPost(s,this.detailData.author.uid,e).then(t=>{0===t.code?this.$message({type:"success",message:"举报成功"}):this.$message({type:"warning",message:t.msg})})}}},Nt=jt,zt=(s("e2dc"),Object(m["a"])(Nt,i,o,!1,null,null,null));e["default"]=zt.exports},f330:function(t,e,s){},f757:function(t,e,s){}}]);